<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <title>å¦ä¸€ä¸ªæˆ‘</title>
    <style>
        /* å…¨å±€é‡ç½® - ä¸¥æ ¼æ§åˆ¶æ»šåŠ¨ */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-user-select: none; user-select: none;
            -webkit-touch-callout: none;
            -webkit-overflow-scrolling: touch; /* åªåœ¨éœ€è¦çš„åœ°æ–¹å¯ç”¨å¹³æ»‘æ»šåŠ¨ */
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden; /* å…¨å±€ç¦æ­¢æ»šåŠ¨ */
            position: fixed; /* é˜²æ­¢å¼¹æ€§æ»šåŠ¨ */
        }
        
        body { 
            background: #F8F8FA; /* é™¶ç“·ç™½èƒŒæ™¯ */
            font-size: 16px; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            line-height: 1.4;
            color: #1C1C1E;
            overscroll-behavior: none; /* ç¦ç”¨è¿‡åº¦æ»šåŠ¨æ•ˆæœ */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        /* åªåœ¨éœ€è¦æ»šåŠ¨çš„å†…å®¹åŒºåŸŸå¯ç”¨æ»šåŠ¨ */
        .scrollable {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            height: 100%;
            overscroll-behavior: contain; /* åªåœ¨å®¹å™¨å†…æ»šåŠ¨ */
        }

        /* å¯†ç é”é¡µé¢ - æç®€è®¾è®¡ */
        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #F8F8FA;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .lock-content {
            width: 100%;
            max-width: 300px;
            padding: 0 20px;
            text-align: center;
        }

        .app-name {
            font-size: 32px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 60px;
            letter-spacing: -0.5px;
        }

        .lock-title {
            font-size: 17px;
            color: #8E8E93;
            margin-bottom: 24px;
            font-weight: 400;
        }

        .password-inputs {
            display: flex;
            gap: 12px;
            margin-bottom: 40px;
            justify-content: center;
        }

        .password-input {
            width: 60px;
            height: 60px;
            border: 1.5px solid #C7C7CC;
            border-radius: 12px;
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            background: #FFFFFF;
            -webkit-appearance: none;
            appearance: none;
            transition: all 0.2s ease;
        }

        .password-input:focus {
            border-color: #007AFF;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.1);
        }

        /* è‡ªå®šä¹‰æç¤ºæ¡† */
        .custom-alert {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .alert-content {
            background: #FFFFFF;
            border-radius: 14px;
            padding: 24px;
            width: 100%;
            max-width: 280px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .alert-text {
            font-size: 17px;
            color: #1C1C1E;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-close {
            padding: 10px 24px;
            border-radius: 10px;
            border: none;
            background: #007AFF;
            color: white;
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s ease;
        }

        .alert-close:active {
            background: #0056CC;
        }

        /* ä¸»é¡µé¢å®¹å™¨ */
        #mainPage {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .main-nav {
            background: rgba(248, 248, 250, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 0.5px solid #E5E5EA;
            padding: 16px 16px 8px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-title {
            font-size: 34px;
            font-weight: 700;
            color: #1C1C1E;
            letter-spacing: -0.5px;
        }

        .nav-date {
            font-size: 15px;
            color: #8E8E93;
            margin-top: 2px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .main-content {
            height: calc(100vh - 150px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px 16px;
            overscroll-behavior: contain;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: #FFFFFF;
            border-radius: 16px;
            margin: 16px 0;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .stats-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 13px;
            color: #8E8E93;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }

        .stat-value.expense {
            color: #FF3B30;
        }

        .stat-value.income {
            color: #34C759;
        }

        .stat-value.balance {
            color: #007AFF;
        }

        /* é¢„ç®—åŒºåŸŸ */
        .budget-card {
            background: #FFFFFF;
            border-radius: 16px;
            margin: 16px 0;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .budget-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }

        .set-budget-btn {
            background: transparent;
            border: 1px solid #007AFF;
            color: #007AFF;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .set-budget-btn:active {
            background: rgba(0, 122, 255, 0.1);
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 0.5px solid #F2F2F7;
        }

        .budget-item:last-child {
            border-bottom: none;
        }

        .budget-cate {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .budget-cate-icon {
            font-size: 18px;
        }

        .budget-cate-name {
            font-size: 16px;
            color: #1C1C1E;
        }

        .budget-usage {
            text-align: right;
        }

        .budget-used {
            font-size: 16px;
            font-weight: 600;
            color: #1C1C1E;
        }

        .budget-remain {
            font-size: 13px;
            color: #8E8E93;
        }

        .budget-over {
            color: #FF3B30;
        }

        /* æ—¥å†åŒºåŸŸ */
        .calendar-card {
            background: #FFFFFF;
            border-radius: 16px;
            margin: 16px 0;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .calendar-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 16px;
        }

        .mini-calendar {
            margin-bottom: 16px;
        }

        .calendar-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 8px;
        }

        .week-day {
            font-size: 13px;
            color: #8E8E93;
            padding: 4px 0;
        }

        .week-day.sun {
            color: #FF3B30;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 16px;
            color: #1C1C1E;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .calendar-day.active {
            background: #007AFF;
            color: white;
        }

        .calendar-day.today {
            background: rgba(0, 122, 255, 0.1);
            color: #007AFF;
        }

        .calendar-day.has-bill::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background: #FF3B30;
        }

        .calendar-full-btn {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5EA;
            border-radius: 10px;
            background: #FFFFFF;
            color: #1C1C1E;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .calendar-full-btn:active {
            background: #F2F2F7;
        }

        /* è´¦å•åˆ—è¡¨ */
        .bills-section {
            background: #FFFFFF;
            border-radius: 16px;
            margin: 16px 0;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .bills-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .bills-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }

        .bills-filter {
            position: relative;
        }

        .filter-select {
            padding: 6px 12px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .bills-list {
            min-height: 100px;
        }

        /* è´¦å•é¡¹ - é‡ç‚¹ä¿®å¤æ»‘åŠ¨é—®é¢˜ */
        .bill-item {
            background: #F8F8FA;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            position: relative;
            user-select: none;
            touch-action: pan-y; /* åªå…è®¸å‚ç›´æ–¹å‘çš„æ‰‹åŠ¿ */
            transition: transform 0.15s ease;
        }

        /* åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯ç”¨æ»‘åŠ¨æ•ˆæœ */
        .bill-item.swiping {
            transition: transform 0.1s ease;
        }

        .bill-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bill-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #FFFFFF;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .bill-info {
            display: flex;
            flex-direction: column;
        }

        .bill-category {
            font-size: 16px;
            font-weight: 600;
            color: #1C1C1E;
            margin-bottom: 2px;
        }

        .bill-date {
            font-size: 14px;
            color: #8E8E93;
        }

        .bill-amount {
            font-size: 17px;
            font-weight: 700;
        }

        .bill-amount.expense {
            color: #FF3B30;
        }

        .bill-amount.income {
            color: #34C759;
        }

        /* åˆ é™¤æŒ‰é’® - ä½¿ç”¨æ–‡å­—æŒ‰é’® */
        .bill-actions {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .bill-item.swiped .bill-actions {
            opacity: 1;
            pointer-events: auto;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .edit-btn {
            background: #007AFF;
            color: white;
        }

        .edit-btn:active {
            background: #0056CC;
        }

        .delete-btn {
            background: #FF3B30;
            color: white;
        }

        .delete-btn:active {
            background: #D70015;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 17px;
            color: #8E8E93;
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 15px;
            color: #C7C7CC;
        }

        /* åº•éƒ¨å¯¼èˆªæ  */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(248, 248, 250, 0.9);
            backdrop-filter: blur(20px);
            border-top: 0.5px solid #E5E5EA;
            display: flex;
            justify-content: space-around;
            padding: 12px 0 24px;
            z-index: 100;
        }

        .nav-item {
            background: transparent;
            border: none;
            color: #8E8E93;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            transition: color 0.2s ease;
            flex: 1;
            max-width: 60px;
        }

        .nav-item.active {
            color: #007AFF;
        }

        .nav-icon {
            font-size: 24px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-text {
            font-size: 11px;
            font-weight: 500;
        }

        .add-btn {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: #007AFF;
            color: white;
            border: none;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
            transition: all 0.2s ease;
            z-index: 101;
        }

        .add-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: flex-end;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #F8F8FA;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            animation: slideUp 0.3s ease;
            padding-bottom: 40px;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            padding: 24px 16px 16px;
            position: relative;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            right: 16px;
            top: 24px;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            border: none;
            background: #E5E5EA;
            color: #1C1C1E;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .modal-close:active {
            background: #D1D1D6;
        }

        .modal-body {
            padding: 0 16px;
        }

        .modal-footer {
            padding: 16px;
            display: flex;
            gap: 10px;
            border-top: 0.5px solid #E5E5EA;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .save-btn {
            background: #007AFF;
            color: white;
        }

        .save-btn:active {
            background: #0056CC;
        }

        .cancel-btn {
            background: #E5E5EA;
            color: #1C1C1E;
        }

        .cancel-btn:active {
            background: #D1D1D6;
        }

        /* è¾“å…¥ç»„ */
        .input-group {
            margin-bottom: 24px;
        }

        .input-label {
            display: block;
            font-size: 15px;
            color: #8E8E93;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .text-input,
        .select-input,
        .date-input,
        .number-input,
        .textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #E5E5EA;
            border-radius: 12px;
            font-size: 17px;
            background: #FFFFFF;
            color: #1C1C1E;
            transition: border-color 0.2s ease;
        }

        .text-input:focus,
        .select-input:focus,
        .date-input:focus,
        .number-input:focus,
        .textarea:focus {
            outline: none;
            border-color: #007AFF;
        }

        /* é‡‘é¢è¾“å…¥ */
        .amount-input {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            border: none;
            border-bottom: 1px solid #E5E5EA;
            background: transparent;
            width: 100%;
            padding: 20px 0;
            color: #1C1C1E;
            margin: 20px 0;
        }

        .amount-input:focus {
            outline: none;
            border-bottom-color: #007AFF;
        }

        /* ç±»å‹åˆ‡æ¢ */
        .type-toggle {
            display: flex;
            gap: 10px;
            margin: 24px 0;
        }

        .type-btn {
            flex: 1;
            padding: 16px;
            border: 1px solid #E5E5EA;
            border-radius: 12px;
            background: #FFFFFF;
            color: #1C1C1E;
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .type-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }

        /* åˆ†ç±»ç½‘æ ¼ */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            border-radius: 12px;
            background: #FFFFFF;
            border: 1px solid #E5E5EA;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .category-item.active {
            background: #007AFF;
            border-color: #007AFF;
            color: white;
        }

        .category-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .category-name {
            font-size: 12px;
            text-align: center;
        }

        /* å®Œæ•´æ—¥å† */
        .calendar-full {
            background: #F8F8FA;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .calendar-month {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }

        .calendar-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: 1px solid #E5E5EA;
            background: #FFFFFF;
            color: #007AFF;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .calendar-nav-btn:active {
            background: #F2F2F7;
        }

        .calendar-days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-day-large {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 16px;
            color: #1C1C1E;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .calendar-day-large.active {
            background: #007AFF;
            color: white;
        }

        .calendar-day-large.today {
            background: rgba(0, 122, 255, 0.1);
            color: #007AFF;
        }

        .calendar-day-large.has-bill::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background: #FF3B30;
        }

        /* ç»Ÿè®¡é¡µé¢ */
        .stats-page {
            background: #F8F8FA;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
        }

        .chart-container {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
        }

        .chart-title {
            font-size: 17px;
            font-weight: 600;
            color: #1C1C1E;
            margin-bottom: 16px;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 375px) {
            .password-input {
                width: 50px;
                height: 50px;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* é˜²æ­¢è¯¯è§¦çš„è§¦æ‘¸ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .bill-item {
                min-height: 60px; /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
            }
            
            .action-btn {
                min-height: 44px; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸ç›®æ ‡ */
                min-width: 60px;
            }
            
            .nav-item {
                min-height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- å¯†ç é”é¡µé¢ -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-content">
            <div class="app-name">å¦ä¸€ä¸ªæˆ‘</div>
            <div class="lock-title">è¯·è¾“å…¥4ä½æ•°å­—å¯†ç </div>
            <div class="password-inputs">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
            </div>
            <button class="alert-close" onclick="checkPassword()" style="margin-top: 20px;">è§£é”</button>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æç¤ºæ¡† -->
    <div class="custom-alert" id="customAlert">
        <div class="alert-content">
            <div class="alert-text" id="alertText">å¯†ç é”™è¯¯</div>
            <button class="alert-close" onclick="closeAlert()">é‡è¯•</button>
        </div>
    </div>

    <!-- ä¸»é¡µé¢ -->
    <div id="mainPage">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="main-nav">
            <div class="nav-title">å¦ä¸€ä¸ªæˆ‘</div>
            <div class="nav-date" id="navDate">2025å¹´12æœˆ22æ—¥ æ˜ŸæœŸä¸€</div>
        </div>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="main-content" id="mainContent">
            <!-- æ”¶æ”¯ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-card">
                <div class="stats-title">æœ¬æœˆæ¦‚å†µ</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">æ”¯å‡º</div>
                        <div class="stat-value expense" id="monthExpense">Â¥0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ”¶å…¥</div>
                        <div class="stat-value income" id="monthIncome">Â¥0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ç»“ä½™</div>
                        <div class="stat-value balance" id="accountBalance">Â¥0.00</div>
                    </div>
                </div>
            </div>

            <!-- é¢„ç®—åŒºåŸŸ -->
            <div class="budget-card">
                <div class="budget-header">
                    <div class="budget-title">é¢„ç®—ç®¡ç†</div>
                    <button class="set-budget-btn" onclick="openBudgetModal()">è®¾ç½®</button>
                </div>
                <div class="budget-list" id="budgetList">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div class="empty-title">æš‚æ— é¢„ç®—</div>
                        <div class="empty-desc">è®¾ç½®é¢„ç®—å¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ¶ˆè´¹</div>
                    </div>
                </div>
            </div>

            <!-- æ—¥å†åŒºåŸŸ -->
            <div class="calendar-card">
                <div class="calendar-title">æ—¥å†è§†å›¾</div>
                <div class="mini-calendar">
                    <div class="calendar-week">
                        <div class="week-day sun">æ—¥</div>
                        <div class="week-day">ä¸€</div>
                        <div class="week-day">äºŒ</div>
                        <div class="week-day">ä¸‰</div>
                        <div class="week-day">å››</div>
                        <div class="week-day">äº”</div>
                        <div class="week-day">å…­</div>
                    </div>
                    <div class="calendar-days" id="miniCalendarDays"></div>
                </div>
                <button class="calendar-full-btn" onclick="openCalendarModal()">å®Œæ•´æ—¥å†</button>
            </div>

            <!-- è´¦å•åˆ—è¡¨ -->
            <div class="bills-section">
                <div class="bills-header">
                    <div class="bills-title">å½“æ—¥è´¦å•</div>
                    <div class="bills-filter">
                        <select class="filter-select" id="billFilter" onchange="filterBills()">
                            <option value="today">ä»Šæ—¥</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="month">æœ¬æœˆ</option>
                            <option value="all">å…¨éƒ¨</option>
                        </select>
                    </div>
                </div>
                <div class="bills-list" id="recentBillsList">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <div class="empty-title">æš‚æ— è´¦å•è®°å½•</div>
                        <div class="empty-desc">ç‚¹å‡»ä¸‹æ–¹+æŒ‰é’®å¼€å§‹è®°è´¦</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showPage('home')">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">é¦–é¡µ</span>
            </button>
            <button class="nav-item" onclick="showPage('stats')">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">ç»Ÿè®¡</span>
            </button>
            <button class="nav-item" onclick="openCalendarModal()">
                <span class="nav-icon">ğŸ“…</span>
                <span class="nav-text">æ—¥å†</span>
            </button>
            <button class="nav-item" onclick="openCategoryModal()">
                <span class="nav-icon">ğŸ·ï¸</span>
                <span class="nav-text">åˆ†ç±»</span>
            </button>
        </div>

        <!-- æ·»åŠ æŒ‰é’® -->
        <button class="add-btn" onclick="openBillModal()">+</button>

        <!-- è®°è´¦å¼¹çª— -->
        <div class="modal" id="billModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">è®°å½•è´¦å•</h3>
                    <button class="modal-close" onclick="closeBillModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <input type="number" class="amount-input" id="billAmount" placeholder="0.00" min="0.01" step="0.01">
                    
                    <div class="type-toggle">
                        <button class="type-btn active" onclick="setType('expense')">æ”¯å‡º</button>
                        <button class="type-btn" onclick="setType('income')">æ”¶å…¥</button>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">åˆ†ç±»ï¼ˆé•¿æŒ‰åˆ é™¤ï¼‰</label>
                        <div class="category-grid" id="categoryGrid"></div>
                        <button class="type-btn" onclick="openAddCateModal()" style="margin-top: 12px;">+ æ–°å¢åˆ†ç±»</button>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">æ—¥æœŸ</label>
                        <input type="date" class="date-input" id="billDate">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea class="textarea" id="billNote" placeholder="æ·»åŠ å¤‡æ³¨..." rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveBill()">ä¿å­˜</button>
                    <button class="modal-btn cancel-btn" onclick="closeBillModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- å®Œæ•´æ—¥å†å¼¹çª— -->
        <div class="modal" id="calendarModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">æ—¥å†</h3>
                    <button class="modal-close" onclick="closeCalendarModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="calendar-full">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">â€¹</button>
                            <div class="calendar-month" id="calendarMonth">2025å¹´12æœˆ</div>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">â€º</button>
                        </div>
                        
                        <div class="calendar-week">
                            <div class="week-day sun">æ—¥</div>
                            <div class="week-day">ä¸€</div>
                            <div class="week-day">äºŒ</div>
                            <div class="week-day">ä¸‰</div>
                            <div class="week-day">å››</div>
                            <div class="week-day">äº”</div>
                            <div class="week-day">å…­</div>
                        </div>
                        <div class="calendar-days-grid" id="calendarDaysGrid"></div>
                        
                        <div class="modal-footer" style="margin-top: 20px; border-top: 0.5px solid #E5E5EA;">
                            <button class="modal-btn save-btn" onclick="closeCalendarModal()">ç¡®å®š</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¢„ç®—è®¾ç½®å¼¹çª— -->
        <div class="modal" id="budgetModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">è®¾ç½®é¢„ç®—</h3>
                    <button class="modal-close" onclick="closeBudgetModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label class="input-label">é¢„ç®—å‘¨æœŸ</label>
                        <select class="select-input" id="budgetPeriod">
                            <option value="monthly">æœˆåº¦é¢„ç®—</option>
                            <option value="weekly">å‘¨åº¦é¢„ç®—</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">æ€»é¢„ç®—</label>
                        <input type="number" class="number-input" id="totalBudget" placeholder="0.00" min="0" step="0.01">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">åˆ†ç±»é¢„ç®—</label>
                        <div id="budgetCategoriesList"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveBudgets()">ä¿å­˜</button>
                    <button class="modal-btn cancel-btn" onclick="closeBudgetModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- åˆ†ç±»ç®¡ç†å¼¹çª— -->
        <div class="modal" id="categoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">åˆ†ç±»ç®¡ç†</h3>
                    <button class="modal-close" onclick="closeCategoryModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="category-list" id="categoryList">
                        <!-- åˆ†ç±»å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="type-btn" onclick="openAddCateModal()" style="width: 100%; margin-top: 16px;">+ æ·»åŠ æ–°åˆ†ç±»</button>
                </div>
            </div>
        </div>

        <!-- æ–°å¢åˆ†ç±»å¼¹çª— -->
        <div class="modal" id="addCateModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">æ–°å¢åˆ†ç±»</h3>
                    <button class="modal-close" onclick="closeAddCateModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label class="input-label">åˆ†ç±»åç§°</label>
                        <input type="text" class="text-input" id="newCateName" placeholder="ä¾‹å¦‚ï¼šé¤é¥®" maxlength="10">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">é€‰æ‹©å›¾æ ‡</label>
                        <div class="category-grid" id="iconSelector"></div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">åˆ†ç±»ç±»å‹</label>
                        <select class="select-input" id="newCateType">
                            <option value="expense">æ”¯å‡º</option>
                            <option value="income">æ”¶å…¥</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveNewCategory()">ç¡®è®¤æ·»åŠ </button>
                    <button class="modal-btn cancel-btn" onclick="closeAddCateModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡é¡µé¢ï¼ˆé€šè¿‡JSåˆ‡æ¢æ˜¾ç¤ºï¼‰ -->
        <div class="stats-page" id="statsPage" style="display: none;">
            <div class="chart-container">
                <div class="chart-title">æœˆåº¦æ”¶æ”¯è¶‹åŠ¿</div>
                <canvas id="trendChart" style="width: 100%; height: 250px;"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">æ”¯å‡ºåˆ†ç±»å æ¯”</div>
                <canvas id="pieChart" style="width: 100%; height: 250px;"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">é¢„ç®—æ‰§è¡Œæƒ…å†µ</div>
                <canvas id="budgetChart" style="width: 100%; height: 250px;"></canvas>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let password = '0517';
        let currentType = 'expense';
        let selectedCate = '';
        let longPressTimer = null;
        let categories = JSON.parse(localStorage.getItem('phoneCates')) || [
            'é¤é¥®ğŸœ', 'äº¤é€šğŸšŒ', 'å¨±ä¹ğŸ¬', 'å­¦ä¹ ğŸ“š',
            'è´­ç‰©ğŸ›ï¸', 'æˆ¿ç§ŸğŸ ', 'å·¥èµ„ğŸ’¼', 'å…¶ä»–ğŸ”§'
        ];
        
        const cateIcons = {
            'é¤é¥®': 'ğŸœ', 'äº¤é€š': 'ğŸšŒ', 'å¨±ä¹': 'ğŸ¬', 'å­¦ä¹ ': 'ğŸ“š',
            'è´­ç‰©': 'ğŸ›ï¸', 'æˆ¿ç§Ÿ': 'ğŸ ', 'å·¥èµ„': 'ğŸ’¼', 'å…¶ä»–': 'ğŸ”§',
            'æ—¥ç”¨': 'ğŸ§´', 'åŒ»ç–—': 'ğŸ’Š', 'æ—…è¡Œ': 'âœˆï¸', 'ç¤¾äº¤': 'ğŸ‘«'
        };
        
        let bills = JSON.parse(localStorage.getItem('phoneBills')) || [];
        let monthlyBudgets = JSON.parse(localStorage.getItem('monthlyBudgets')) || {};
        let currentCalendarDate = new Date();
        let selectedDate = new Date();
        
        // æ»‘åŠ¨ç›¸å…³å˜é‡ - ä¸¥æ ¼æ§åˆ¶
        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartTime = 0;
        let currentSwipeId = null;
        let isSwiping = false;
        const SWIPE_THRESHOLD = 40; // æ»‘åŠ¨é˜ˆå€¼é™ä½ï¼Œå‡å°‘è¯¯è§¦

        // ========== å·¥å…·å‡½æ•° ==========
        function formatDateToYMD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getCurrentMonthKey() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        // ========== å¯†ç é”åŠŸèƒ½ ==========
        function isNumberKey(evt) {
            const charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function nextInput(input) {
            const inputs = document.querySelectorAll('.password-input');
            const index = Array.from(inputs).indexOf(input);
            if (input.value && index < 3) {
                inputs[index + 1].focus();
            }
        }

        function checkPassword() {
            const inputs = document.querySelectorAll('.password-input');
            const inputPwd = Array.from(inputs).map(i => i.value).join('');
            
            if (inputPwd.length === 4) {
                if (inputPwd === password) {
                    document.getElementById('lockScreen').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'block';
                    updateNavDate();
                    initHomePage();
                } else {
                    document.getElementById('alertText').textContent = 'å¯†ç é”™è¯¯';
                    document.getElementById('customAlert').style.display = 'flex';
                }
            }
        }

        function closeAlert() {
            document.getElementById('customAlert').style.display = 'none';
            const inputs = document.querySelectorAll('.password-input');
            inputs.forEach(input => input.value = '');
            inputs[0].focus();
        }

        function updateNavDate() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            const dateStr = now.toLocaleDateString('zh-CN', options);
            document.getElementById('navDate').textContent = dateStr;
        }

        // ========== ä¸»é¡µåˆå§‹åŒ– ==========
        function initHomePage() {
            updateStats();
            renderBudgetList();
            renderMiniCalendar();
            renderBillList();
        }

        function updateStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            let totalExpense = 0;
            let totalIncome = 0;
            
            bills.forEach(bill => {
                const billDate = new Date(bill.date);
                if (billDate.getMonth() === currentMonth && billDate.getFullYear() === currentYear) {
                    if (bill.type === 'expense') {
                        totalExpense += bill.amount;
                    } else {
                        totalIncome += bill.amount;
                    }
                }
            });
            
            const balance = totalIncome - totalExpense;
            
            document.getElementById('monthExpense').textContent = `Â¥${totalExpense.toFixed(2)}`;
            document.getElementById('monthIncome').textContent = `Â¥${totalIncome.toFixed(2)}`;
            document.getElementById('accountBalance').textContent = `Â¥${balance.toFixed(2)}`;
        }

        // ========== é¢„ç®—ç®¡ç† ==========
        function openBudgetModal() {
            renderBudgetSetList();
            document.getElementById('budgetModal').classList.add('show');
        }

        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.remove('show');
        }

        function renderBudgetSetList() {
            const budgetCategoriesList = document.getElementById('budgetCategoriesList');
            budgetCategoriesList.innerHTML = '';
            
            const monthKey = getCurrentMonthKey();
            if (!monthlyBudgets[monthKey]) {
                monthlyBudgets[monthKey] = {};
            }
            
            categories.forEach(cate => {
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                const budgetItem = document.createElement('div');
                budgetItem.className = 'budget-item';
                
                budgetItem.innerHTML = `
                    <div class="budget-cate">
                        <div class="budget-cate-icon">${icon}</div>
                        <div class="budget-cate-name">${cateName}</div>
                    </div>
                    <input type="number" class="number-input" style="width: 80px; text-align: right;" 
                           data-cate="${cate}" 
                           value="${monthlyBudgets[monthKey][cate] || ''}" 
                           placeholder="0" min="0" step="0.01">
                `;
                
                budgetCategoriesList.appendChild(budgetItem);
            });
        }

        function renderBudgetList() {
            const budgetList = document.getElementById('budgetList');
            const monthKey = getCurrentMonthKey();
            
            if (!monthlyBudgets[monthKey]) {
                budgetList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div class="empty-title">æš‚æ— é¢„ç®—</div>
                        <div class="empty-desc">è®¾ç½®é¢„ç®—å¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ¶ˆè´¹</div>
                    </div>
                `;
                return;
            }
            
            const budgetEntries = Object.entries(monthlyBudgets[monthKey])
                .filter(([_, amount]) => amount > 0);
            
            if (budgetEntries.length === 0) {
                budgetList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div class="empty-title">æš‚æ— é¢„ç®—</div>
                        <div class="empty-desc">è®¾ç½®é¢„ç®—å¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ¶ˆè´¹</div>
                    </div>
                `;
                return;
            }
            
            let budgetItemsHTML = '';
            
            budgetEntries.forEach(([cate, budgetAmount]) => {
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                // è®¡ç®—å·²ä½¿ç”¨é‡‘é¢
                let usedAmount = 0;
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                bills.forEach(bill => {
                    const billDate = new Date(bill.date);
                    if (billDate.getMonth() === currentMonth && 
                        billDate.getFullYear() === currentYear &&
                        bill.category === cate &&
                        bill.type === 'expense') {
                        usedAmount += bill.amount;
                    }
                });
                
                const remainAmount = budgetAmount - usedAmount;
                const percentage = Math.round((usedAmount / budgetAmount) * 100);
                
                budgetItemsHTML += `
                    <div class="budget-item">
                        <div class="budget-cate">
                            <div class="budget-cate-icon">${icon}</div>
                            <div class="budget-cate-name">${cateName}</div>
                        </div>
                        <div class="budget-usage">
                            <div class="budget-used ${remainAmount < 0 ? 'budget-over' : ''}">
                                Â¥${usedAmount.toFixed(2)}/${budgetAmount.toFixed(2)}
                            </div>
                            <div class="budget-remain ${remainAmount < 0 ? 'budget-over' : ''}">
                                ${remainAmount < 0 ? 'è¶…æ”¯' : 'å‰©ä½™'} Â¥${Math.abs(remainAmount).toFixed(2)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            budgetList.innerHTML = budgetItemsHTML;
        }

        function saveBudgets() {
            const monthKey = getCurrentMonthKey();
            const inputs = document.querySelectorAll('#budgetCategoriesList input');
            
            inputs.forEach(input => {
                const cate = input.dataset.cate;
                const value = parseFloat(input.value) || 0;
                monthlyBudgets[monthKey][cate] = value > 0 ? value : null;
            });
            
            localStorage.setItem('monthlyBudgets', JSON.stringify(monthlyBudgets));
            closeBudgetModal();
            renderBudgetList();
        }

        // ========== æ—¥å†åŠŸèƒ½ ==========
        function openCalendarModal() {
            document.getElementById('calendarModal').classList.add('show');
            renderCalendar();
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').classList.remove('show');
        }

        function renderMiniCalendar() {
            const year = selectedDate.getFullYear();
            const month = selectedDate.getMonth();
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();
            
            const calendarDays = document.getElementById('miniCalendarDays');
            calendarDays.innerHTML = '';
            
            // æ·»åŠ ä¸Šä¸ªæœˆçš„å ä½æ—¥æœŸ
            for (let i = 0; i < firstDay; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = prevMonthDays - firstDay + i + 1;
                calendarDays.appendChild(dayElement);
            }
            
            // è·å–æœ‰è´¦å•çš„æ—¥æœŸ
            const billDates = getBillDatesInMonth(year, month);
            
            // æ·»åŠ å½“æœˆæ—¥æœŸ
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                const today = new Date();
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è´¦å•
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                if (billDates.includes(dateStr)) {
                    dayElement.classList.add('has-bill');
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é€‰ä¸­æ—¥æœŸ
                if (i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                    dayElement.classList.add('active');
                }
                
                dayElement.textContent = i;
                dayElement.dataset.date = dateStr;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                dayElement.addEventListener('click', function() {
                    const [y, m, d] = this.dataset.date.split('-').map(Number);
                    selectedDate = new Date(y, m - 1, d);
                    renderMiniCalendar();
                    renderBillList();
                });
                
                calendarDays.appendChild(dayElement);
            }
            
            // æ›´æ–°æ—¥å†æ ‡é¢˜
            document.getElementById('calendarMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();
            
            const calendarDaysGrid = document.getElementById('calendarDaysGrid');
            calendarDaysGrid.innerHTML = '';
            
            // æ·»åŠ ä¸Šä¸ªæœˆçš„å ä½æ—¥æœŸ
            for (let i = 0; i < firstDay; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day-large';
                dayElement.textContent = prevMonthDays - firstDay + i + 1;
                calendarDaysGrid.appendChild(dayElement);
            }
            
            // è·å–æœ‰è´¦å•çš„æ—¥æœŸ
            const billDates = getBillDatesInMonth(year, month);
            
            // æ·»åŠ å½“æœˆæ—¥æœŸ
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day-large';
                
                const today = new Date();
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                if (billDates.includes(dateStr)) {
                    dayElement.classList.add('has-bill');
                }
                
                if (i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                    dayElement.classList.add('active');
                }
                
                dayElement.textContent = i;
                dayElement.dataset.date = dateStr;
                
                dayElement.addEventListener('click', function() {
                    const [y, m, d] = this.dataset.date.split('-').map(Number);
                    selectedDate = new Date(y, m - 1, d);
                    renderCalendar();
                });
                
                calendarDaysGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            const newMonth = currentCalendarDate.getMonth() + direction;
            currentCalendarDate = new Date(currentCalendarDate.getFullYear(), newMonth, 1);
            renderCalendar();
        }

        function getBillDatesInMonth(year, month) {
            const billDates = [];
            const monthStr = String(month + 1).padStart(2, '0');
            
            bills.forEach(bill => {
                if (bill.date.startsWith(`${year}-${monthStr}`)) {
                    billDates.push(bill.date);
                }
            });
            
            return [...new Set(billDates)];
        }

        // ========== è´¦å•ç®¡ç† ==========
        function openBillModal() {
            const today = new Date();
            document.getElementById('billModal').classList.add('show');
            document.getElementById('billAmount').value = '';
            document.getElementById('billDate').value = formatDateToYMD(today);
            document.getElementById('billNote').value = '';
            setType('expense');
            renderCategoryGrid();
            document.getElementById('billAmount').focus();
        }

        function closeBillModal() {
            document.getElementById('billModal').classList.remove('show');
            selectedCate = '';
        }

        function setType(type) {
            currentType = type;
            const buttons = document.querySelectorAll('.type-btn');
            buttons.forEach(btn => {
                if (btn.textContent.toLowerCase() === type) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            renderCategoryGrid();
        }

        function renderCategoryGrid() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';
            
            categories.forEach(cate => {
                const cateItem = document.createElement('div');
                cateItem.className = `category-item ${selectedCate === cate ? 'active' : ''}`;
                
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                cateItem.innerHTML = `
                    <div class="category-icon">${icon}</div>
                    <div class="category-name">${cateName}</div>
                `;
                
                // ç‚¹å‡»é€‰æ‹©åˆ†ç±»
                cateItem.addEventListener('click', function() {
                    selectedCate = cate;
                    renderCategoryGrid();
                });
                
                // é•¿æŒ‰åˆ é™¤åˆ†ç±»
                cateItem.addEventListener('touchstart', function(e) {
                    longPressTimer = setTimeout(() => {
                        if (confirm(`ç¡®å®šè¦åˆ é™¤${cateName}åˆ†ç±»å—ï¼Ÿ`)) {
                            const index = categories.indexOf(cate);
                            if (index > -1) {
                                categories.splice(index, 1);
                                localStorage.setItem('phoneCates', JSON.stringify(categories));
                                renderCategoryGrid();
                            }
                        }
                    }, 800);
                });
                
                cateItem.addEventListener('touchend', function() {
                    clearTimeout(longPressTimer);
                });
                
                categoryGrid.appendChild(cateItem);
            });
        }

        function saveBill() {
            const amount = parseFloat(document.getElementById('billAmount').value);
            const date = document.getElementById('billDate').value;
            const note = document.getElementById('billNote').value;
            
            if (isNaN(amount) || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
                return;
            }
            
            if (!selectedCate) {
                alert('è¯·é€‰æ‹©åˆ†ç±»');
                return;
            }
            
            const newBill = {
                id: Date.now().toString(),
                amount: amount,
                type: currentType,
                category: selectedCate,
                date: date,
                note: note,
                createdAt: new Date().toISOString()
            };
            
            bills.unshift(newBill);
            localStorage.setItem('phoneBills', JSON.stringify(bills));
            
            closeBillModal();
            renderBillList();
            renderBudgetList();
            renderMiniCalendar();
            updateStats();
        }

        // ========== è´¦å•åˆ—è¡¨ - ä¼˜åŒ–çš„æ»‘åŠ¨åˆ é™¤ ==========
        function renderBillList() {
            const billsList = document.getElementById('recentBillsList');
            const filter = document.getElementById('billFilter').value;
            const targetDate = formatDateToYMD(selectedDate);
            
            let filteredBills = bills;
            
            switch(filter) {
                case 'today':
                    filteredBills = bills.filter(bill => bill.date === targetDate);
                    break;
                case 'week':
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    filteredBills = bills.filter(bill => new Date(bill.date) >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    filteredBills = bills.filter(bill => new Date(bill.date) >= monthAgo);
                    break;
                case 'all':
                    // æ‰€æœ‰è´¦å•
                    break;
            }
            
            if (filteredBills.length === 0) {
                billsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <div class="empty-title">æš‚æ— è´¦å•è®°å½•</div>
                        <div class="empty-desc">ç‚¹å‡»ä¸‹æ–¹+æŒ‰é’®å¼€å§‹è®°è´¦</div>
                    </div>
                `;
                return;
            }
            
            let billsHTML = '';
            
            filteredBills.forEach(bill => {
                const cateName = bill.category.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || bill.category.replace(cateName, '');
                const time = new Date(bill.createdAt).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                const date = new Date(bill.date);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                let dateDisplay = '';
                if (date.toDateString() === today.toDateString()) {
                    dateDisplay = 'ä»Šå¤©';
                } else if (date.toDateString() === yesterday.toDateString()) {
                    dateDisplay = 'æ˜¨å¤©';
                } else {
                    dateDisplay = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
                }
                
                billsHTML += `
                    <div class="bill-item" data-id="${bill.id}" 
                         ontouchstart="handleTouchStart(event, '${bill.id}')"
                         ontouchmove="handleTouchMove(event, '${bill.id}')"
                         ontouchend="handleTouchEnd(event, '${bill.id}')">
                        <div class="bill-left">
                            <div class="bill-icon">${icon}</div>
                            <div class="bill-info">
                                <div class="bill-category">${cateName}</div>
                                <div class="bill-date">${dateDisplay} ${time}</div>
                                ${bill.note ? `<div style="font-size: 13px; color: #8E8E93; margin-top: 2px;">${bill.note}</div>` : ''}
                            </div>
                        </div>
                        <div class="bill-amount ${bill.type}">${bill.type === 'expense' ? '-' : '+'}Â¥${bill.amount.toFixed(2)}</div>
                        <div class="bill-actions">
                            <button class="action-btn edit-btn" onclick="editBill('${bill.id}')">ç¼–è¾‘</button>
                            <button class="action-btn delete-btn" onclick="deleteBill('${bill.id}')">åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });
            
            billsList.innerHTML = billsHTML;
        }

        // ä¼˜åŒ–åçš„è§¦æ‘¸å¤„ç† - ä¸¥æ ¼æ§åˆ¶æ»‘åŠ¨
        function handleTouchStart(e, billId) {
            if (isSwiping && currentSwipeId !== billId) return;
            
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            touchStartTime = Date.now();
            currentSwipeId = billId;
            
            const billItem = document.querySelector(`.bill-item[data-id="${billId}"]`);
            if (billItem) {
                billItem.classList.add('swiping');
            }
        }

        function handleTouchMove(e, billId) {
            if (currentSwipeId !== billId) return;
            
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartX;
            const deltaY = touch.clientY - touchStartY;
            
            // å¦‚æœå‚ç›´æ»šåŠ¨è¶…è¿‡æ°´å¹³æ»šåŠ¨ï¼Œè¯´æ˜ç”¨æˆ·æ„å›¾æ˜¯å‚ç›´æ»šåŠ¨ï¼Œå–æ¶ˆæ»‘åŠ¨
            if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > 10) {
                isSwiping = false;
                resetSwipe(billId);
                return;
            }
            
            // åªå…è®¸å‘å·¦æ»‘åŠ¨
            if (deltaX < 0 && Math.abs(deltaX) > 10) {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
                isSwiping = true;
                
                const billItem = document.querySelector(`.bill-item[data-id="${billId}"]`);
                if (billItem) {
                    // é™åˆ¶æœ€å¤§æ»‘åŠ¨è·ç¦»
                    const translateX = Math.max(deltaX, -120);
                    billItem.style.transform = `translateX(${translateX}px)`;
                    
                    // æ»‘åŠ¨è¶…è¿‡é˜ˆå€¼æ—¶æ˜¾ç¤ºæŒ‰é’®
                    if (Math.abs(deltaX) > SWIPE_THRESHOLD) {
                        billItem.classList.add('swiped');
                    } else {
                        billItem.classList.remove('swiped');
                    }
                }
            }
        }

        function handleTouchEnd(e, billId) {
            if (currentSwipeId !== billId) return;
            
            const touchTime = Date.now() - touchStartTime;
            const touch = e.changedTouches[0];
            const deltaX = touch.clientX - touchStartX;
            
            const billItem = document.querySelector(`.bill-item[data-id="${billId}"]`);
            if (!billItem) return;
            
            billItem.classList.remove('swiping');
            
            // å¿«é€Ÿæ»‘åŠ¨æˆ–æ»‘åŠ¨è·ç¦»è¶³å¤Ÿæ—¶ï¼Œä¿æŒæ»‘åŠ¨çŠ¶æ€
            if (isSwiping && (Math.abs(deltaX) > SWIPE_THRESHOLD || touchTime < 300)) {
                billItem.style.transform = 'translateX(-120px)';
                billItem.classList.add('swiped');
            } else {
                // å¦åˆ™å¤ä½
                resetSwipe(billId);
            }
            
            // é‡ç½®çŠ¶æ€
            setTimeout(() => {
                if (currentSwipeId === billId) {
                    isSwiping = false;
                    currentSwipeId = null;
                }
            }, 100);
        }

        function resetSwipe(billId) {
            const billItem = document.querySelector(`.bill-item[data-id="${billId}"]`);
            if (billItem) {
                billItem.style.transform = 'translateX(0)';
                billItem.classList.remove('swiped');
            }
            currentSwipeId = null;
            isSwiping = false;
        }

        function editBill(billId) {
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;
            
            openBillModal();
            
            // å¡«å……æ•°æ®
            document.getElementById('billAmount').value = bill.amount;
            document.getElementById('billDate').value = bill.date;
            document.getElementById('billNote').value = bill.note || '';
            setType(bill.type);
            selectedCate = bill.category;
            
            // ä¿®æ”¹ä¿å­˜æŒ‰é’®è¡Œä¸º
            const saveBtn = document.querySelector('#billModal .save-btn');
            const originalOnclick = saveBtn.onclick;
            
            saveBtn.onclick = function() {
                // æ›´æ–°è´¦å•
                const amount = parseFloat(document.getElementById('billAmount').value);
                const date = document.getElementById('billDate').value;
                const note = document.getElementById('billNote').value;
                
                if (isNaN(amount) || amount <= 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
                    return;
                }
                
                if (!selectedCate) {
                    alert('è¯·é€‰æ‹©åˆ†ç±»');
                    return;
                }
                
                bill.amount = amount;
                bill.type = currentType;
                bill.category = selectedCate;
                bill.date = date;
                bill.note = note;
                
                localStorage.setItem('phoneBills', JSON.stringify(bills));
                closeBillModal();
                renderBillList();
                renderBudgetList();
                updateStats();
                
                // æ¢å¤åŸå§‹è¡Œä¸º
                saveBtn.onclick = originalOnclick;
            };
            
            renderCategoryGrid();
            resetSwipe(billId);
        }

        function deleteBill(billId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è´¦å•å—ï¼Ÿ')) {
                bills = bills.filter(bill => bill.id !== billId);
                localStorage.setItem('phoneBills', JSON.stringify(bills));
                renderBillList();
                renderBudgetList();
                updateStats();
                renderMiniCalendar();
            } else {
                resetSwipe(billId);
            }
        }

        function filterBills() {
            renderBillList();
        }

        // ========== é¡µé¢åˆ‡æ¢ ==========
        function showPage(pageId) {
            const mainContent = document.getElementById('mainContent');
            const statsPage = document.getElementById('statsPage');
            const navItems = document.querySelectorAll('.nav-item');
            
            if (pageId === 'home') {
                mainContent.style.display = 'block';
                statsPage.style.display = 'none';
                navItems[0].classList.add('active');
                navItems[1].classList.remove('active');
            } else if (pageId === 'stats') {
                mainContent.style.display = 'none';
                statsPage.style.display = 'block';
                navItems[0].classList.remove('active');
                navItems[1].classList.add('active');
                // è¿™é‡Œå¯ä»¥åˆå§‹åŒ–å›¾è¡¨
            }
        }

        // ========== åˆ†ç±»ç®¡ç† ==========
        function openCategoryModal() {
            renderCategoryList();
            document.getElementById('categoryModal').classList.add('show');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('show');
        }

        function openAddCateModal() {
            document.getElementById('addCateModal').classList.add('show');
            document.getElementById('newCateName').value = '';
            renderIconSelector();
        }

        function closeAddCateModal() {
            document.getElementById('addCateModal').classList.remove('show');
        }

        function renderCategoryList() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            categories.forEach((cate, index) => {
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                const categoryItem = document.createElement('div');
                categoryItem.className = 'budget-item';
                categoryItem.innerHTML = `
                    <div class="budget-cate">
                        <div class="budget-cate-icon">${icon}</div>
                        <div class="budget-cate-name">${cateName}</div>
                    </div>
                    <div>
                        <button class="action-btn edit-btn" onclick="editCategory(${index})" style="margin-right: 8px;">ç¼–è¾‘</button>
                        <button class="action-btn delete-btn" onclick="deleteCategory(${index})">åˆ é™¤</button>
                    </div>
                `;
                categoryList.appendChild(categoryItem);
            });
        }

        function renderIconSelector() {
            const iconSelector = document.getElementById('iconSelector');
            iconSelector.innerHTML = '';
            
            const icons = ['ğŸœ', 'ğŸšŒ', 'ğŸ¬', 'ğŸ“š', 'ğŸ›ï¸', 'ğŸ ', 'ğŸ’¼', 'ğŸ”§', 'ğŸ§´', 'ğŸ’Š', 'âœˆï¸', 'ğŸ‘«'];
            
            icons.forEach(icon => {
                const iconItem = document.createElement('div');
                iconItem.className = 'category-item';
                iconItem.innerHTML = `
                    <div class="category-icon">${icon}</div>
                    <div class="category-name"></div>
                `;
                iconItem.addEventListener('click', function() {
                    // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('#iconSelector .category-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                    this.classList.add('active');
                });
                iconSelector.appendChild(iconItem);
            });
        }

        function editCategory(index) {
            const cate = categories[index];
            const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
            
            openAddCateModal();
            document.getElementById('newCateName').value = cateName;
            
            // ä¿®æ”¹ä¿å­˜æŒ‰é’®è¡Œä¸º
            const saveBtn = document.querySelector('#addCateModal .save-btn');
            const originalOnclick = saveBtn.onclick;
            
            saveBtn.onclick = function() {
                const newName = document.getElementById('newCateName').value.trim();
                const selectedIcon = document.querySelector('#iconSelector .category-item.active .category-icon');
                
                if (!newName) {
                    alert('è¯·è¾“å…¥åˆ†ç±»åç§°');
                    return;
                }
                
                if (!selectedIcon) {
                    alert('è¯·é€‰æ‹©å›¾æ ‡');
                    return;
                }
                
                const icon = selectedIcon.textContent;
                categories[index] = newName + icon;
                localStorage.setItem('phoneCates', JSON.stringify(categories));
                
                closeAddCateModal();
                renderCategoryList();
                renderCategoryGrid();
                
                // æ¢å¤åŸå§‹è¡Œä¸º
                saveBtn.onclick = originalOnclick;
                saveBtn.textContent = 'ç¡®è®¤æ·»åŠ ';
            };
            
            saveBtn.textContent = 'æ›´æ–°åˆ†ç±»';
        }

        function deleteCategory(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿ')) {
                categories.splice(index, 1);
                localStorage.setItem('phoneCates', JSON.stringify(categories));
                renderCategoryList();
                renderCategoryGrid();
            }
        }

        function saveNewCategory() {
            const newName = document.getElementById('newCateName').value.trim();
            const selectedIcon = document.querySelector('#iconSelector .category-item.active .category-icon');
            
            if (!newName) {
                alert('è¯·è¾“å…¥åˆ†ç±»åç§°');
                return;
            }
            
            if (!selectedIcon) {
                alert('è¯·é€‰æ‹©å›¾æ ‡');
                return;
            }
            
            const icon = selectedIcon.textContent;
            categories.push(newName + icon);
            localStorage.setItem('phoneCates', JSON.stringify(categories));
            
            closeAddCateModal();
            renderCategoryList();
            renderCategoryGrid();
        }

        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            // å¯†ç è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦
            const passwordInputs = document.querySelectorAll('.password-input');
            if (passwordInputs.length > 0) {
                passwordInputs[0].focus();
            }
            
            // ç›‘å¬å¯†ç è¾“å…¥æ¡†å˜åŒ–
            passwordInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const inputs = document.querySelectorAll('.password-input');
                    const values = Array.from(inputs).map(i => i.value);
                    if (values.every(v => v !== '')) {
                        checkPassword();
                    }
                });
            });
            
            // é˜²æ­¢é¡µé¢å¼¹æ€§æ»šåŠ¨
            document.addEventListener('touchmove', function(e) {
                // åªæœ‰åœ¨éœ€è¦æ»šåŠ¨çš„å†…å®¹åŒºåŸŸæ‰å…è®¸æ»šåŠ¨
                const mainContent = document.getElementById('mainContent');
                const statsPage = document.getElementById('statsPage');
                const target = e.target;
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å¯æ»šåŠ¨åŒºåŸŸå†…
                const isInScrollable = mainContent.contains(target) || statsPage.contains(target);
                
                // å¦‚æœä¸æ˜¯åœ¨å¯æ»šåŠ¨åŒºåŸŸå†…ï¼Œå¹¶ä¸”ä¸æ˜¯è´¦å•æ»‘åŠ¨ï¼Œé˜»æ­¢é»˜è®¤æ»šåŠ¨
                if (!isInScrollable && !isSwiping) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // åˆå§‹åŒ–æ—¥æœŸæ˜¾ç¤º
            updateNavDate();
        });
    </script>
</body>
</html>
