<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å¦ä¸€ä¸ªæˆ‘</title>
    <style>
        /* æ ¸å¿ƒæ ·å¼ï¼ˆåªåŠ åˆ é™¤/æ·»åŠ åˆ†ç±»çš„æ ·å¼ï¼‰ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #F2F2F7; padding-bottom: 80px; }
        .add-btn {
            position: fixed; bottom: 28px; right: 24px;
            width: 56px; height: 56px; border-radius: 50%;
            background: #000; color: #fff; font-size: 32px;
            border: none; cursor: pointer;
        }
        /* å¯†ç é” */
        .lock-screen {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: #F2F2F7; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .password-inputs { display: flex; gap: 16px; margin-top: 20px; }
        .password-input {
            width: 48px; height: 48px; border: 2px solid #ccc;
            border-radius: 8px; text-align: center; font-size: 24px;
        }
        /* è®°è´¦å¼¹çª— */
        .modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
        }
        .modal.show { display: block; }
        .modal-content {
            position: fixed; bottom:0; left:0; right:0;
            background: #fff; border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 20px;
        }
        /* åˆ†ç±»æ ·å¼ï¼ˆæ–°å¢åˆ é™¤æŒ‰é’®ï¼‰ */
        .category-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 10px; margin: 20px 0;
        }
        .category-item {
            display: flex; flex-direction: column;
            align-items: center; position: relative;
        }
        .category-icon {
            width: 40px; height: 40px; background: #f2f2f7;
            border-radius: 8px; display: flex;
            align-items: center; justify-content: center;
            margin-bottom: 5px;
        }
        .category-item.active .category-icon {
            background: #000; color: #fff;
        }
        /* æ–°å¢ï¼šåˆ†ç±»åˆ é™¤æŒ‰é’® */
        .cate-del {
            position: absolute; top: -5px; right: 10px;
            width: 16px; height: 16px; background: #ff3b30;
            color: #fff; font-size: 12px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; display: none;
        }
        .category-item:hover .cate-del { display: block; } /* é¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºåˆ é™¤ */
        /* æ–°å¢ï¼šæ·»åŠ åˆ†ç±»æŒ‰é’® */
        .add-cate-btn {
            width: 100%; padding: 8px; border: 1px dashed #ccc;
            border-radius: 8px; background: #f9f9f9;
            cursor: pointer; margin: 10px 0;
        }
        /* æ–°å¢ï¼šæ·»åŠ åˆ†ç±»å¼¹çª— */
        .add-cate-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            align-items: center; justify-content: center;
        }
        .add-cate-modal.show { display: flex; }
        .add-cate-content {
            background: #fff; padding: 20px; border-radius: 16px;
            width: 80%; max-width: 300px;
        }
        .add-cate-input {
            width: 100%; padding: 8px; border: 1px solid #ccc;
            border-radius: 8px; margin: 10px 0;
        }
    </style>
</head>
<body>
    <!-- å¯†ç é” -->
    <div class="lock-screen" id="lockScreen">
        <div>è¯·è¾“å…¥å¯†ç ï¼ˆ1234ï¼‰</div>
        <div class="password-inputs">
            <input type="password" class="pwd" maxlength="1" oninput="next(this)">
            <input type="password" class="pwd" maxlength="1" oninput="next(this)">
            <input type="password" class="pwd" maxlength="1" oninput="next(this)">
            <input type="password" class="pwd" maxlength="1" oninput="check()">
        </div>
    </div>

    <!-- ä¸»é¡µé¢ -->
    <div id="main" style="display: none;">
        <h1 style="padding: 20px;">å¦ä¸€ä¸ªæˆ‘</h1>
        <button class="add-btn" onclick="openModal()">+</button>

        <!-- è®°è´¦å¼¹çª— -->
        <div class="modal" id="billModal">
            <div class="modal-content">
                <h2>è®°ä¸€ç¬”</h2>
                <input type="number" id="amount" placeholder="è¾“å…¥é‡‘é¢" style="width:100%; font-size:24px; text-align:center; margin:10px 0;">
                <div style="display:flex; gap:10px; margin:10px 0;">
                    <button onclick="setType('expense')" style="flex:1; padding:8px; background:#000; color:#fff; border:none; border-radius:20px;">æ”¯å‡º</button>
                    <button onclick="setType('income')" style="flex:1; padding:8px; border:1px solid #ccc; border-radius:20px;">æ”¶å…¥</button>
                </div>
                <!-- åˆ†ç±»åŒºåŸŸï¼ˆæ–°å¢æ·»åŠ æŒ‰é’®ï¼‰ -->
                <div>
                    <div>åˆ†ç±»</div>
                    <div class="category-grid" id="categoryGrid">
                        <!-- åˆ†ç±»ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                    <!-- æ–°å¢ï¼šæ·»åŠ åˆ†ç±»æŒ‰é’® -->
                    <button class="add-cate-btn" onclick="openAddCateModal()">+ æ–°å¢åˆ†ç±»</button>
                </div>
                <button onclick="save()" style="width:100%; padding:10px; background:#000; color:#fff; border:none; border-radius:10px; margin-top:10px;">ä¿å­˜</button>
                <button onclick="closeModal()" style="width:100%; padding:10px; margin-top:10px; border:none; background:#eee; border-radius:10px;">å…³é—­</button>
            </div>
        </div>

        <!-- æ–°å¢ï¼šæ·»åŠ åˆ†ç±»å¼¹çª— -->
        <div class="add-cate-modal" id="addCateModal">
            <div class="add-cate-content">
                <h3>æ–°å¢åˆ†ç±»</h3>
                <input type="text" id="newCateName" placeholder="æ¯”å¦‚ï¼šå¥¶èŒ¶ã€è¯è´¹" class="add-cate-input">
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button onclick="saveNewCate()" style="flex:1; padding:8px; background:#000; color:#fff; border:none; border-radius:8px;">ç¡®è®¤</button>
                    <button onclick="closeAddCateModal()" style="flex:1; padding:8px; border:1px solid #ccc; border-radius:8px;">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼ˆåˆ†ç±»å­˜åœ¨æœ¬åœ°å­˜å‚¨ï¼Œæ°¸ä¹…ä¿å­˜ï¼‰
        let pwd = '1234';
        let currentType = 'expense';
        let selectedCate = '';
        // åˆå§‹åŒ–åˆ†ç±»ï¼šä¼˜å…ˆè¯»æœ¬åœ°å­˜å‚¨ï¼Œæ²¡æœ‰å°±ç”¨é»˜è®¤
        let cates = JSON.parse(localStorage.getItem('myCates')) || ['é¤é¥®ğŸœ','äº¤é€šğŸšŒ','å¨±ä¹ğŸ¬','å­¦ä¹ ğŸ“š','è´­ç‰©ğŸ›ï¸','æˆ¿ç§ŸğŸ ','å·¥èµ„ğŸ’¼','å…¶ä»–ğŸ”§'];

        // å¯†ç ç›¸å…³
        function next(input) {
            const inputs = document.querySelectorAll('.pwd');
            const idx = Array.from(inputs).indexOf(input);
            if(input.value && idx < 3) inputs[idx+1].focus();
        }
        function check() {
            const inputs = document.querySelectorAll('.pwd');
            const val = Array.from(inputs).map(i=>i.value).join('');
            if(val === pwd) {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('main').style.display = 'block';
            } else {
                alert('å¯†ç é”™ï¼');
                inputs.forEach(i=>i.value='');
                inputs[0].focus();
            }
        }

        // è®°è´¦å¼¹çª—
        function openModal() {
            renderCates(); // æ‰“å¼€å¼¹çª—æ—¶æ¸²æŸ“åˆ†ç±»
            document.getElementById('billModal').classList.add('show');
        }
        function closeModal() {
            document.getElementById('billModal').classList.remove('show');
            document.getElementById('amount').value = '';
        }

        // æ ¸å¿ƒï¼šæ¸²æŸ“åˆ†ç±»ï¼ˆæ–°å¢åˆ é™¤æŒ‰é’®ï¼‰
        function renderCates() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = ''; // æ¸…ç©º
            // å¾ªç¯ç”Ÿæˆæ¯ä¸ªåˆ†ç±»ï¼ˆå¸¦åˆ é™¤æŒ‰é’®ï¼‰
            cates.forEach((cate, idx) => {
                const item = document.createElement('div');
                item.className = 'category-item';
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
                if(idx === 0) item.classList.add('active');
                // åˆ†ç±»HTMLï¼ˆæ–°å¢åˆ é™¤å°å‰å·ï¼‰
                item.innerHTML = `
                    <div class="cate-del" onclick="delCate(${idx})">Ã—</div>
                    <div class="category-icon">${cate}</div>
                `;
                // ç‚¹å‡»åˆ†ç±»é€‰ä¸­
                item.onclick = (e) => {
                    // ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶ï¼Œä¸è§¦å‘é€‰ä¸­
                    if(e.target.classList.contains('cate-del')) return;
                    document.querySelectorAll('.category-item').forEach(i=>i.classList.remove('active'));
                    item.classList.add('active');
                    selectedCate = cate;
                };
                grid.appendChild(item);
            });
            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
            selectedCate = cates[0];
            // ä¿å­˜åˆ†ç±»åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('myCates', JSON.stringify(cates));
        }

        // æ–°å¢ï¼šæ‰“å¼€æ·»åŠ åˆ†ç±»å¼¹çª—
        function openAddCateModal() {
            document.getElementById('addCateModal').classList.add('show');
            document.getElementById('newCateName').focus();
        }
        // æ–°å¢ï¼šå…³é—­æ·»åŠ åˆ†ç±»å¼¹çª—
        function closeAddCateModal() {
            document.getElementById('addCateModal').classList.remove('show');
            document.getElementById('newCateName').value = '';
        }
        // æ–°å¢ï¼šä¿å­˜æ–°åˆ†ç±»
        function saveNewCate() {
            const newCate = document.getElementById('newCateName').value.trim();
            if(!newCate) {
                alert('è¯·è¾“å…¥åˆ†ç±»åç§°ï¼');
                return;
            }
            if(cates.includes(newCate)) {
                alert('è¿™ä¸ªåˆ†ç±»å·²ç»å­˜åœ¨å•¦ï¼');
                return;
            }
            // ç»™æ–°åˆ†ç±»åŠ ä¸ªéšæœºemojiï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥è®©ç”¨æˆ·è‡ªå·±åŠ ï¼‰
            const emojis = ['ğŸ¥¤','ğŸ“±','â˜•','ğŸ','ğŸš—','ğŸ’„','ğŸ“¦','ğŸ®'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            cates.push(newCate + randomEmoji); // æ¯”å¦‚è¾“å…¥â€œå¥¶èŒ¶â€â†’å˜æˆâ€œå¥¶èŒ¶ğŸ¥¤â€
            // é‡æ–°æ¸²æŸ“åˆ†ç±»+å…³é—­å¼¹çª—
            renderCates();
            closeAddCateModal();
            alert(`æ–°å¢åˆ†ç±»æˆåŠŸï¼š${newCate + randomEmoji}`);
        }

        // æ–°å¢ï¼šåˆ é™¤åˆ†ç±»
        function delCate(idx) {
            if(cates.length <= 1) {
                alert('è‡³å°‘ä¿ç•™1ä¸ªåˆ†ç±»å“¦ï¼');
                return;
            }
            const delCateName = cates[idx];
            if(confirm(`ç¡®å®šåˆ é™¤â€œ${delCateName}â€åˆ†ç±»å—ï¼Ÿ`)) {
                cates.splice(idx, 1); // åˆ é™¤å¯¹åº”ç´¢å¼•çš„åˆ†ç±»
                renderCates(); // é‡æ–°æ¸²æŸ“
                alert(`åˆ é™¤åˆ†ç±»æˆåŠŸï¼š${delCateName}`);
            }
        }

        // æ”¶æ”¯ç±»å‹
        function setType(type) {
            currentType = type;
        }

        // ä¿å­˜è´¦å•
        function save() {
            const amount = document.getElementById('amount').value;
            if(!amount || amount <=0) {
                alert('é‡‘é¢è¦å¤§äº0ï¼');
                return;
            }
            alert(`æˆåŠŸï¼š${currentType==='expense'?'æ”¯å‡º':'æ”¶å…¥'}${amount}å…ƒï¼ˆ${selectedCate}ï¼‰`);
            closeModal();
        }
    </script>
</body>
</html>
