<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <title>å¦ä¸€ä¸ªæˆ‘</title>
    <style>
        /* å…¨å±€é‡ç½® */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-user-select: none; user-select: none;
        }
        body { 
            background: #F2F2F7; 
            padding-bottom: 90px; 
            font-size: 16px; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; /* iOSåŸç”Ÿå­—ä½“ */
        }

        /* å¯†ç é” */
        .lock-screen {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: #F2F2F7; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 0 20px;
        }
        .lock-title {
            font-size: 20px; color: #1C1C1E; margin-bottom: 30px;
        }
        .password-inputs { 
            display: flex; gap: 15px; margin-bottom: 20px;
            width: 100%; max-width: 300px;
        }
        .password-input {
            width: 20%; height: 50px; 
            border: 2px solid #E5E5EA; border-radius: 12px;
            text-align: center; font-size: 28px;
            background: #fff;
            -webkit-appearance: none; appearance: none;
        }
        .password-input:focus { border-color: #1C1C1E; outline: none; }

        /* ä¸»é¡µé¢ */
        .main-title {
            padding: 20px 16px;
            font-size: 24px; font-weight: 600;
            color: #1C1C1E;
        }

        /* æ•°æ®ç®¡ç†æŒ‰é’® */
        .data-management {
            padding: 0 16px 10px;
            display: flex; justify-content: flex-end;
            gap: 10px;
        }
        .data-btn {
            padding: 6px 12px;
            border-radius: 8px; border: 1px solid #007AFF;
            background: transparent; color: #007AFF;
            font-size: 13px;
        }

        /* æ”¶æ”¯ç»Ÿè®¡å¡ç‰‡ï¼ˆæ–°å¢é¢„ç®—/ä½™é¢åŒºåŸŸï¼‰ */
        .stats-card {
            background: #fff;
            border-radius: 16px;
            margin: 0 16px 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .stats-row {
            display: flex; justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #F2F2F7;
        }
        .stats-row:last-child { border-bottom: none; }
        .stats-label {
            font-size: 16px; color: #8E8E93;
        }
        .stats-value {
            font-size: 18px; font-weight: 600;
        }
        .stats-value.expense { color: #FF3B30; }
        .stats-value.income { color: #34C759; }
        .stats-value.balance { color: #007AFF; } /* ä½™é¢è“è‰² */
        
        /* é¢„ç®—åŒºåŸŸæ ·å¼ */
        .budget-section {
            margin-top: 15px;
        }
        .budget-header {
            display: flex; justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .budget-title {
            font-size: 16px; font-weight: 600;
            color: #1C1C1E;
        }
        .set-budget-btn {
            font-size: 14px;
            color: #007AFF;
            background: transparent;
            border: none;
            padding: 4px 8px;
            border-radius: 8px;
        }
        .budget-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .budget-item {
            display: flex; justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #F2F2F7;
        }
        .budget-item:last-child { border-bottom: none; }
        .budget-cate {
            display: flex; align-items: center;
            gap: 8px;
        }
        .budget-cate-icon {
            font-size: 16px;
        }
        .budget-cate-name {
            font-size: 14px;
        }
        .budget-usage {
            text-align: right;
        }
        .budget-used {
            font-size: 14px;
            color: #1C1C1E;
        }
        .budget-remain {
            font-size: 12px;
            color: #8E8E93;
        }
        .budget-over {
            color: #FF3B30 !important;
        }

        /* æœ€è¿‘è´¦å•åŒºåŸŸ */
        .bills-section {
            padding: 0 16px;
        }
        .bills-title {
            font-size: 16px; font-weight: 600;
            margin-bottom: 10px;
        }
        .bills-empty {
            text-align: center;
            padding: 30px 0;
            color: #8E8E93;
            font-size: 14px;
        }

        /* è´¦å•æ»‘åŠ¨åˆ é™¤å®¹å™¨ï¼ˆiOSåŸç”Ÿåƒåœ¾æ¡¶ï¼‰ */
        .bill-swipe-container {
            position: relative;
            width: 100%;
            margin-bottom: 10px;
            overflow: hidden;
            border-radius: 12px;
        }
        .bill-item {
            background: #fff;
            padding: 12px 16px;
            display: flex; justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.03);
            position: relative;
            left: 0;
            transition: left 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); /* iOSå¼¹æ€§åŠ¨ç”» */
            z-index: 2;
        }
        /* iOSåŸç”ŸåŒæ¬¾ï¼šåœ†å½¢çº¢è‰²åƒåœ¾æ¡¶æŒ‰é’®ï¼ˆCSSç»˜åˆ¶åŸç”Ÿå›¾æ ‡ï¼‰ */
        .bill-delete-btn {
            position: absolute;
            top: 50%; right: 10px;
            transform: translateY(-50%);
            width: 44px; height: 44px;
            background: #FF3B30;
            color: #fff;
            border: none;
            border-radius: 50%; /* åœ†å½¢ */
            font-size: 20px;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            /* æ¸…é™¤é»˜è®¤æ ·å¼ */
            padding: 0;
            outline: none;
        }
        /* CSSç»˜åˆ¶iOSåŸç”Ÿåƒåœ¾æ¡¶å›¾æ ‡ï¼ˆæç®€çº¿æ¡ï¼‰ */
        .bill-delete-btn::before,
        .bill-delete-btn::after {
            content: '';
            position: absolute;
            background: #fff;
            border-radius: 1px; /* iOSåŸç”Ÿåœ†è§’ */
        }
        /* åƒåœ¾æ¡¶ä¸»ä½“ */
        .bill-delete-btn::before {
            width: 14px;
            height: 10px;
            border: 2px solid #fff;
            border-bottom: none;
            border-radius: 2px 2px 0 0;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        /* åƒåœ¾æ¡¶åº•éƒ¨ */
        .bill-delete-btn::after {
            width: 18px;
            height: 2px;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
        }

        .bill-left {
            display: flex; align-items: center;
        }
        .bill-icon {
            width: 36px; height: 36px;
            background: #F2F2F7; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            margin-right: 10px;
            font-size: 16px;
        }
        .bill-info {
            display: flex; flex-direction: column;
        }
        .bill-category {
            font-size: 14px; font-weight: 500;
        }
        .bill-date {
            font-size: 12px; color: #8E8E93;
        }
        .bill-amount {
            font-size: 15px; font-weight: 500;
        }
        .bill-amount.expense { color: #FF3B30; }
        .bill-amount.income { color: #34C759; }

        /* åº•éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ */
        .btn-group {
            position: fixed; bottom: 20px; right: 20px;
            display: flex; flex-direction: column; gap: 12px;
        }
        /* æ·»åŠ æŒ‰é’®ï¼ˆåŸæœ‰ï¼‰ */
        .add-btn {
            width: 60px; height: 60px; border-radius: 50%;
            background: #1C1C1E; color: #fff; font-size: 36px;
            border: none; cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
        }
        /* æ—¥å†æŒ‰é’®ï¼ˆæ–°å¢ï¼šé™¶ç“·ç™½è‰²ã€æ—¥å­—ã€åœ†æ»‘ï¼‰ */
        .calendar-btn {
            width: 60px; height: 60px; border-radius: 50%;
            background: #F8F8FA; /* é™¶ç“·ç™½è‰² */
            color: #1C1C1E; font-size: 24px; font-weight: 600;
            border: none; cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* æ›´æµ…é˜´å½±ï¼Œè´´åˆé™¶ç“·è´¨æ„Ÿ */
            display: flex; align-items: center; justify-content: center;
            /* åœ†æ»‘è´¨æ„Ÿä¼˜åŒ– */
            border: 1px solid rgba(0,0,0,0.05);
        }
        /* é€‰ä¸­æ—¥æœŸæç¤ºï¼ˆæ›¿ä»£åŸå¤§æ—¥å†ï¼‰ */
        .selected-date-tip {
            background: #fff;
            border-radius: 16px;
            margin: 0 16px 16px;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            font-size: 15px;
            color: #1C1C1E;
            text-align: center;
        }

        /* è®°è´¦å¼¹çª— */
        .modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            z-index: 100;
        }
        .modal.show { display: block; }
        .modal-content {
            position: fixed; bottom:0; left:0; right:0;
            background: #fff; border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px 16px;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-title {
            font-size: 20px; font-weight: 600;
            margin-bottom: 20px; text-align: center;
        }
        .amount-input {
            width: 100%; font-size: 32px; text-align: center;
            margin: 10px 0 20px; padding: 10px 0;
            border: none; border-bottom: 1px solid #E5E5EA;
            -webkit-appearance: none; appearance: none;
        }
        .amount-input:focus { outline: none; border-bottom-color: #1C1C1E; }
        .type-toggle {
            display: flex; gap: 10px; margin: 10px 0 20px;
        }
        .type-btn {
            flex: 1; padding: 12px 0;
            border-radius: 20px; border: 2px solid #E5E5EA;
            background: transparent; font-size: 16px;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.2s ease;
        }
        .type-btn.active {
            border-color: #1C1C1E; background: #1C1C1E; color: #fff;
        }
        /* ä¿®å¤ï¼šå¢åŠ æŒ‰é’®æŒ‰ä¸‹æ•ˆæœ */
        .type-btn:active {
            transform: scale(0.98);
        }
        .category-label {
            font-size: 14px; color: #8E8E93;
            margin-bottom: 10px;
        }
        .longpress-tip {
            font-size: 12px; color: #8E8E93;
            text-align: center; margin-bottom: 10px;
        }
        .category-grid {
            display: grid; 
            grid-template-columns: repeat(4, 1fr);
            gap: 12px; margin: 10px 0 20px;
        }
        .category-item {
            display: flex; flex-direction: column;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }
        .category-icon {
            width: 50px; height: 50px; 
            background: #F2F2F7; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; margin-bottom: 6px;
        }
        .category-item.active .category-icon {
            background: #1C1C1E; color: #fff;
        }
        .category-name {
            font-size: 12px; color: #8E8E93;
            text-align: center; /* åˆ†ç±»æ–‡å­—å±…ä¸­ */
        }
        .category-item.active .category-name {
            color: #1C1C1E; font-weight: 500;
        }
        .add-cate-btn {
            width: 100%; padding: 12px;
            border: 1px dashed #E5E5EA; border-radius: 12px;
            background: #F9F9F9; font-size: 16px;
            color: #8E8E93; margin: 10px 0 20px;
            -webkit-tap-highlight-color: transparent;
        }
        .modal-btn {
            width: 100%; padding: 14px 0;
            border-radius: 12px; border: none;
            font-size: 16px; font-weight: 500;
            margin-bottom: 10px;
            -webkit-tap-highlight-color: transparent;
        }
        .save-btn { background: #1C1C1E; color: #fff; }
        .close-btn { background: #F2F2F7; color: #1C1C1E; }

        /* æ–°å¢åˆ†ç±»å¼¹çª— */
        .add-cate-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            align-items: center; justify-content: center;
            z-index: 200;
            padding: 0 20px;
        }
        .add-cate-modal.show { display: flex; }
        .add-cate-content {
            background: #fff; padding: 24px;
            border-radius: 20px; width: 100%; max-width: 300px;
        }
        .add-cate-title {
            font-size: 18px; font-weight: 600;
            margin-bottom: 15px; text-align: center;
        }
        .add-cate-input {
            width: 100%; padding: 12px;
            border: 1px solid #E5E5EA; border-radius: 12px;
            font-size: 16px; margin-bottom: 15px;
            -webkit-appearance: none; appearance: none;
        }
        .add-cate-input:focus { outline: none; border-color: #1C1C1E; }
        .add-cate-btn-group {
            display: flex; gap: 10px;
        }
        .add-cate-submit {
            flex: 1; padding: 12px;
            border-radius: 12px; border: none;
            background: #1C1C1E; color: #fff;
            font-size: 16px;
        }
        .add-cate-cancel {
            flex: 1; padding: 12px;
            border-radius: 12px; border: 1px solid #E5E5EA;
            background: transparent; font-size: 16px;
        }

        /* é¢„ç®—è®¾ç½®å¼¹çª— */
        .budget-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            align-items: center; justify-content: center;
            z-index: 200;
            padding: 0 20px;
        }
        .budget-modal.show { display: flex; }
        .budget-modal-content {
            background: #fff; padding: 24px;
            border-radius: 20px; width: 100%; max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .budget-modal-title {
            font-size: 18px; font-weight: 600;
            margin-bottom: 20px; text-align: center;
        }
        .budget-set-item {
            display: flex; justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #F2F2F7;
        }
        .budget-set-cate {
            display: flex; align-items: center;
            gap: 8px;
        }
        .budget-set-icon {
            font-size: 16px;
        }
        .budget-set-name {
            font-size: 14px;
        }
        .budget-set-input {
            width: 80px;
            padding: 6px 8px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            font-size: 14px;
            text-align: right;
        }
        .budget-modal-btn-group {
            display: flex; gap: 10px;
            margin-top: 20px;
        }
        .budget-save-btn {
            flex: 1; padding: 12px;
            border-radius: 12px; border: none;
            background: #1C1C1E; color: #fff;
            font-size: 16px;
        }
        .budget-cancel-btn {
            flex: 1; padding: 12px;
            border-radius: 12px; border: 1px solid #E5E5EA;
            background: transparent; font-size: 16px;
        }

        /* è‡ªå®šä¹‰æç¤ºæ¡†ï¼ˆå±…ä¸­æ˜¾ç¤ºï¼‰ */
        .custom-alert {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            z-index: 300;
            display: none;
        }
        .alert-content {
            background: #000; color: #fff;
            padding: 24px; border-radius: 12px;
            width: 80%; max-width: 300px;
            text-align: center;
        }
        .alert-text {
            font-size: 16px; margin-bottom: 15px;
        }
        .alert-close {
            background: transparent;
            border: 1px solid #fff; color: #fff;
            padding: 8px 20px; border-radius: 8px;
            font-size: 14px;
        }

        /* ========== æ—¥å†å¼¹çª—ï¼ˆå®Œæ•´æ—¥å†è¡¨ï¼‰ ========== */
        .calendar-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            z-index: 150;
        }
        .calendar-modal.show { display: flex; align-items: center; justify-content: center; }
        .calendar-modal-content {
            background: #fff;
            border-radius: 24px;
            width: 90%; max-width: 400px;
            padding: 20px;
            max-height: 80vh;
            overflow: hidden;
        }
        /* æ—¥å†å¤´éƒ¨ï¼ˆå¹´æœˆé€‰æ‹©+è·³è½¬ï¼‰ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #F2F2F7;
        }
        .calendar-nav {
            display: flex; gap: 8px;
        }
        .calendar-nav-btn {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: #007AFF;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: rgba(0, 122, 255, 0.1);
        }
        /* å¹´æœˆé€‰æ‹©å™¨ */
        .calendar-date-select {
            display: flex; gap: 8px;
            align-items: center;
        }
        .calendar-select {
            padding: 4px 8px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            background: #F9F9F9;
            color: #1C1C1E;
            font-size: 16px;
            -webkit-appearance: none;
            appearance: none;
        }
        .calendar-month-text {
            font-size: 17px;
            font-weight: 500;
            color: #1C1C1E;
            margin: 0 8px;
        }
        /* æ—¥å†å…³é—­æŒ‰é’® */
        .calendar-close-btn {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: none;
            background: #F2F2F7;
            color: #1C1C1E;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* iOSæ—¥å†æ˜ŸæœŸæ ï¼ˆå‘¨æ—¥çº¢è‰²ï¼‰ */
        .calendar-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 8px;
        }
        .calendar-week-item {
            font-size: 12px;
            padding: 4px 0;
            color: #8E8E93;
        }
        .calendar-week-item:first-child {
            color: #FF3B30;
        }
        /* iOSæ—¥å†æ—¥æœŸç½‘æ ¼ï¼ˆæ”¯æŒæ»‘åŠ¨ï¼‰ */
        .calendar-wrap {
            overflow: hidden;
            touch-action: none; /* å®Œå…¨ç¦ç”¨å®¹å™¨çš„è§¦æ‘¸è¡Œä¸ºï¼Œä»…é€šè¿‡æ‰‹åŠ¨åˆ¤å®š */
        }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            transition: transform 0.3s ease;
        }
        /* iOSæ—¥æœŸæ ·å¼ */
        .calendar-day {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 14px;
            color: #1C1C1E;
            background: transparent;
            -webkit-tap-highlight-color: rgba(0, 122, 255, 0.1);
            cursor: pointer;
            touch-action: manipulation; /* æ—¥æœŸå…ƒç´ ä»…å…è®¸ç‚¹å‡»/ç¼©æ”¾ï¼Œç¦ç”¨æ»‘åŠ¨ */
        }
        .calendar-day.empty {
            color: #C7C7CC;
            cursor: default; /* ç©ºæ—¥æœŸä¸å¯ç‚¹å‡» */
            touch-action: none;
        }
        .calendar-day.today {
            border: 1px solid #8E8E93;
            font-weight: 500;
        }
        .calendar-day.has-bill {
            position: relative;
        }
        .calendar-day.has-bill::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #FF3B30;
        }
        .calendar-day.active {
            background: #007AFF;
            color: #fff;
            font-weight: 500;
        }

        /* æ•°æ®ç®¡ç†å¼¹çª— */
        .data-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            z-index: 100;
        }
        .data-modal.show { display: block; }
        .data-modal-content {
            position: fixed; bottom:0; left:0; right:0;
            background: #fff; border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px 16px;
            max-height: 90vh; overflow-y: auto;
        }
        .data-modal-title {
            font-size: 20px; font-weight: 600;
            margin-bottom: 20px; text-align: center;
        }
        .data-option {
            padding: 16px 0;
            border-bottom: 1px solid #F2F2F7;
            display: flex; justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .data-option:last-child {
            border-bottom: none;
        }
        .data-label {
            font-size: 16px; color: #1C1C1E;
        }
        .data-desc {
            font-size: 14px; color: #8E8E93;
            margin-top: 5px;
        }
        .data-icon {
            font-size: 20px;
        }

        /* æ–‡æœ¬åˆ†äº«å¼¹çª— */
        .text-share-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; padding: 0 20px;
        }
        .text-share-content {
            background: white;
            padding: 24px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .text-share-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        .text-share-textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid #E5E5EA;
            border-radius: 12px;
            font-size: 14px;
            font-family: monospace;
            margin-bottom: 15px;
            resize: none;
            -webkit-appearance: none;
            appearance: none;
        }
        .text-share-textarea:focus {
            outline: none;
            border-color: #007AFF;
        }
        .text-share-buttons {
            display: flex;
            gap: 10px;
        }
        .text-share-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
        }
        .text-share-copy {
            background: #007AFF;
            color: white;
        }
        .text-share-close {
            background: #F2F2F7;
            color: #1C1C1E;
        }
        .text-share-tips {
            font-size: 12px;
            color: #8E8E93;
            margin-top: 10px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <!-- å¯†ç é”é¡µé¢ -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-title">è¯·è¾“å…¥4ä½æ•°å­—å¯†ç </div>
        <div class="password-inputs">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)" onkeyup="checkPasswordWhenComplete()">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)" onkeyup="checkPasswordWhenComplete()">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)" onkeyup="checkPasswordWhenComplete()">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)" onkeyup="checkPasswordWhenComplete()">
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æç¤ºæ¡† -->
    <div class="custom-alert" id="customAlert">
        <div class="alert-content">
            <div class="alert-text" id="alertText"></div>
            <button class="alert-close" onclick="closeAlert()">å…³é—­</button>
        </div>
    </div>

    <!-- ä¸»é¡µé¢ -->
    <div id="mainPage" style="display: none;">
        <div class="main-title">å¦ä¸€ä¸ªæˆ‘</div>

        <!-- æ•°æ®ç®¡ç†æŒ‰é’® -->
        <div class="data-management">
            <button class="data-btn" onclick="openDataModal()">æ•°æ®ç®¡ç†</button>
        </div>

        <!-- æœ¬æœˆæ”¶æ”¯ç»Ÿè®¡å¡ç‰‡ï¼ˆæ–°å¢ä½™é¢+é¢„ç®—ï¼‰ -->
        <div class="stats-card">
            <div class="stats-row">
                <div class="stats-label">æœ¬æœˆæ”¯å‡º</div>
                <div class="stats-value expense" id="monthExpense">Â¥0.00</div>
            </div>
            <div class="stats-row">
                <div class="stats-label">æœ¬æœˆæ”¶å…¥</div>
                <div class="stats-value income" id="monthIncome">Â¥0.00</div>
            </div>
            <div class="stats-row">
                <div class="stats-label">è´¦æˆ·ä½™é¢</div>
                <div class="stats-value balance" id="accountBalance">Â¥0.00</div>
            </div>
            
            <!-- é¢„ç®—åŒºåŸŸ -->
            <div class="budget-section">
                <div class="budget-header">
                    <div class="budget-title">æœ¬æœˆåˆ†ç±»é¢„ç®—</div>
                    <button class="set-budget-btn" onclick="openBudgetModal()">è®¾ç½®é¢„ç®—</button>
                </div>
                <div class="budget-list" id="budgetList"></div>
            </div>
        </div>

        <!-- é€‰ä¸­æ—¥æœŸæç¤ºï¼ˆæ›¿ä»£åŸå¤§æ—¥å†ï¼‰ -->
        <div class="selected-date-tip" id="selectedDateTip">å½“å‰é€‰ä¸­ï¼š2025å¹´12æœˆ22æ—¥ï¼ˆä»Šæ—¥ï¼‰</div>

        <!-- æœ€è¿‘è´¦å•åŒºåŸŸ -->
        <div class="bills-section">
            <div class="bills-title">å½“æ—¥è´¦å•</div>
            <div id="recentBillsList">
                <div class="bills-empty">æš‚æ— è´¦å•ï¼Œç‚¹å‡»+å¼€å§‹è®°å½•</div>
            </div>
        </div>

        <!-- åº•éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ï¼ˆæ·»åŠ +æ—¥å†ï¼‰ -->
        <div class="btn-group">
            <button class="add-btn" onclick="openBillModal()">+</button>
            <button class="calendar-btn" onclick="openCalendarModal()">æ—¥</button>
        </div>

        <!-- è®°è´¦å¼¹çª— -->
        <div class="modal" id="billModal">
            <div class="modal-content">
                <div class="modal-title">è®°ä¸€ç¬”</div>
                <input type="number" class="amount-input" id="billAmount" placeholder="0.00" min="0.01" step="0.01">
                <div class="type-toggle">
                    <button class="type-btn active" onclick="setType('expense')">æ”¯å‡º</button>
                    <button class="type-btn" onclick="setType('income')">æ”¶å…¥</button>
                </div>
                
                <div class="category-label">åˆ†ç±»ï¼ˆé•¿æŒ‰åˆ é™¤ï¼‰</div>
                <div class="longpress-tip">é•¿æŒ‰åˆ†ç±»å¯åˆ é™¤</div>
                <div class="category-grid" id="categoryGrid"></div>
                
                <button class="add-cate-btn" onclick="openAddCateModal()">+ æ–°å¢åˆ†ç±»</button>
                
                <button class="modal-btn save-btn" onclick="saveBill()">ä¿å­˜</button>
                <button class="modal-btn close-btn" onclick="closeBillModal()">å…³é—­</button>
            </div>
        </div>

        <!-- æ–°å¢åˆ†ç±»å¼¹çª— -->
        <div class="add-cate-modal" id="addCateModal">
            <div class="add-cate-content">
                <div class="add-cate-title">æ–°å¢åˆ†ç±»</div>
                <input type="text" class="add-cate-input" id="newCateInput" placeholder="æ¯”å¦‚ï¼šå¥¶èŒ¶ã€è¯è´¹">
                <div class="add-cate-btn-group">
                    <button class="add-cate-submit" onclick="saveNewCate()">ç¡®è®¤</button>
                    <button class="add-cate-cancel" onclick="closeAddCateModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- é¢„ç®—è®¾ç½®å¼¹çª— -->
        <div class="budget-modal" id="budgetModal">
            <div class="budget-modal-content">
                <div class="budget-modal-title">è®¾ç½®æœ¬æœˆåˆ†ç±»é¢„ç®—</div>
                <div id="budgetSetList"></div>
                <div class="budget-modal-btn-group">
                    <button class="budget-save-btn" onclick="saveAllBudgets()">ä¿å­˜é¢„ç®—</button>
                    <button class="budget-cancel-btn" onclick="closeBudgetModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- æ—¥å†å¼¹çª—ï¼ˆå®Œæ•´æ—¥å†è¡¨ï¼‰ -->
        <div class="calendar-modal" id="calendarModal">
            <div class="calendar-modal-content">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)">â—€</button>
                        <!-- å¹´æœˆé€‰æ‹©å™¨ï¼ˆæ”¯æŒç›´æ¥è·³è½¬ï¼‰ -->
                        <div class="calendar-date-select">
                            <!-- å¹´ä»½é€‰æ‹©å™¨æ‰©å±•åˆ°1900-2100 -->
                            <select class="calendar-select" id="yearSelect" onchange="jumpToSelectedDate()"></select>
                            <select class="calendar-select" id="monthSelect" onchange="jumpToSelectedDate()">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12" selected>12æœˆ</option>
                            </select>
                        </div>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)">â–¶</button>
                    </div>
                    <button class="calendar-close-btn" onclick="closeCalendarModal()">Ã—</button>
                </div>
                <div class="calendar-week">
                    <div class="calendar-week-item">æ—¥</div>
                    <div class="calendar-week-item">ä¸€</div>
                    <div class="calendar-week-item">äºŒ</div>
                    <div class="calendar-week-item">ä¸‰</div>
                    <div class="calendar-week-item">å››</div>
                    <div class="calendar-week-item">äº”</div>
                    <div class="calendar-week-item">å…­</div>
                </div>
                <div class="calendar-wrap" id="calendarWrap">
                    <div class="calendar-days" id="calendarDays"></div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®ç®¡ç†å¼¹çª—ï¼ˆä¿®å¤ç‰ˆï¼šæ·»åŠ äº†"ä»æ–‡æœ¬æ¢å¤"é€‰é¡¹ï¼‰ -->
        <div class="data-modal" id="dataModal">
            <div class="data-modal-content">
                <div class="data-modal-title">æ•°æ®ç®¡ç†</div>
                
                <div class="data-option" onclick="exportData()">
                    <div>
                        <div class="data-label">å¯¼å‡ºæ•°æ®</div>
                        <div class="data-desc">å°†æ•°æ®ä¿å­˜ä¸ºJSONæ–‡ä»¶</div>
                    </div>
                    <div class="data-icon">ğŸ“¤</div>
                </div>
                
                <div class="data-option" onclick="importData()">
                    <div>
                        <div class="data-label">å¯¼å…¥æ•°æ®</div>
                        <div class="data-desc">ä»JSONæ–‡ä»¶æ¢å¤æ•°æ®</div>
                    </div>
                    <div class="data-icon">ğŸ“¥</div>
                </div>
                
                <div class="data-option" onclick="shareAsText()">
                    <div>
                        <div class="data-label">æ–‡æœ¬åˆ†äº«</div>
                        <div class="data-desc">ç”Ÿæˆæ–‡æœ¬ä»£ç ï¼Œæ‰‹åŠ¨å¤åˆ¶ç²˜è´´</div>
                    </div>
                    <div class="data-icon">ğŸ“</div>
                </div>
                
                <!-- æ–°å¢ï¼šä»æ–‡æœ¬æ¢å¤ -->
                <div class="data-option" onclick="openTextRestore()">
                    <div>
                        <div class="data-label">ä»æ–‡æœ¬æ¢å¤</div>
                        <div class="data-desc">ç²˜è´´æ•°æ®ä»£ç æ¢å¤æ•°æ®</div>
                    </div>
                    <div class="data-icon">ğŸ“‹</div>
                </div>
                
                <div class="data-option" onclick="clearLocalData()">
                    <div>
                        <div class="data-label">æ¸…ç©ºæ•°æ®</div>
                        <div class="data-desc">åˆ é™¤æ‰€æœ‰è´¦å•å’Œè®¾ç½®</div>
                    </div>
                    <div class="data-icon">ğŸ—‘ï¸</div>
                </div>
                
                <div class="data-option" onclick="changePassword()">
                    <div>
                        <div class="data-label">ä¿®æ”¹å¯†ç </div>
                        <div class="data-desc">ä¿®æ”¹åº”ç”¨é”å¯†ç </div>
                    </div>
                    <div class="data-icon">ğŸ”’</div>
                </div>
                
                <button class="modal-btn close-btn" onclick="closeDataModal()">å…³é—­</button>
            </div>
        </div>

        <!-- æ–‡æœ¬åˆ†äº«å¼¹çª— -->
        <div class="text-share-modal" id="textShareModal" style="display: none;">
            <div class="text-share-content">
                <div class="text-share-title">æ–‡æœ¬åˆ†äº«</div>
                <textarea class="text-share-textarea" id="textShareArea" readonly placeholder="æ•°æ®ä»£ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º..."></textarea>
                <div class="text-share-buttons">
                    <button class="text-share-btn text-share-copy" onclick="copyTextData()">å¤åˆ¶ä»£ç </button>
                    <button class="text-share-btn text-share-close" onclick="closeTextShare()">å…³é—­</button>
                </div>
                <div class="text-share-tips">
                    <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong><br>
                    1. å¤åˆ¶ä¸Šé¢çš„ä»£ç <br>
                    2. åœ¨æ–°è®¾å¤‡ä¸Šæ‰“å¼€æœ¬åº”ç”¨<br>
                    3. ç‚¹å‡»"æ•°æ®ç®¡ç†" â†’ "ä»æ–‡æœ¬æ¢å¤"<br>
                    4. ç²˜è´´ä»£ç å¹¶ç¡®è®¤æ¢å¤
                </div>
            </div>
        </div>

        <!-- æ–‡æœ¬æ¢å¤å¼¹çª— -->
        <div class="text-share-modal" id="textRestoreModal" style="display: none;">
            <div class="text-share-content">
                <div class="text-share-title">ä»æ–‡æœ¬æ¢å¤æ•°æ®</div>
                <textarea class="text-share-textarea" id="textRestoreArea" placeholder="è¯·ç²˜è´´æ•°æ®ä»£ç ..."></textarea>
                <div class="text-share-buttons">
                    <button class="text-share-btn text-share-copy" onclick="restoreFromText()">æ¢å¤æ•°æ®</button>
                    <button class="text-share-btn text-share-close" onclick="closeTextRestore()">å…³é—­</button>
                </div>
                <div class="text-share-tips">
                    <strong>æ³¨æ„ï¼š</strong>è¿™å°†è¦†ç›–å½“å‰è®¾å¤‡ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼è¯·ç¡®ä¿å·²å¤‡ä»½ã€‚
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€å˜é‡ ==========
        // BUGä¿®å¤1: ä»localStorageè¯»å–å¯†ç ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å¯†ç 
        let password = localStorage.getItem('appPassword') || '0517';
        let currentType = 'expense';
        let selectedCate = '';
        let longPressTimer = null;
        
        // åˆ†ç±»æ•°æ®
        let categories = JSON.parse(localStorage.getItem('phoneCates')) || [
            'é¤é¥®ğŸœ', 'äº¤é€šğŸšŒ', 'å¨±ä¹ğŸ¬', 'å­¦ä¹ ğŸ“š',
            'è´­ç‰©ğŸ›ï¸', 'æˆ¿ç§ŸğŸ ', 'å·¥èµ„ğŸ’¼', 'å…¶ä»–ğŸ”§',
            'æ—¥ç”¨ğŸ§´', 'è”¬èœğŸ¥¬', 'æ°´æœğŸ', 'é¥®æ–™ğŸ¥¤',
            'å®¶åº­ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', 'ç¤¾äº¤ğŸ‘«', 'æ—…è¡Œâœˆï¸', 'åŒ»ç–—ğŸ’Š',
            'æèµ ğŸ', 'è¿˜æ¬¾ğŸ’°', 'å€Ÿå‡ºğŸ“¤'
        ];
        
        // åˆ†ç±»ä¸å›¾æ ‡æ˜ å°„è¡¨
        const cateIcons = {
            'é¤é¥®': 'ğŸœ', 'äº¤é€š': 'ğŸšŒ', 'å¨±ä¹': 'ğŸ¬', 'å­¦ä¹ ': 'ğŸ“š',
            'è´­ç‰©': 'ğŸ›ï¸', 'æˆ¿ç§Ÿ': 'ğŸ ', 'å·¥èµ„': 'ğŸ’¼', 'å…¶ä»–': 'ğŸ”§',
            'æ—¥ç”¨': 'ğŸ§´', 'è”¬èœ': 'ğŸ¥¬', 'æ°´æœ': 'ğŸ', 'é¥®æ–™': 'ğŸ¥¤',
            'å®¶åº­': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', 'ç¤¾äº¤': 'ğŸ‘«', 'æ—…è¡Œ': 'âœˆï¸', 'åŒ»ç–—': 'ğŸ’Š',
            'æèµ ': 'ğŸ', 'è¿˜æ¬¾': 'ğŸ’°', 'å€Ÿå‡º': 'ğŸ“¤', 'å¥¶èŒ¶': 'ğŸ¥¤',
            'æ¸¸æˆ': 'ğŸ®', 'è¯è´¹': 'ğŸ“±', 'å’–å•¡': 'â˜•', 'ç¤¼ç‰©': 'ğŸ',
            'æ±½è½¦': 'ğŸš—', 'ç¾å¦†': 'ğŸ’„', 'é›¶é£Ÿ': 'ğŸ”', 'éŸ³ä¹': 'ğŸµ'
        };
        
        // è´¦å•æ•°æ®
        let bills = JSON.parse(localStorage.getItem('phoneBills')) || [];
        
        // é¢„ç®—æ•°æ®
        let monthlyBudgets = JSON.parse(localStorage.getItem('monthlyBudgets')) || {};
        
        // æ»‘åŠ¨ç›¸å…³å˜é‡
        let startX = 0; 
        let currentBillId = ''; 
        
        // æ—¥å†ç›¸å…³å˜é‡
        let currentCalendarDate = new Date();
        let selectedDate = new Date();
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartTime = 0; 
        let isDateClick = false;
        const SWIPE_THRESHOLD = 100;
        const SWIPE_TIME_THRESHOLD = 250;

        // ========== åˆå§‹åŒ–å‡½æ•° ==========
        function initApp() {
            // åˆå§‹åŒ–å¹´ä»½é€‰æ‹©å™¨ï¼ˆ1900-2100å¹´ï¼‰
            initYearSelector();
        }

        // åˆå§‹åŒ–å¹´ä»½é€‰æ‹©å™¨ï¼ˆ1900-2100å¹´ï¼‰
        function initYearSelector() {
            const yearSelect = document.getElementById('yearSelect');
            yearSelect.innerHTML = '';
            
            const currentYear = new Date().getFullYear();
            
            // ä»1900åˆ°2100å¹´
            for (let year = 1900; year <= 2100; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }
        }

        // ========== æ•°æ®ç®¡ç†åŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰ ==========
        // æ‰“å¼€æ•°æ®ç®¡ç†å¼¹çª—
        function openDataModal() {
            document.getElementById('dataModal').classList.add('show');
        }
        
        // å…³é—­æ•°æ®ç®¡ç†å¼¹çª—
        function closeDataModal() {
            document.getElementById('dataModal').classList.remove('show');
        }

        // å¯¼å‡ºæ•°æ®ä¸ºJSONæ–‡ä»¶
        function exportData() {
            const allData = {
                bills: bills,
                categories: categories,
                budgets: monthlyBudgets,
                exportTime: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `è®°è´¦æ•°æ®_${formatDateToYMD(new Date())}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œè¯·å¦¥å–„ä¿å­˜');
            closeDataModal();
        }

        // ä»JSONæ–‡ä»¶å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function() {
                    try {
                        const importedData = JSON.parse(reader.result);
                        
                        if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®')) {
                            bills = importedData.bills || [];
                            categories = importedData.categories || categories;
                            monthlyBudgets = importedData.budgets || {};
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('phoneBills', JSON.stringify(bills));
                            localStorage.setItem('phoneCates', JSON.stringify(categories));
                            localStorage.setItem('monthlyBudgets', JSON.stringify(monthlyBudgets));
                            
                            // åˆ·æ–°é¡µé¢
                            renderHomePage();
                            renderBudgets();
                            renderCalendar();
                            
                            showAlert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                            closeDataModal();
                        }
                    } catch (error) {
                        showAlert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„JSONæ–‡ä»¶');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // æ–‡æœ¬åˆ†äº«åŠŸèƒ½
        function shareAsText() {
            const allData = {
                bills: bills,
                categories: categories,
                budgets: monthlyBudgets,
                version: '2.0',
                timestamp: Date.now()
            };
            
            // ç”Ÿæˆå‹ç¼©çš„æ–‡æœ¬æ•°æ®
            const dataStr = JSON.stringify(allData);
            // ä½¿ç”¨æ›´ç®€å•çš„base64ç¼–ç 
            const compressed = btoa(unescape(encodeURIComponent(dataStr)));
            
            // æ˜¾ç¤ºæ–‡æœ¬åˆ†äº«å¼¹çª—
            document.getElementById('textShareModal').style.display = 'flex';
            document.getElementById('textShareArea').value = compressed;
            
            closeDataModal();
        }

        // å¤åˆ¶æ–‡æœ¬æ•°æ®
        function copyTextData() {
            const textArea = document.getElementById('textShareArea');
            textArea.select();
            textArea.setSelectionRange(0, 99999); // ç§»åŠ¨è®¾å¤‡å…¼å®¹
    
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('æ•°æ®ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆ
                    navigator.clipboard.writeText(textArea.value).then(function() {
                        showAlert('æ•°æ®ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    }).catch(function(err) {
                        showAlert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶');
                    });
                }
            } catch (err) {
                showAlert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶');
            }
        }

        // å…³é—­æ–‡æœ¬åˆ†äº«
        function closeTextShare() {
            document.getElementById('textShareModal').style.display = 'none';
        }

        // æ‰“å¼€æ–‡æœ¬æ¢å¤å¼¹çª—
        function openTextRestore() {
            document.getElementById('textRestoreModal').style.display = 'flex';
            closeDataModal();
        }

        // ä»æ–‡æœ¬æ¢å¤æ•°æ®
        function restoreFromText() {
            const textArea = document.getElementById('textRestoreArea');
            const dataCode = textArea.value.trim();
            
            if (!dataCode) {
                showAlert('è¯·è¾“å…¥æ•°æ®ä»£ç ');
                return;
            }
            
            try {
                // è§£ç base64æ•°æ®
                const decoded = decodeURIComponent(escape(atob(dataCode)));
                const importedData = JSON.parse(decoded);
                
                if (confirm('ç¡®å®šè¦æ¢å¤æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼')) {
                    bills = importedData.bills || [];
                    categories = importedData.categories || categories;
                    monthlyBudgets = importedData.budgets || {};
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('phoneBills', JSON.stringify(bills));
                    localStorage.setItem('phoneCates', JSON.stringify(categories));
                    localStorage.setItem('monthlyBudgets', JSON.stringify(monthlyBudgets));
                    
                    // åˆ·æ–°é¡µé¢
                    renderHomePage();
                    renderBudgets();
                    renderCalendar();
                    
                    showAlert('æ•°æ®æ¢å¤æˆåŠŸï¼');
                    closeTextRestore();
                }
            } catch (error) {
                showAlert('æ•°æ®ä»£ç æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•');
            }
        }

        // å…³é—­æ–‡æœ¬æ¢å¤
        function closeTextRestore() {
            document.getElementById('textRestoreModal').style.display = 'none';
        }

        // æ¸…ç©ºæœ¬åœ°æ•°æ®
        function clearLocalData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('phoneBills');
                localStorage.removeItem('phoneCates');
                localStorage.removeItem('monthlyBudgets');
                
                bills = [];
                categories = JSON.parse(localStorage.getItem('phoneCates')) || [
                    'é¤é¥®ğŸœ', 'äº¤é€šğŸšŒ', 'å¨±ä¹ğŸ¬', 'å­¦ä¹ ğŸ“š',
                    'è´­ç‰©ğŸ›ï¸', 'æˆ¿ç§ŸğŸ ', 'å·¥èµ„ğŸ’¼', 'å…¶ä»–ğŸ”§',
                    'æ—¥ç”¨ğŸ§´', 'è”¬èœğŸ¥¬', 'æ°´æœğŸ', 'é¥®æ–™ğŸ¥¤',
                    'å®¶åº­ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', 'ç¤¾äº¤ğŸ‘«', 'æ—…è¡Œâœˆï¸', 'åŒ»ç–—ğŸ’Š',
                    'æèµ ğŸ', 'è¿˜æ¬¾ğŸ’°', 'å€Ÿå‡ºğŸ“¤'
                ];
                monthlyBudgets = {};
                
                renderHomePage();
                renderBudgets();
                renderCalendar();
                
                showAlert('æœ¬åœ°æ•°æ®å·²æ¸…ç©º');
                closeDataModal();
            }
        }

        // BUGä¿®å¤3: ä¿®æ”¹å¯†ç ï¼ˆä¿®å¤ä¿å­˜é—®é¢˜ï¼‰
        function changePassword() {
            const oldPassword = prompt('è¯·è¾“å…¥å½“å‰å¯†ç :');
            if (oldPassword !== password) {
                showAlert('å½“å‰å¯†ç é”™è¯¯');
                return;
            }
            
            const newPassword = prompt('è¯·è¾“å…¥æ–°çš„4ä½æ•°å­—å¯†ç :');
            if (newPassword && /^\d{4}$/.test(newPassword)) {
                password = newPassword;
                // BUGä¿®å¤: ä¿å­˜å¯†ç åˆ°localStorage
                localStorage.setItem('appPassword', newPassword);
                showAlert('å¯†ç ä¿®æ”¹æˆåŠŸ');
                closeDataModal();
            } else if (newPassword) {
                showAlert('å¯†ç å¿…é¡»æ˜¯4ä½æ•°å­—');
            }
        }

        // ========== åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜ ==========
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸä¸ºYYYY-MM-DD
        function formatDateToYMD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–å½“å‰å¹´æœˆæ ‡è¯†
        function getCurrentMonthKey() {
            const year = new Date().getFullYear();
            const month = String(new Date().getMonth() + 1).padStart(2, '0');
            return `${year}-${month}`;
        }

        // ========== å¯†ç é”åŠŸèƒ½ ==========
        function isNumberKey(evt) {
            const charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function nextInput(input) {
            const inputs = document.querySelectorAll('.password-input');
            const index = Array.from(inputs).indexOf(input);
            if (input.value && index < 3) {
                inputs[index + 1].focus();
            }
        }

        function checkPasswordWhenComplete() {
            const inputs = document.querySelectorAll('.password-input');
            const inputValues = Array.from(inputs).map(i => i.value);
            if (inputValues.every(val => val !== '')) {
                checkPassword();
            }
        }

        function checkPassword() {
            const inputs = document.querySelectorAll('.password-input');
            const inputPwd = Array.from(inputs).map(i => i.value).join('');
            
            if (inputPwd.length === 4) {
                if (inputPwd === password) {
                    document.getElementById('lockScreen').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'block';
                    initCalendarSelect();
                    renderHomePage();
                    renderBudgets();
                } else {
                    showAlert('æ•°å­—å¯†ç é”™è¯¯');
                }
            }
        }

        function showAlert(message) {
            document.getElementById('alertText').textContent = message;
            document.getElementById('customAlert').style.display = 'flex';
        }

        function closeAlert() {
            document.getElementById('customAlert').style.display = 'none';
            const inputs = document.querySelectorAll('.password-input');
            inputs.forEach(input => input.value = '');
            inputs[0].focus();
        }

        // ========== æ—¥å†æ ¸å¿ƒåŠŸèƒ½ ==========
        function openCalendarModal() {
            document.getElementById('calendarModal').classList.add('show');
            renderCalendar();
            const calendarWrap = document.getElementById('calendarWrap');
            calendarWrap.addEventListener('touchstart', handleCalendarTouchStart);
            calendarWrap.addEventListener('touchmove', handleCalendarTouchMove);
            calendarWrap.addEventListener('touchend', handleCalendarTouchEnd);
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').classList.remove('show');
            const calendarWrap = document.getElementById('calendarWrap');
            calendarWrap.removeEventListener('touchstart', handleCalendarTouchStart);
            calendarWrap.removeEventListener('touchmove', handleCalendarTouchMove);
            calendarWrap.removeEventListener('touchend', handleCalendarTouchEnd);
            const year = selectedDate.getFullYear();
            const month = selectedDate.getMonth() + 1;
            const day = selectedDate.getDate();
            document.getElementById('selectedDateTip').textContent = `å½“å‰é€‰ä¸­ï¼š${year}å¹´${month}æœˆ${day}æ—¥${year === new Date().getFullYear() && month === new Date().getMonth() + 1 && day === new Date().getDate() ? 'ï¼ˆä»Šæ—¥ï¼‰' : ''}`;
            renderHomePage();
        }

        function initCalendarSelect() {
            document.getElementById('yearSelect').value = currentCalendarDate.getFullYear();
            document.getElementById('monthSelect').value = currentCalendarDate.getMonth() + 1;
        }

        function jumpToSelectedDate() {
            const year = parseInt(document.getElementById('yearSelect').value);
            const month = parseInt(document.getElementById('monthSelect').value) - 1;
            currentCalendarDate = new Date(year, month, 1);
            renderCalendar();
        }

        function handleCalendarTouchStart(e) {
            if (e.target.classList.contains('calendar-day') && !e.target.classList.contains('empty')) {
                isDateClick = true;
            } else {
                isDateClick = false;
            }
            touchStartX = e.touches[0].clientX;
            touchStartTime = new Date().getTime();
        }

        function handleCalendarTouchMove(e) {
            if (isDateClick) {
                e.preventDefault();
                return;
            }
            touchEndX = e.touches[0].clientX;
        }

        function handleCalendarTouchEnd(e) {
            const currentTime = new Date().getTime();
            const timeDiff = currentTime - touchStartTime;
            
            if (isDateClick) {
                isDateClick = false;
                return;
            }

            if (Math.abs(touchStartX - touchEndX) > SWIPE_THRESHOLD && timeDiff < SWIPE_TIME_THRESHOLD) {
                if (touchStartX > touchEndX) {
                    changeMonth(1);
                } else {
                    changeMonth(-1);
                }
            }
        }

        function changeMonth(direction) {
            const newMonth = currentCalendarDate.getMonth() + direction;
            currentCalendarDate = new Date(currentCalendarDate.getFullYear(), newMonth, 1);
            document.getElementById('yearSelect').value = currentCalendarDate.getFullYear();
            document.getElementById('monthSelect').value = currentCalendarDate.getMonth() + 1;
            renderCalendar();
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            for (let i = 0; i < firstDay; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day empty';
                dayElement.textContent = prevMonthDays - firstDay + i + 1;
                calendarDays.appendChild(dayElement);
            }
            
            const billDates = getBillDatesInMonth(year, month);
            
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const today = new Date();
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                if (billDates.includes(dateStr)) {
                    dayElement.classList.add('has-bill');
                }
                
                if (i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                    dayElement.classList.add('active');
                }
                
                dayElement.textContent = i;
                dayElement.dataset.date = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                
                dayElement.addEventListener('click', function() {
                    const [y, m, d] = this.dataset.date.split('-').map(Number);
                    selectedDate = new Date(y, m - 1, d);
                    renderCalendar();
                });
                
                calendarDays.appendChild(dayElement);
            }
        }

        function getBillDatesInMonth(year, month) {
            const billDates = [];
            const monthStr = String(month + 1).padStart(2, '0');
            
            bills.forEach(bill => {
                if (bill.date.startsWith(`${year}-${monthStr}`)) {
                    billDates.push(bill.date);
                }
            });
            
            return [...new Set(billDates)];
        }

        // ========== è´¦å•ç®¡ç†åŠŸèƒ½ ==========
        // BUGä¿®å¤3: ä¿®å¤æ”¯å‡º/æ”¶å…¥æŒ‰é’®è§†è§‰åé¦ˆé—®é¢˜
        function openBillModal() {
            document.getElementById('billModal').classList.add('show');
            document.getElementById('billAmount').value = '';
            // ç¡®ä¿é»˜è®¤é€‰ä¸­æ”¯å‡ºæŒ‰é’®
            setType('expense');
            renderCategories();
        }

        function closeBillModal() {
            document.getElementById('billModal').classList.remove('show');
            selectedCate = '';
        }

        // BUGä¿®å¤3: ç¡®ä¿æ”¯å‡º/æ”¶å…¥æŒ‰é’®çš„è§†è§‰åé¦ˆæ­£å¸¸å·¥ä½œ
        function setType(type) {
            currentType = type;
            const buttons = document.querySelectorAll('.type-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ä¸ºå½“å‰é€‰ä¸­çš„æŒ‰é’®æ·»åŠ activeç±»
            if (type === 'expense') {
                document.querySelector('.type-btn:first-child').classList.add('active');
            } else {
                document.querySelector('.type-btn:last-child').classList.add('active');
            }
        }

        function renderCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';
            
            categories.forEach(cate => {
                const cateItem = document.createElement('div');
                cateItem.className = `category-item ${selectedCate === cate ? 'active' : ''}`;
                
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                cateItem.innerHTML = `
                    <div class="category-icon">${icon}</div>
                    <div class="category-name">${cateName}</div>
                `;
                
                cateItem.addEventListener('click', function() {
                    selectedCate = cate;
                    renderCategories();
                });
                
                cateItem.addEventListener('touchstart', function(e) {
                    longPressTimer = setTimeout(() => {
                        if (confirm(`ç¡®å®šè¦åˆ é™¤${cateName}åˆ†ç±»å—ï¼Ÿ`)) {
                            const index = categories.indexOf(cate);
                            if (index > -1) {
                                categories.splice(index, 1);
                                localStorage.setItem('phoneCates', JSON.stringify(categories));
                                renderCategories();
                                renderBudgetSetList();
                            }
                        }
                    }, 800);
                });
                
                cateItem.addEventListener('touchend', function() {
                    clearTimeout(longPressTimer);
                });
                
                cateItem.addEventListener('touchmove', function() {
                    clearTimeout(longPressTimer);
                });
                
                categoryGrid.appendChild(cateItem);
            });
        }

        function openAddCateModal() {
            document.getElementById('addCateModal').classList.add('show');
            document.getElementById('newCateInput').value = '';
            document.getElementById('newCateInput').focus();
        }

        function closeAddCateModal() {
            document.getElementById('addCateModal').classList.remove('show');
        }

        function saveNewCate() {
            const newCate = document.getElementById('newCateInput').value.trim();
            if (!newCate) {
                alert('è¯·è¾“å…¥åˆ†ç±»åç§°');
                return;
            }
            
            const cateName = newCate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
            if (!cateName) {
                alert('åˆ†ç±»åç§°ä¸èƒ½åªåŒ…å«ç¬¦å·æˆ–è¡¨æƒ…');
                return;
            }
            
            if (categories.some(c => c.includes(cateName))) {
                alert('è¯¥åˆ†ç±»å·²å­˜åœ¨');
                return;
            }
            
            const icon = cateIcons[cateName] || 'ğŸ”§';
            categories.push(`${cateName}${icon}`);
            localStorage.setItem('phoneCates', JSON.stringify(categories));
            
            closeAddCateModal();
            renderCategories();
            renderBudgetSetList();
        }

        function saveBill() {
            const amount = parseFloat(document.getElementById('billAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
                return;
            }
            
            if (!selectedCate) {
                alert('è¯·é€‰æ‹©åˆ†ç±»');
                return;
            }
            
            const newBill = {
                id: Date.now().toString(),
                amount: amount,
                type: currentType,
                category: selectedCate,
                date: formatDateToYMD(selectedDate),
                createdAt: new Date().toISOString()
            };
            
            bills.unshift(newBill);
            localStorage.setItem('phoneBills', JSON.stringify(bills));
            
            closeBillModal();
            renderHomePage();
            renderBudgets();
            renderCalendar();
        }

        function renderHomePage() {
            const billsList = document.getElementById('recentBillsList');
            const targetDate = formatDateToYMD(selectedDate);
            
            const dayBills = bills.filter(bill => bill.date === targetDate);
            
            if (dayBills.length === 0) {
                billsList.innerHTML = '<div class="bills-empty">æš‚æ— è´¦å•ï¼Œç‚¹å‡»+å¼€å§‹è®°å½•</div>';
            } else {
                billsList.innerHTML = '';
                dayBills.forEach(bill => {
                    const cateName = bill.category.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                    const icon = cateIcons[cateName] || bill.category.replace(cateName, '');
                    
                    const billContainer = document.createElement('div');
                    billContainer.className = 'bill-swipe-container';
                    
                    billContainer.innerHTML = `
                        <div class="bill-item" data-id="${bill.id}">
                            <div class="bill-left">
                                <div class="bill-icon">${icon}</div>
                                <div class="bill-info">
                                    <div class="bill-category">${cateName}</div>
                                    <div class="bill-date">${formatTime(bill.createdAt)}</div>
                                </div>
                            </div>
                            <div class="bill-amount ${bill.type}">${bill.type === 'expense' ? '-' : '+'}Â¥${bill.amount.toFixed(2)}</div>
                        </div>
                        <button class="bill-delete-btn" onclick="deleteBill('${bill.id}')"></button>
                    `;
                    
                    billsList.appendChild(billContainer);
                    
                    const billItem = billContainer.querySelector('.bill-item');
                    billItem.addEventListener('touchstart', handleBillTouchStart);
                    billItem.addEventListener('touchmove', handleBillTouchMove);
                    billItem.addEventListener('touchend', handleBillTouchEnd);
                });
            }
            
            updateMonthlyStats();
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function handleBillTouchStart(e) {
            startX = e.touches[0].clientX;
            currentBillId = this.dataset.id;
        }

        function handleBillTouchMove(e) {
            const currentX = e.touches[0].clientX;
            const diffX = startX - currentX;
            
            if (diffX > 0) {
                this.style.left = `-${Math.min(diffX, 60)}px`;
            }
        }

        function handleBillTouchEnd() {
            const billItem = document.querySelector(`.bill-item[data-id="${currentBillId}"]`);
            const currentLeft = Math.abs(parseFloat(billItem.style.left));
            
            if (currentLeft > 30) {
                billItem.style.left = '-60px';
            } else {
                billItem.style.left = '0';
            }
        }

        function deleteBill(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è´¦å•å—ï¼Ÿ')) {
                bills = bills.filter(bill => bill.id !== id);
                localStorage.setItem('phoneBills', JSON.stringify(bills));
                renderHomePage();
                renderBudgets();
                renderCalendar();
            } else {
                const billItem = document.querySelector(`.bill-item[data-id="${id}"]`);
                if (billItem) billItem.style.left = '0';
            }
        }

        function updateMonthlyStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            let totalExpense = 0;
            let totalIncome = 0;
            
            bills.forEach(bill => {
                const billDate = new Date(bill.date);
                if (billDate.getMonth() === currentMonth && billDate.getFullYear() === currentYear) {
                    if (bill.type === 'expense') {
                        totalExpense += bill.amount;
                    } else {
                        totalIncome += bill.amount;
                    }
                }
            });
            
            const balance = totalIncome - totalExpense;
            
            document.getElementById('monthExpense').textContent = `Â¥${totalExpense.toFixed(2)}`;
            document.getElementById('monthIncome').textContent = `Â¥${totalIncome.toFixed(2)}`;
            document.getElementById('accountBalance').textContent = `Â¥${balance.toFixed(2)}`;
        }

        // ========== é¢„ç®—ç®¡ç†åŠŸèƒ½ ==========
        function openBudgetModal() {
            renderBudgetSetList();
            document.getElementById('budgetModal').classList.add('show');
        }

        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.remove('show');
        }

        function renderBudgetSetList() {
            const budgetSetList = document.getElementById('budgetSetList');
            budgetSetList.innerHTML = '';
            
            const monthKey = getCurrentMonthKey();
            if (!monthlyBudgets[monthKey]) {
                monthlyBudgets[monthKey] = {};
            }
            
            categories.forEach(cate => {
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                const budgetItem = document.createElement('div');
                budgetItem.className = 'budget-set-item';
                
                budgetItem.innerHTML = `
                    <div class="budget-set-cate">
                        <div class="budget-set-icon">${icon}</div>
                        <div class="budget-set-name">${cateName}</div>
                    </div>
                    <input type="number" class="budget-set-input" data-cate="${cate}" 
                           value="${monthlyBudgets[monthKey][cate] || ''}" 
                           placeholder="0" min="0" step="0.01">
                `;
                
                budgetSetList.appendChild(budgetItem);
            });
        }

        function saveAllBudgets() {
            const monthKey = getCurrentMonthKey();
            const inputs = document.querySelectorAll('.budget-set-input');
            
            inputs.forEach(input => {
                const cate = input.dataset.cate;
                const value = parseFloat(input.value) || 0;
                monthlyBudgets[monthKey][cate] = value > 0 ? value : null;
            });
            
            localStorage.setItem('monthlyBudgets', JSON.stringify(monthlyBudgets));
            closeBudgetModal();
            renderBudgets();
        }

        function renderBudgets() {
            const budgetList = document.getElementById('budgetList');
            budgetList.innerHTML = '';
            
            const monthKey = getCurrentMonthKey();
            if (!monthlyBudgets[monthKey]) {
                budgetList.innerHTML = '<div class="bills-empty">æš‚æ— é¢„ç®—è®¾ç½®</div>';
                return;
            }
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const budgetCates = Object.entries(monthlyBudgets[monthKey])
                .filter(([_, amount]) => amount > 0)
                .map(([cate, _]) => cate);
            
            if (budgetCates.length === 0) {
                budgetList.innerHTML = '<div class="bills-empty">æš‚æ— é¢„ç®—è®¾ç½®</div>';
                return;
            }
            
            const cateExpenses = {};
            budgetCates.forEach(cate => {
                cateExpenses[cate] = 0;
            });
            
            bills.forEach(bill => {
                const billDate = new Date(bill.date);
                if (bill.type === 'expense' && 
                    billDate.getMonth() === currentMonth && 
                    billDate.getFullYear() === currentYear && 
                    budgetCates.includes(bill.category)) {
                    
                    cateExpenses[bill.category] += bill.amount;
                }
            });
            
            budgetCates.forEach(cate => {
                const budgetAmount = monthlyBudgets[monthKey][cate];
                const usedAmount = cateExpenses[cate];
                const remainAmount = budgetAmount - usedAmount;
                
                const cateName = cate.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                const icon = cateIcons[cateName] || cate.replace(cateName, '');
                
                const budgetItem = document.createElement('div');
                budgetItem.className = 'budget-item';
                
                budgetItem.innerHTML = `
                    <div class="budget-cate">
                        <div class="budget-cate-icon">${icon}</div>
                        <div class="budget-cate-name">${cateName}</div>
                    </div>
                    <div class="budget-usage">
                        <div class="budget-used ${remainAmount < 0 ? 'budget-over' : ''}">
                            Â¥${usedAmount.toFixed(2)}/${budgetAmount.toFixed(2)}
                        </div>
                        <div class="budget-remain ${remainAmount < 0 ? 'budget-over' : ''}">
                            ${remainAmount < 0 ? 'è¶…æ”¯' : 'å‰©ä½™'} Â¥${Math.abs(remainAmount).toFixed(2)}
                        </div>
                    </div>
                `;
                
                budgetList.appendChild(budgetItem);
            });
        }

        // ========== åˆå§‹åŒ–åº”ç”¨ ==========
        window.onload = function() {
            initApp();
        };
    </script>
</body>
</html>

