<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <title>Âè¶‰∏Ä‰∏™Êàë - ËÆ∞Ë¥¶App</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ÂÖ®Â±ÄÈáçÁΩÆ */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            background: #F2F2F7; 
            font-size: 16px; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            line-height: 1.5;
            color: #1C1C1E;
            overflow-x: hidden;
        }
        /* ÂØÜÁ†ÅÈîÅÈ°µÈù¢ */
        .lock-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .lock-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        .app-logo {
            margin-bottom: 30px;
        }
        .logo-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .app-title {
            font-size: 28px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 5px;
        }
        .app-subtitle {
            font-size: 14px;
            color: #8E8E93;
            font-weight: 400;
        }
        .lock-title {
            font-size: 18px;
            color: #1C1C1E;
            margin-bottom: 25px;
            font-weight: 500;
        }
        .password-inputs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center;
        }
        .password-input {
            width: 55px;
            height: 55px;
            border: 2px solid #E5E5EA;
            border-radius: 12px;
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            background: #fff;
            -webkit-appearance: none;
            appearance: none;
            transition: all 0.2s ease;
        }
        .password-input:focus {
            border-color: #007AFF;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        .unlock-btn {
            width: 100%;
            padding: 15px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 20px;
        }
        .unlock-btn:hover {
            background: #0056CC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }
        .lock-hint {
            font-size: 13px;
            color: #8E8E93;
            line-height: 1.4;
        }
        .hint-small {
            font-size: 11px;
            opacity: 0.8;
        }
        /* ‰∏ªÈ°µÈù¢ */
        #mainPage {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        .main-nav {
            background: #fff;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #E5E5EA;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.92);
        }
        .nav-left {
            display: flex;
            flex-direction: column;
        }
        .nav-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .nav-date {
            font-size: 13px;
            color: #8E8E93;
            margin-top: 2px;
        }
        .nav-right {
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            background: #F2F2F7;
            color: #1C1C1E;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-btn:hover {
            background: #E5E5EA;
            transform: scale(1.05);
        }
        .page-container {
            padding: 16px;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Âç°ÁâáÊ†∑Âºè */
        .stats-card,
        .budget-card,
        .calendar-card,
        .recent-bills {
            background: #fff;
            border-radius: 20px;
            margin-bottom: 16px;
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
        }
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .stats-title {
            font-size: 18px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .stats-period {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .period-nav {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F2F2F7;
            color: #1C1C1E;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .period-nav:hover {
            background: #E5E5EA;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 15px 10px;
            background: #F8F8FA;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .stat-label {
            font-size: 13px;
            color: #8E8E93;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .stat-value.expense {
            color: #FF3B30;
        }
        .stat-value.income {
            color: #34C759;
        }
        .stat-value.balance {
            color: #007AFF;
        }
        .stat-trend {
            font-size: 11px;
            opacity: 0.8;
        }
        /* È¢ÑÁÆóÂç°Áâá */
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .budget-title {
            font-size: 18px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .budget-actions {
            display: flex;
            gap: 8px;
        }
        .budget-action-btn {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }
        .budget-action-btn:hover {
            background: #E5E5EA;
        }
        .budget-progress-container {
            margin-bottom: 20px;
        }
        .budget-progress-bar {
            height: 8px;
            background: #F2F2F7;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #34C759, #007AFF);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .budget-progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #8E8E93;
        }
        .budget-list {
            min-height: 100px;
        }
        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        .empty-title {
            font-size: 16px;
            color: #1C1C1E;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .empty-desc {
            font-size: 14px;
            color: #8E8E93;
            margin-bottom: 20px;
        }
        .empty-action {
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid #007AFF;
            background: transparent;
            color: #007AFF;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .empty-action:hover {
            background: rgba(0, 122, 255, 0.1);
        }
        /* Êó•ÂéÜÂç°Áâá */
        .calendar-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-title {
            font-size: 18px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .calendar-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .calendar-nav-btn:hover {
            background: #E5E5EA;
        }
        .mini-calendar {
            background: #F8F8FA;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .calendar-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 10px;
        }
        .week-day {
            font-size: 13px;
            color: #8E8E93;
            padding: 5px 0;
        }
        .week-day.sun {
            color: #FF3B30;
        }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 14px;
            color: #1C1C1E;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .calendar-day:hover:not(.empty) {
            background: rgba(0, 122, 255, 0.1);
        }
        .calendar-day.active {
            background: #007AFF;
            color: white;
        }
        .calendar-day.today {
            border: 2px solid #007AFF;
        }
        .calendar-day.has-bill::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #FF3B30;
        }
        .calendar-day.empty {
            color: #C7C7CC;
            cursor: default;
        }
        .calendar-actions {
            text-align: center;
        }
        .calendar-full-btn {
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid #007AFF;
            background: transparent;
            color: #007AFF;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }
        .calendar-full-btn:hover {
            background: rgba(0, 122, 255, 0.1);
        }
        /* ÊúÄËøëË¥¶Âçï */
        .recent-bills {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
        }
        .bills-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .bills-title {
            font-size: 18px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .bills-filter {
            position: relative;
        }
        .filter-select {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
            min-width: 100px;
        }
        .filter-select:focus {
            outline: none;
            border-color: #007AFF;
        }
        .bills-list {
            min-height: 100px;
        }
        .bill-item {
            background: #F8F8FA;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .bill-item:hover {
            background: #E5E5EA;
            transform: translateX(4px);
        }
        .bill-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .bill-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .bill-info {
            display: flex;
            flex-direction: column;
        }
        .bill-category {
            font-size: 15px;
            font-weight: 600;
            color: #1C1C1E;
            margin-bottom: 2px;
        }
        .bill-date {
            font-size: 12px;
            color: #8E8E93;
        }
        .bill-amount {
            font-size: 16px;
            font-weight: 700;
        }
        .bill-amount.expense {
            color: #FF3B30;
        }
        .bill-amount.income {
            color: #34C759;
        }
        .bill-note {
            font-size: 12px;
            color: #8E8E93;
            margin-top: 4px;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Â∫ïÈÉ®ÂØºËà™ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            border-top: 1px solid #E5E5EA;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.92);
        }
        .nav-item {
            background: transparent;
            border: none;
            color: #8E8E93;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            transition: all 0.2s ease;
            flex: 1;
            max-width: 60px;
        }
        .nav-item.active {
            color: #007AFF;
        }
        .nav-icon {
            font-size: 22px;
        }
        .nav-text {
            font-size: 11px;
        }
        .add-btn {
            background: #007AFF;
            color: white;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            margin-top: -20px;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.3);
            transition: all 0.3s ease;
        }
        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 122, 255, 0.4);
        }
        /* Ê®°ÊÄÅÊ°Ü */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: #fff;
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal.large .modal-content {
            max-width: 700px;
        }
        .modal.small .modal-content {
            max-width: 400px;
        }
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #E5E5EA;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: #F2F2F7;
            color: #1C1C1E;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: #E5E5EA;
        }
        .modal-body {
            padding: 20px;
        }
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #E5E5EA;
            display: flex;
            gap: 10px;
        }
        .modal-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .save-btn {
            background: #007AFF;
            color: white;
        }
        .save-btn:hover {
            background: #0056CC;
        }
        .cancel-btn {
            background: #F2F2F7;
            color: #1C1C1E;
        }
        .cancel-btn:hover {
            background: #E5E5EA;
        }
        /* ËæìÂÖ•ÁªÑ */
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            font-size: 14px;
            color: #1C1C1E;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .text-input,
        .select-input,
        .date-input,
        .number-input,
        .textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #E5E5EA;
            border-radius: 12px;
            font-size: 16px;
            background: #fff;
            color: #1C1C1E;
            transition: all 0.2s ease;
        }
        .text-input:focus,
        .select-input:focus,
        .date-input:focus,
        .number-input:focus,
        .textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        .textarea {
            min-height: 100px;
            resize: vertical;
        }
        .input-error {
            color: #FF3B30;
            font-size: 13px;
            margin-top: 5px;
            min-height: 20px;
        }
        /* ÈáëÈ¢ùËæìÂÖ• */
        .amount-section {
            text-align: center;
            margin-bottom: 30px;
        }
        .amount-label {
            font-size: 14px;
            color: #8E8E93;
            margin-bottom: 10px;
        }
        .amount-input {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            border: none;
            border-bottom: 2px solid #E5E5EA;
            background: transparent;
            width: 100%;
            padding: 10px 0;
            color: #1C1C1E;
            transition: all 0.2s ease;
        }
        .amount-input:focus {
            outline: none;
            border-bottom-color: #007AFF;
        }
        .amount-error {
            color: #FF3B30;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
        }
        /* Á±ªÂûãÂàáÊç¢ */
        .type-section {
            margin-bottom: 30px;
        }
        .type-label {
            font-size: 14px;
            color: #8E8E93;
            margin-bottom: 10px;
        }
        .type-toggle {
            display: flex;
            gap: 10px;
        }
        .type-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #E5E5EA;
            border-radius: 12px;
            background: transparent;
            color: #1C1C1E;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .type-btn.active {
            border-color: #007AFF;
            background: #007AFF;
            color: white;
        }
        .type-btn:hover:not(.active) {
            background: #F2F2F7;
        }
        /* ÂàÜÁ±ªÁΩëÊ†º */
        .category-section {
            margin-bottom: 30px;
        }
        .category-label {
            font-size: 14px;
            color: #8E8E93;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .hint-text {
            font-size: 12px;
            opacity: 0.7;
        }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        .category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            border-radius: 12px;
            background: #F8F8FA;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .category-item:hover {
            background: #E5E5EA;
        }
        .category-item.active {
            border-color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
        }
        .category-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .category-name {
            font-size: 12px;
            color: #1C1C1E;
            text-align: center;
        }
        .add-cate-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed #E5E5EA;
            border-radius: 12px;
            background: #F8F8FA;
            color: #8E8E93;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .add-cate-btn:hover {
            border-color: #007AFF;
            color: #007AFF;
        }
        .add-cate-btn.full {
            margin-top: 20px;
        }
        /* ÂõæÊ†áÈÄâÊã©Âô® */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .icon-option {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 2px solid #E5E5EA;
            background: #F8F8FA;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .icon-option:hover {
            background: #E5E5EA;
        }
        .icon-option.selected {
            border-color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
        }
        /* ÁªüËÆ°È°µÈù¢ */
        .stats-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .stats-period-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .period-select {
            padding: 8px 16px;
            border-radius: 12px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            cursor: pointer;
        }
        .custom-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        @media (min-width: 768px) {
            .charts-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .chart-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.04);
        }
        .chart-card.full-width {
            grid-column: 1 / -1;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .chart-title {
            font-size: 16px;
            font-weight: 700;
            color: #1C1C1E;
        }
        .chart-legend {
            display: flex;
            gap: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #8E8E93;
        }
        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .legend-item.expense .legend-dot {
            background: #FF3B30;
        }
        .legend-item.income .legend-dot {
            background: #34C759;
        }
        .chart-wrapper {
            position: relative;
            height: 250px;
        }
        .chart-type-select {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            cursor: pointer;
        }
        .chart-actions {
            display: flex;
            gap: 10px;
        }
        .chart-action-btn {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .chart-action-btn:hover {
            background: #E5E5EA;
        }
        /* ÁªüËÆ°ÊëòË¶Å */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        .summary-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: #F8F8FA;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-content {
            flex: 1;
        }
        .summary-label {
            font-size: 13px;
            color: #8E8E93;
            margin-bottom: 5px;
        }
        .summary-value {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 3px;
        }
        .summary-detail {
            font-size: 12px;
            color: #8E8E93;
        }
        /* ÂÆåÊï¥Êó•ÂéÜ */
        .calendar-full {
            background: #fff;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-tools {
            display: flex;
            gap: 10px;
        }
        .tool-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            color: #1C1C1E;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
        }
        .tool-btn:hover {
            background: #E5E5EA;
        }
        .calendar-body {
            margin-bottom: 20px;
        }
        .calendar-days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .calendar-day-large {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 16px;
            color: #1C1C1E;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            padding: 8px 2px;
        }
        .calendar-day-large:hover:not(.empty) {
            background: rgba(0, 122, 255, 0.1);
        }
        .calendar-day-large.active {
            background: #007AFF;
            color: white;
        }
        .calendar-day-large.today {
            border: 2px solid #007AFF;
        }
        .calendar-day-large.has-bill::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #FF3B30;
        }
        .calendar-day-large.empty {
            color: #C7C7CC;
            cursor: default;
        }
        .day-amount {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.7;
        }
        .calendar-footer {
            padding-top: 20px;
            border-top: 1px solid #E5E5EA;
        }
        .day-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .summary-label {
            font-size: 12px;
            color: #8E8E93;
        }
        .summary-value {
            font-size: 14px;
            font-weight: 600;
            color: #1C1C1E;
        }
        /* Êï∞ÊçÆÂØºÂá∫È°µÈù¢ */
        .export-section,
        .import-section,
        .data-stats {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #E5E5EA;
        }
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1C1C1E;
            margin-bottom: 15px;
        }
        .export-options,
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        .option-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #E5E5EA;
            background: #F8F8FA;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option-item:hover {
            background: #E5E5EA;
        }
        .option-item input[type="radio"] {
            accent-color: #007AFF;
        }
        .option-content {
            flex: 1;
        }
        .option-icon {
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .option-text {
            font-size: 16px;
            font-weight: 600;
            color: #1C1C1E;
            margin-bottom: 2px;
        }
        .option-desc {
            font-size: 13px;
            color: #8E8E93;
        }
        .export-date-range {
            margin-bottom: 20px;
        }
        .date-range-label {
            font-size: 14px;
            color: #1C1C1E;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .date-range-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        .export-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .export-btn {
            background: #007AFF;
            color: white;
        }
        .export-btn:hover {
            background: #0056CC;
        }
        .export-btn.secondary {
            background: #F2F2F7;
            color: #1C1C1E;
        }
        .export-btn.secondary:hover {
            background: #E5E5EA;
        }
        .file-input-container {
            margin-bottom: 20px;
        }
        .file-select-btn {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 2px dashed #E5E5EA;
            background: #F8F8FA;
            color: #8E8E93;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .file-select-btn:hover {
            border-color: #007AFF;
            color: #007AFF;
        }
        .file-info {
            font-size: 14px;
            color: #8E8E93;
            text-align: center;
        }
        .import-btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: #34C759;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .import-btn:hover {
            background: #2DAE4A;
        }
        .import-note {
            font-size: 13px;
            color: #8E8E93;
            margin-top: 15px;
            padding: 12px;
            background: #F8F8FA;
            border-radius: 8px;
        }
        .data-stats .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .data-stats .stat-item {
            background: #F8F8FA;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .data-stats .stat-label {
            font-size: 13px;
            color: #8E8E93;
            margin-bottom: 5px;
        }
        .data-stats .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }
        /* Á°ÆËÆ§ÂØπËØùÊ°Ü */
        .confirm-modal .modal-content {
            max-width: 400px;
        }
        .confirm-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
        }
        .confirm-message {
            font-size: 16px;
            color: #1C1C1E;
            text-align: center;
            line-height: 1.5;
        }
        .confirm-btn {
            background: #FF3B30;
            color: white;
        }
        .confirm-btn:hover {
            background: #D70015;
        }
        /* Ëá™ÂÆö‰πâÊèêÁ§∫Ê°Ü */
        .custom-alert {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        .alert-content {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            max-width: 300px;
            width: 100%;
            text-align: center;
            animation: slideUp 0.3s ease;
        }
        .alert-text {
            font-size: 17px;
            color: #1C1C1E;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        .alert-close {
            padding: 10px 30px;
            border-radius: 12px;
            border: none;
            background: #007AFF;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .alert-close:hover {
            background: #0056CC;
        }
        /* ÊèêÁ§∫ÂíåÊèêÁ§∫Ê°Ü */
        .tips {
            background: #F8F8FA;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }
        .tip-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        .tip-content {
            flex: 1;
        }
        .tip-content strong {
            display: block;
            color: #1C1C1E;
            margin-bottom: 8px;
        }
        .tip-content ul {
            margin-left: 20px;
            color: #8E8E93;
            font-size: 14px;
            line-height: 1.5;
        }
        .tip-content li {
            margin-bottom: 4px;
        }
        /* ÊªëÂä®Âà†Èô§ÊïàÊûú */
        .swipe-container {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }
        .swipe-content {
            position: relative;
            background: #fff;
            transition: transform 0.3s ease;
            z-index: 1;
        }
        .swipe-actions {
            position: absolute;
            top: 0;
            right: -100px;
            bottom: 0;
            display: flex;
            align-items: center;
            padding: 0 15px;
            background: #FF3B30;
            transition: right 0.3s ease;
            z-index: 0;
        }
        .swipe-container.swiped .swipe-actions {
            right: 0;
        }
        .swipe-container.swiped .swipe-content {
            transform: translateX(-80px);
        }
        .delete-action {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .delete-action:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .stats-summary {
                grid-template-columns: 1fr;
            }
            .date-range-inputs {
                flex-direction: column;
                align-items: stretch;
            }
            .export-buttons {
                flex-direction: column;
            }
            .day-summary {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 480px) {
            .modal-content {
                margin: 10px;
            }
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .nav-text {
                display: none;
            }
            .bottom-nav {
                padding: 8px 0;
            }
            .nav-item {
                max-width: 44px;
            }
            .add-btn {
                width: 48px;
                height: 48px;
            }
        }
        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #F2F2F7;
            border-top: 3px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Â∑•ÂÖ∑Á±ª */
        .hidden {
            display: none !important;
        }
        .text-center {
            text-align: center;
        }
        .text-right {
            text-align: right;
        }
        .text-left {
            text-align: left;
        }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-5 { margin-bottom: 20px; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 12px; }
        .mt-4 { margin-top: 16px; }
        .mt-5 { margin-top: 20px; }
        .p-1 { padding: 4px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-5 { padding: 20px; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-1 { flex: 1; }
        .gap-1 { gap: 4px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-5 { gap: 20px; }
        .rounded-sm { border-radius: 4px; }
        .rounded { border-radius: 8px; }
        .rounded-lg { border-radius: 12px; }
        .rounded-xl { border-radius: 16px; }
        .rounded-2xl { border-radius: 20px; }
        .shadow-sm { box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
        .shadow { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        .shadow-lg { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <!-- ÂØÜÁ†ÅÈîÅÈ°µÈù¢ -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-content">
            <div class="app-logo">
                <div class="logo-icon">üí∞</div>
                <h1 class="app-title">Âè¶‰∏Ä‰∏™Êàë</h1>
                <p class="app-subtitle">‰Ω†ÁöÑÁßÅ‰∫∫ËÆ∞Ë¥¶Âä©Êâã</p>
            </div>
            <div class="lock-title">ËØ∑ËæìÂÖ•4‰ΩçÊï∞Â≠óÂØÜÁ†Å</div>
            <div class="password-inputs">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
                <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)" onkeypress="return isNumberKey(event)">
            </div>
            <button class="unlock-btn" onclick="checkPassword()">Ëß£ÈîÅ</button>
            <div class="lock-hint">
                <p>ÂàùÂßãÂØÜÁ†ÅÔºö0517</p>
                <p class="hint-small">ÂØÜÁ†ÅÂ≠òÂÇ®Âú®Êú¨Âú∞ÔºåÁ°Æ‰øùËÆæÂ§áÂÆâÂÖ®</p>
            </div>
        </div>
    </div>

    <!-- Ëá™ÂÆö‰πâÊèêÁ§∫Ê°Ü -->
    <div class="custom-alert" id="customAlert">
        <div class="alert-content">
            <div class="alert-text" id="alertText"></div>
            <button class="alert-close" onclick="closeAlert()">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- ‰∏ªÈ°µÈù¢ -->
    <div id="mainPage" style="display: none;">
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <div class="main-nav">
            <div class="nav-left">
                <div class="nav-title">Âè¶‰∏Ä‰∏™Êàë</div>
                <div class="nav-date" id="navDate"></div>
            </div>
            <div class="nav-right">
                <button class="nav-btn stats-btn" onclick="showPage('stats')" title="ÁªüËÆ°ÂõæË°®">
                    <span class="btn-icon">üìä</span>
                </button>
                <button class="nav-btn export-btn" onclick="openExportModal()" title="ÂØºÂá∫Êï∞ÊçÆ">
                    <span class="btn-icon">üì§</span>
                </button>
                <button class="nav-btn lock-btn" onclick="lockApp()" title="ÈîÅÂÆöÂ∫îÁî®">
                    <span class="btn-icon">üîí</span>
                </button>
            </div>
        </div>

        <!-- È°µÈù¢ÂÆπÂô® -->
        <div class="page-container">
            <!-- ‰∏ªÈ°µÂÜÖÂÆπ -->
            <div class="page active" id="homePage">
                <!-- Êî∂ÊîØÁªüËÆ°Âç°Áâá -->
                <div class="stats-card">
                    <div class="stats-header">
                        <h3 class="stats-title">Êú¨ÊúàÊ¶ÇÂÜµ</h3>
                        <div class="stats-period">
                            <span id="currentMonthText"></span>
                            <button class="period-nav" onclick="prevMonth()">‚Äπ</button>
                            <button class="period-nav" onclick="nextMonth()">‚Ä∫</button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">ÊîØÂá∫</div>
                            <div class="stat-value expense" id="monthExpense">¬•0.00</div>
                            <div class="stat-trend" id="expenseTrend"></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Êî∂ÂÖ•</div>
                            <div class="stat-value income" id="monthIncome">¬•0.00</div>
                            <div class="stat-trend" id="incomeTrend"></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Áªì‰Ωô</div>
                            <div class="stat-value balance" id="accountBalance">¬•0.00</div>
                            <div class="stat-trend" id="balanceTrend"></div>
                        </div>
                    </div>
                </div>

                <!-- È¢ÑÁÆóÂå∫Âüü -->
                <div class="budget-card">
                    <div class="budget-header">
                        <h3 class="budget-title">È¢ÑÁÆóÁÆ°ÁêÜ</h3>
                        <div class="budget-actions">
                            <button class="budget-action-btn" onclick="openBudgetModal()">
                                <span class="btn-icon">‚öôÔ∏è</span> ËÆæÁΩÆ
                            </button>
                            <button class="budget-action-btn" onclick="resetBudgets()">
                                <span class="btn-icon">üîÑ</span> ÈáçÁΩÆ
                            </button>
                        </div>
                    </div>
                    
                    <div class="budget-progress-container">
                        <div class="budget-progress-bar">
                            <div class="progress-fill" id="overallBudgetProgress" style="width: 0%"></div>
                        </div>
                        <div class="budget-progress-text">
                            <span>ÊÄªÈ¢ÑÁÆó‰ΩøÁî®Áéá: <span id="overallBudgetPercent">0%</span></span>
                            <span id="overallBudgetAmount">¬•0/¬•0</span>
                        </div>
                    </div>
                    
                    <div class="budget-list" id="budgetList">
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">ÊöÇÊó†È¢ÑÁÆó</div>
                            <div class="empty-desc">ËÆæÁΩÆÈ¢ÑÁÆóÂèØ‰ª•Êõ¥Â•ΩÂú∞ÊéßÂà∂Ê∂àË¥π</div>
                            <button class="empty-action" onclick="openBudgetModal()">ËÆæÁΩÆÈ¢ÑÁÆó</button>
                        </div>
                    </div>
                </div>

                <!-- Êó•ÂéÜÂå∫Âüü -->
                <div class="calendar-card">
                    <div class="calendar-header">
                        <h3 class="calendar-title">Êó•ÂéÜËßÜÂõæ</h3>
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
                            <span id="calendarMonthText"></span>
                            <button class="calendar-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
                        </div>
                    </div>
                    
                    <div class="mini-calendar">
                        <div class="calendar-week">
                            <div class="week-day sun">Êó•</div>
                            <div class="week-day">‰∏Ä</div>
                            <div class="week-day">‰∫å</div>
                            <div class="week-day">‰∏â</div>
                            <div class="week-day">Âõõ</div>
                            <div class="week-day">‰∫î</div>
                            <div class="week-day">ÂÖ≠</div>
                        </div>
                        <div class="calendar-days" id="miniCalendarDays"></div>
                    </div>
                    
                    <div class="calendar-actions">
                        <button class="calendar-full-btn" onclick="openCalendarModal()">
                            <span class="btn-icon">üìÖ</span> ÂÆåÊï¥Êó•ÂéÜ
                        </button>
                    </div>
                </div>

                <!-- ÊúÄËøëË¥¶Âçï -->
                <div class="recent-bills">
                    <div class="bills-header">
                        <h3 class="bills-title">ÂΩìÊó•Ë¥¶Âçï</h3>
                        <div class="bills-filter">
                            <select class="filter-select" id="billFilter" onchange="filterBills()">
                                <option value="today">‰ªäÊó•</option>
                                <option value="week">Êú¨Âë®</option>
                                <option value="month">Êú¨Êúà</option>
                                <option value="all">ÂÖ®ÈÉ®</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="bills-list" id="recentBillsList">
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <div class="empty-title">ÊöÇÊó†Ë¥¶ÂçïËÆ∞ÂΩï</div>
                            <div class="empty-desc">ÁÇπÂáª‰∏ãÊñπ+ÊåâÈíÆÂºÄÂßãËÆ∞Ë¥¶</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÁªüËÆ°È°µÈù¢ -->
            <div class="page" id="statsPage">
                <div class="stats-page-header">
                    <h2 class="page-title">Êï∞ÊçÆÁªüËÆ°</h2>
                    <div class="stats-period-selector">
                        <select class="period-select" id="chartPeriod" onchange="updateCharts()">
                            <option value="month">Êú¨Êúà</option>
                            <option value="quarter">Êú¨Â≠£Â∫¶</option>
                            <option value="year">Êú¨Âπ¥</option>
                            <option value="custom">Ëá™ÂÆö‰πâ</option>
                        </select>
                        <div class="custom-range" id="customRange" style="display: none;">
                            <input type="date" id="startDate" class="date-input">
                            <span>Ëá≥</span>
                            <input type="date" id="endDate" class="date-input">
                            <button onclick="applyCustomRange()">Â∫îÁî®</button>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">ÊúàÂ∫¶Êî∂ÊîØË∂ãÂäø</h3>
                            <div class="chart-legend">
                                <span class="legend-item expense"><span class="legend-dot"></span>ÊîØÂá∫</span>
                                <span class="legend-item income"><span class="legend-dot"></span>Êî∂ÂÖ•</span>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">ÊîØÂá∫ÂàÜÁ±ªÂç†ÊØî</h3>
                            <select class="chart-type-select" id="pieChartType" onchange="updateCharts()">
                                <option value="expense">ÊîØÂá∫</option>
                                <option value="income">Êî∂ÂÖ•</option>
                            </select>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card full-width">
                        <div class="chart-header">
                            <h3 class="chart-title">È¢ÑÁÆóÊâßË°åÊÉÖÂÜµ</h3>
                            <div class="chart-actions">
                                <button class="chart-action-btn" onclick="toggleBudgetChartType()">ÂàáÊç¢ËßÜÂõæ</button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="stats-summary">
                    <div class="summary-card">
                        <div class="summary-icon">üí∞</div>
                        <div class="summary-content">
                            <div class="summary-label">ÊúÄÂ§ßÊîØÂá∫</div>
                            <div class="summary-value" id="maxExpense">¬•0.00</div>
                            <div class="summary-detail" id="maxExpenseDetail">Êó†ËÆ∞ÂΩï</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üìà</div>
                        <div class="summary-content">
                            <div class="summary-label">Âπ≥ÂùáÊØèÊó•ÊîØÂá∫</div>
                            <div class="summary-value" id="avgDailyExpense">¬•0.00</div>
                            <div class="summary-detail">ËæÉ‰∏äÊúà: <span id="expenseChange">0%</span></div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üéØ</div>
                        <div class="summary-content">
                            <div class="summary-label">È¢ÑÁÆóÂÆåÊàêÁéá</div>
                            <div class="summary-value" id="budgetCompletion">0%</div>
                            <div class="summary-detail" id="budgetStatus">Êú™ËÆæÁΩÆ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®ÂäüËÉΩÊåâÈíÆ -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showPage('home')">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">È¶ñÈ°µ</span>
            </button>
            <button class="nav-item" onclick="showPage('stats')">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">ÁªüËÆ°</span>
            </button>
            <button class="nav-item add-btn" onclick="openBillModal()">
                <span class="nav-icon">+</span>
                <span class="nav-text">ËÆ∞Ë¥¶</span>
            </button>
            <button class="nav-item" onclick="openCalendarModal()">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-text">Êó•ÂéÜ</span>
            </button>
            <button class="nav-item" onclick="openCategoryModal()">
                <span class="nav-icon">üè∑Ô∏è</span>
                <span class="nav-text">ÂàÜÁ±ª</span>
            </button>
        </div>

        <!-- ËÆ∞Ë¥¶ÂºπÁ™ó -->
        <div class="modal" id="billModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">ËÆ∞ÂΩïË¥¶Âçï</h3>
                    <button class="modal-close" onclick="closeBillModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="amount-section">
                        <div class="amount-label">ÈáëÈ¢ù</div>
                        <input type="number" class="amount-input" id="billAmount" placeholder="0.00" min="0.01" step="0.01" oninput="validateAmount(this)">
                        <div class="amount-error" id="amountError"></div>
                    </div>
                    
                    <div class="type-section">
                        <div class="type-label">Á±ªÂûã</div>
                        <div class="type-toggle">
                            <button class="type-btn active" data-type="expense" onclick="setType('expense')">
                                <span class="type-icon">üì§</span> ÊîØÂá∫
                            </button>
                            <button class="type-btn" data-type="income" onclick="setType('income')">
                                <span class="type-icon">üì•</span> Êî∂ÂÖ•
                            </button>
                        </div>
                    </div>
                    
                    <div class="date-section">
                        <div class="date-label">Êó•Êúü</div>
                        <div class="date-input-group">
                            <input type="date" class="date-input" id="billDate" value="" onchange="updateDateDisplay()">
                            <div class="date-display" id="billDateDisplay"></div>
                        </div>
                    </div>
                    
                    <div class="category-section">
                        <div class="category-label">
                            ÂàÜÁ±ª
                            <span class="hint-text">ÔºàÈïøÊåâÂàÜÁ±ªÂèØÂà†Èô§Ôºâ</span>
                        </div>
                        <div class="category-grid" id="categoryGrid"></div>
                        <button class="add-cate-btn" onclick="openAddCateModal()">
                            <span class="btn-icon">+</span> Êñ∞Â¢ûÂàÜÁ±ª
                        </button>
                    </div>
                    
                    <div class="note-section">
                        <div class="note-label">Â§áÊ≥®ÔºàÂèØÈÄâÔºâ</div>
                        <textarea class="note-input" id="billNote" placeholder="Ê∑ªÂä†Â§áÊ≥®..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveBill()">
                        <span class="btn-icon">üíæ</span> ‰øùÂ≠ò
                    </button>
                    <button class="modal-btn cancel-btn" onclick="closeBillModal()">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- ÂÆåÊï¥Êó•ÂéÜÂºπÁ™ó -->
        <div class="modal large" id="calendarModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Êó•ÂéÜ</h3>
                    <button class="modal-close" onclick="closeCalendarModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="calendar-full">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                                    <span class="nav-icon">‚Äπ</span>
                                </button>
                                <div class="calendar-title">
                                    <span id="calendarYear"></span>Âπ¥
                                    <span id="calendarMonth"></span>Êúà
                                </div>
                                <button class="calendar-nav-btn" onclick="changeMonth(1)">
                                    <span class="nav-icon">‚Ä∫</span>
                                </button>
                            </div>
                            <div class="calendar-tools">
                                <button class="tool-btn" onclick="jumpToToday()">
                                    <span class="btn-icon">üìç</span> ‰ªäÂ§©
                                </button>
                            </div>
                        </div>
                        
                        <div class="calendar-body">
                            <div class="calendar-week">
                                <div class="week-day sun">Êó•</div>
                                <div class="week-day">‰∏Ä</div>
                                <div class="week-day">‰∫å</div>
                                <div class="week-day">‰∏â</div>
                                <div class="week-day">Âõõ</div>
                                <div class="week-day">‰∫î</div>
                                <div class="week-day">ÂÖ≠</div>
                            </div>
                            <div class="calendar-days-grid" id="calendarDaysGrid"></div>
                        </div>
                        
                        <div class="calendar-footer">
                            <div class="day-summary">
                                <div class="summary-item">
                                    <span class="summary-label">ÈÄâ‰∏≠Êó•Êúü:</span>
                                    <span class="summary-value" id="selectedDateText"></span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">ÂΩìÊó•Ë¥¶Âçï:</span>
                                    <span class="summary-value" id="selectedDateBills">0Á¨î</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">ÊÄªÈáëÈ¢ù:</span>
                                    <span class="summary-value" id="selectedDateAmount">¬•0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- È¢ÑÁÆóËÆæÁΩÆÂºπÁ™ó -->
        <div class="modal" id="budgetModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">ËÆæÁΩÆÈ¢ÑÁÆó</h3>
                    <button class="modal-close" onclick="closeBudgetModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="budget-period">
                        <div class="period-label">È¢ÑÁÆóÂë®Êúü</div>
                        <select class="period-select" id="budgetPeriod" onchange="changeBudgetPeriod()">
                            <option value="monthly">ÊúàÂ∫¶È¢ÑÁÆó</option>
                            <option value="weekly">Âë®Â∫¶È¢ÑÁÆó</option>
                            <option value="yearly">Âπ¥Â∫¶È¢ÑÁÆó</option>
                        </select>
                        <div class="period-desc" id="budgetPeriodDesc"></div>
                    </div>
                    
                    <div class="budget-tips">
                        <div class="tip-icon">üí°</div>
                        <div class="tip-content">
                            <strong>È¢ÑÁÆóËÆæÁΩÆÂª∫ËÆÆ:</strong>
                            <ul>
                                <li>Ê†πÊçÆÂéÜÂè≤Ê∂àË¥πÊï∞ÊçÆÂêàÁêÜËÆæÁΩÆÈ¢ÑÁÆó</li>
                                <li>ÂèØÂÖàËÆæÁΩÆÊÄªÈ¢ÑÁÆóÔºåÂÜçÁªÜÂåñÂàÜÁ±ªÈ¢ÑÁÆó</li>
                                <li>Ë∂ÖÈ¢ÑÁÆóÊó∂‰ºöÊî∂Âà∞ÊèêÈÜí</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="budget-total">
                        <div class="total-label">ÊÄªÈ¢ÑÁÆó</div>
                        <div class="total-input-group">
                            <span class="input-prefix">¬•</span>
                            <input type="number" class="total-input" id="totalBudget" placeholder="0.00" min="0" step="0.01" onchange="updateCategoryBudgets()">
                        </div>
                    </div>
                    
                    <div class="budget-categories">
                        <div class="categories-header">
                            <div class="header-label">ÂàÜÁ±ªÈ¢ÑÁÆó</div>
                            <div class="header-actions">
                                <button class="action-btn" onclick="distributeEvenly()">Âπ≥ÂùáÂàÜÈÖç</button>
                                <button class="action-btn" onclick="clearAllBudgets()">Ê∏ÖÁ©∫</button>
                            </div>
                        </div>
                        <div class="categories-list" id="budgetCategoriesList"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveBudgets()">
                        <span class="btn-icon">üíæ</span> ‰øùÂ≠òÈ¢ÑÁÆó
                    </button>
                    <button class="modal-btn cancel-btn" onclick="closeBudgetModal()">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- ÂàÜÁ±ªÁÆ°ÁêÜÂºπÁ™ó -->
        <div class="modal" id="categoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">ÂàÜÁ±ªÁÆ°ÁêÜ</h3>
                    <button class="modal-close" onclick="closeCategoryModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="category-tips">
                        <div class="tip-icon">üìå</div>
                        <div class="tip-content">
                            <strong>Êìç‰ΩúËØ¥Êòé:</strong>
                            <ul>
                                <li>ÁÇπÂáªÂàÜÁ±ªÂèØÁºñËæë</li>
                                <li>ÈïøÊåâÂàÜÁ±ªÂèØÂà†Èô§</li>
                                <li>ÊãñÊãΩÂàÜÁ±ªÂèØÊéíÂ∫è</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="categories-container">
                        <div class="category-list" id="categoryList">
                            <!-- ÂàÜÁ±ªÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                    
                    <button class="add-cate-btn full" onclick="openAddCateModal()">
                        <span class="btn-icon">+</span> Ê∑ªÂä†Êñ∞ÂàÜÁ±ª
                    </button>
                </div>
            </div>
        </div>

        <!-- Êñ∞Â¢ûÂàÜÁ±ªÂºπÁ™ó -->
        <div class="modal small" id="addCateModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Êñ∞Â¢ûÂàÜÁ±ª</h3>
                    <button class="modal-close" onclick="closeAddCateModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label for="newCateName">ÂàÜÁ±ªÂêçÁß∞</label>
                        <input type="text" class="text-input" id="newCateName" placeholder="ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞" maxlength="10">
                        <div class="input-error" id="cateNameError"></div>
                    </div>
                    
                    <div class="input-group">
                        <label for="newCateIcon">ÈÄâÊã©ÂõæÊ†á</label>
                        <div class="icon-selector" id="iconSelector">
                            <!-- ÂõæÊ†áÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="newCateType">ÂàÜÁ±ªÁ±ªÂûã</label>
                        <select class="select-input" id="newCateType">
                            <option value="expense">ÊîØÂá∫</option>
                            <option value="income">Êî∂ÂÖ•</option>
                            <option value="both">‰∏§ËÄÖÂùáÂèØ</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn save-btn" onclick="saveNewCategory()">Á°ÆËÆ§Ê∑ªÂä†</button>
                    <button class="modal-btn cancel-btn" onclick="closeAddCateModal()">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

        <!-- Êï∞ÊçÆÂØºÂá∫ÂºπÁ™ó -->
        <div class="modal" id="exportModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                    <button class="modal-close" onclick="closeExportModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="export-section">
                        <h4 class="section-title">ÂØºÂá∫Êï∞ÊçÆ</h4>
                        <div class="export-options">
                            <div class="option-item">
                                <input type="radio" name="exportFormat" id="exportJSON" value="json" checked>
                                <label for="exportJSON">
                                    <span class="option-icon">üìÑ</span>
                                    <span class="option-text">JSONÊ†ºÂºè</span>
                                    <span class="option-desc">ÂÆåÊï¥Êï∞ÊçÆÔºåÈÄÇÂêàÂ§á‰ªΩ</span>
                                </label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="exportFormat" id="exportCSV" value="csv">
                                <label for="exportCSV">
                                    <span class="option-icon">üìä</span>
                                    <span class="option-text">CSVÊ†ºÂºè</span>
                                    <span class="option-desc">Ë°®Ê†ºÊ†ºÂºèÔºåÈÄÇÂêàÂàÜÊûê</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="export-date-range">
                            <div class="date-range-label">Êó∂Èó¥ËåÉÂõ¥</div>
                            <div class="date-range-inputs">
                                <input type="date" class="date-input" id="exportStartDate">
                                <span>Ëá≥</span>
                                <input type="date" class="date-input" id="exportEndDate">
                            </div>
                        </div>
                        
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportData()">
                                <span class="btn-icon">üì•</span> ÂØºÂá∫Êï∞ÊçÆ
                            </button>
                            <button class="export-btn secondary" onclick="printSummary()">
                                <span class="btn-icon">üñ®Ô∏è</span> ÊâìÂç∞ÊëòË¶Å
                            </button>
                        </div>
                    </div>
                    
                    <div class="import-section">
                        <h4 class="section-title">ÂØºÂÖ•Êï∞ÊçÆ</h4>
                        <div class="import-options">
                            <div class="option-item">
                                <input type="radio" name="importAction" id="importMerge" value="merge" checked>
                                <label for="importMerge">
                                    <span class="option-icon">üîÑ</span>
                                    <span class="option-text">ÂêàÂπ∂Êï∞ÊçÆ</span>
                                    <span class="option-desc">‰øùÁïôÁé∞ÊúâÊï∞ÊçÆÔºåÊ∑ªÂä†Êñ∞Êï∞ÊçÆ</span>
                                </label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="importAction" id="importReplace" value="replace">
                                <label for="importReplace">
                                    <span class="option-icon">üóëÔ∏è</span>
                                    <span class="option-text">ÊõøÊç¢Êï∞ÊçÆ</span>
                                    <span class="option-desc">Ê∏ÖÈô§Áé∞ÊúâÊï∞ÊçÆÔºå‰ΩøÁî®Êñ∞Êï∞ÊçÆ</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="file-input-container">
                            <input type="file" id="importFile" accept=".json,.csv" style="display: none;">
                            <button class="file-select-btn" onclick="document.getElementById('importFile').click()">
                                <span class="btn-icon">üìÅ</span> ÈÄâÊã©Êñá‰ª∂
                            </button>
                            <div class="file-info" id="fileInfo">Êú™ÈÄâÊã©Êñá‰ª∂</div>
                        </div>
                        
                        <button class="import-btn" onclick="importData()">
                            <span class="btn-icon">üì§</span> ÂØºÂÖ•Êï∞ÊçÆ
                        </button>
                        
                        <div class="import-note">
                            <strong>Ê≥®ÊÑè:</strong> ÂØºÂÖ•ÂâçÂª∫ËÆÆÂÖàÂØºÂá∫Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
                        </div>
                    </div>
                    
                    <div class="data-stats">
                        <h4 class="section-title">Êï∞ÊçÆÁªüËÆ°</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Ë¥¶ÂçïÊÄªÊï∞</div>
                                <div class="stat-value" id="exportBillCount">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">ÂàÜÁ±ªÊï∞Èáè</div>
                                <div class="stat-value" id="exportCategoryCount">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Êï∞ÊçÆÂ§ßÂ∞è</div>
                                <div class="stat-value" id="exportDataSize">0 KB</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">ÊúÄÂêéÂ§á‰ªΩ</div>
                                <div class="stat-value" id="exportLastBackup">‰ªéÊú™Â§á‰ªΩ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Á°ÆËÆ§Âà†Èô§ÂºπÁ™ó -->
        <div class="modal small confirm-modal" id="confirmModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="confirmTitle">Á°ÆËÆ§Êìç‰Ωú</h3>
                </div>
                <div class="modal-body">
                    <div class="confirm-icon" id="confirmIcon">‚ùì</div>
                    <div class="confirm-message" id="confirmMessage">Á°ÆÂÆöË¶ÅÊâßË°åÊ≠§Êìç‰ΩúÂêóÔºü</div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn confirm-btn" id="confirmActionBtn">Á°ÆÂÆö</button>
                    <button class="modal-btn cancel-btn" onclick="hideConfirmModal()">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript ‰ª£Á†Å -->
    <script>
        // Â∑•ÂÖ∑ÂáΩÊï∞Ê®°Âùó
        const utils = {
            // Ê†ºÂºèÂåñÊó•Êúü‰∏∫YYYY-MM-DDÔºàËß£ÂÜ≥Êó∂Âå∫ÈóÆÈ¢òÔºâ
            formatDateToYMD: function(date) {
                // ‰ΩøÁî®UTCÁ°Æ‰øùÊó∂Âå∫‰∏ÄËá¥ÊÄß
                const year = date.getUTCFullYear();
                const month = String(date.getUTCMonth() + 1).padStart(2, '0');
                const day = String(date.getUTCDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },
            
            // Ëé∑ÂèñÂΩìÂâçÂπ¥ÊúàÊ†áËØÜÔºàÁî®‰∫éÈ¢ÑÁÆóÂ≠òÂÇ®Ôºâ
            getCurrentMonthKey: function() {
                const now = new Date();
                const year = now.getUTCFullYear();
                const month = String(now.getUTCMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            },
            
            // Ëé∑ÂèñÊåáÂÆöÂπ¥ÊúàÊ†áËØÜ
            getMonthKey: function(date) {
                const year = date.getUTCFullYear();
                const month = String(date.getUTCMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            },
            
            // Ê†ºÂºèÂåñÊó∂Èó¥‰∏∫Êó∂ÂàÜ
            formatTime: function(dateString) {
                const date = new Date(dateString);
                return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
            },
            
            // Ê†ºÂºèÂåñÊó•ÊúüÊòæÁ§∫
            formatDateDisplay: function(dateStr) {
                const date = new Date(dateStr + 'T00:00:00Z'); // ‰ΩøÁî®UTC
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setUTCDate(yesterday.getUTCDate() - 1);
                
                if (utils.formatDateToYMD(date) === utils.formatDateToYMD(today)) {
                    return '‰ªäÂ§©';
                } else if (utils.formatDateToYMD(date) === utils.formatDateToYMD(yesterday)) {
                    return 'Êò®Â§©';
                } else {
                    return `${date.getUTCMonth() + 1}Êúà${date.getUTCDate()}Êó•`;
                }
            },
            
            // Ê†ºÂºèÂåñÈáëÈ¢ù
            formatAmount: function(amount) {
                return `¬•${parseFloat(amount).toFixed(2)}`;
            },
            
            // È™åËØÅÈáëÈ¢ùËæìÂÖ•
            validateAmount: function(input) {
                const value = input.value;
                const errorElement = document.getElementById('amountError');
                
                if (!value) {
                    errorElement.textContent = 'ËØ∑ËæìÂÖ•ÈáëÈ¢ù';
                    return false;
                }
                
                const amount = parseFloat(value);
                if (isNaN(amount) || amount <= 0) {
                    errorElement.textContent = 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ≠£Êï∞ÈáëÈ¢ù';
                    return false;
                }
                
                if (amount > 1000000) {
                    errorElement.textContent = 'ÈáëÈ¢ù‰∏çËÉΩË∂ÖËøá1,000,000';
                    return false;
                }
                
                errorElement.textContent = '';
                return true;
            },
            
            // È™åËØÅÂàÜÁ±ªÂêçÁß∞
            validateCategoryName: function(name) {
                if (!name || name.trim().length === 0) {
                    return { valid: false, message: 'ÂàÜÁ±ªÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫' };
                }
                
                if (name.length > 10) {
                    return { valid: false, message: 'ÂàÜÁ±ªÂêçÁß∞‰∏çËÉΩË∂ÖËøá10‰∏™Â≠óÁ¨¶' };
                }
                
                // ÂÖÅËÆ∏‰∏≠Êñá„ÄÅËã±Êñá„ÄÅÊï∞Â≠óÂíåÂ∏∏Áî®Á¨¶Âè∑
                const pattern = /^[\u4e00-\u9fa5a-zA-Z0-9\s\-_]+$/;
                if (!pattern.test(name)) {
                    return { valid: false, message: 'ÂàÜÁ±ªÂêçÁß∞ÂåÖÂê´Êó†ÊïàÂ≠óÁ¨¶' };
                }
                
                return { valid: true, message: '' };
            },
            
            // Ê∑±Êã∑Ë¥ùÂØπË±°
            deepClone: function(obj) {
                return JSON.parse(JSON.stringify(obj));
            },
            
            // Èò≤ÊäñÂáΩÊï∞
            debounce: function(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            
            // ËäÇÊµÅÂáΩÊï∞
            throttle: function(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },
            
            // ÊòæÁ§∫Á°ÆËÆ§ÂØπËØùÊ°Ü
            showConfirmModal: function(title, message, icon, confirmAction) {
                document.getElementById('confirmTitle').textContent = title;
                document.getElementById('confirmMessage').textContent = message;
                document.getElementById('confirmIcon').textContent = icon;
                
                const confirmBtn = document.getElementById('confirmActionBtn');
                confirmBtn.onclick = function() {
                    confirmAction();
                    utils.hideConfirmModal();
                };
                
                document.getElementById('confirmModal').classList.add('show');
            },
            
            // ÈöêËóèÁ°ÆËÆ§ÂØπËØùÊ°Ü
            hideConfirmModal: function() {
                document.getElementById('confirmModal').classList.remove('show');
            },
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            showLoading: function(element) {
                element.innerHTML = '<div class="loading"></div>';
            },
            
            // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
            hideLoading: function(element, originalContent) {
                element.innerHTML = originalContent;
            },
            
            // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
            copyToClipboard: function(text) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                }).catch(err => {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                });
            },
            
            // Ëé∑ÂèñÊñá‰ª∂Â§ßÂ∞èÊèèËø∞
            getFileSize: function(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            
            // ÁîüÊàêÂîØ‰∏ÄID
            generateId: function() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },
            
            // ËÆ°ÁÆóÁôæÂàÜÊØî
            calculatePercentage: function(part, total) {
                if (total === 0) return 0;
                return Math.round((part / total) * 100);
            },
            
            // Ëé∑ÂèñÈ¢úËâ≤Ê†πÊçÆÁôæÂàÜÊØî
            getPercentageColor: function(percentage) {
                if (percentage < 70) return '#34C759'; // ÁªøËâ≤
                if (percentage < 90) return '#FF9500'; // Ê©ôËâ≤
                return '#FF3B30'; // Á∫¢Ëâ≤
            }
        };

        // Êï∞ÊçÆÁÆ°ÁêÜÊ®°Âùó
        const dataManager = (function() {
            // Êï∞ÊçÆÂ≠òÂÇ®ÈîÆÂêç
            const STORAGE_KEYS = {
                CATEGORIES: 'phoneCates_v2',
                BILLS: 'phoneBills_v2',
                BUDGETS: 'monthlyBudgets_v2',
                SETTINGS: 'appSettings_v2',
                BACKUP_INFO: 'backupInfo_v2'
            };
            
            // Êï∞ÊçÆÁâàÊú¨
            const DATA_VERSION = '2.0.0';
            
            // ÂàùÂßãÂåñÊï∞ÊçÆ
            const initData = function() {
                // ËøÅÁßªÊóßÁâàÊï∞ÊçÆ
                migrateOldData();
                
                // ÂàùÂßãÂåñÈªòËÆ§Êï∞ÊçÆ
                if (!localStorage.getItem(STORAGE_KEYS.CATEGORIES)) {
                    const defaultCategories = [
                        { id: '1', name: 'È§êÈ•Æ', icon: 'üçú', type: 'expense', color: '#FF9500' },
                        { id: '2', name: '‰∫§ÈÄö', icon: 'üöå', type: 'expense', color: '#007AFF' },
                        { id: '3', name: 'Â®±‰πê', icon: 'üé¨', type: 'expense', color: '#FF2D55' },
                        { id: '4', name: 'Â≠¶‰π†', icon: 'üìö', type: 'expense', color: '#5856D6' },
                        { id: '5', name: 'Ë¥≠Áâ©', icon: 'üõçÔ∏è', type: 'expense', color: '#FF3B30' },
                        { id: '6', name: 'ÊàøÁßü', icon: 'üè†', type: 'expense', color: '#34C759' },
                        { id: '7', name: 'Â∑•ËµÑ', icon: 'üíº', type: 'income', color: '#34C759' },
                        { id: '8', name: 'ÊäïËµÑ', icon: 'üìà', type: 'income', color: '#34C759' },
                        { id: '9', name: 'Êó•Áî®', icon: 'üß¥', type: 'expense', color: '#8E8E93' },
                        { id: '10', name: 'ÂåªÁñó', icon: 'üíä', type: 'expense', color: '#FF9500' },
                        { id: '11', name: 'ÊóÖË°å', icon: '‚úàÔ∏è', type: 'expense', color: '#5AC8FA' },
                        { id: '12', name: 'Á§æ‰∫§', icon: 'üë´', type: 'expense', color: '#FFCC00' }
                    ];
                    localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(defaultCategories));
                }
                
                if (!localStorage.getItem(STORAGE_KEYS.BILLS)) {
                    localStorage.setItem(STORAGE_KEYS.BILLS, JSON.stringify([]));
                }
                
                if (!localStorage.getItem(STORAGE_KEYS.BUDGETS)) {
                    localStorage.setItem(STORAGE_KEYS.BUDGETS, JSON.stringify({}));
                }
                
                if (!localStorage.getItem(STORAGE_KEYS.SETTINGS)) {
                    const defaultSettings = {
                        currency: 'CNY',
                        firstDayOfWeek: 0,
                        theme: 'light',
                        autoBackup: true,
                        version: DATA_VERSION
                    };
                    localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(defaultSettings));
                }
                
                if (!localStorage.getItem(STORAGE_KEYS.BACKUP_INFO)) {
                    localStorage.setItem(STORAGE_KEYS.BACKUP_INFO, JSON.stringify({
                        lastBackup: null,
                        backupCount: 0
                    }));
                }
            };
            
            // ËøÅÁßªÊóßÁâàÊï∞ÊçÆ
            const migrateOldData = function() {
                // ËøÅÁßªÂàÜÁ±ªÊï∞ÊçÆ
                const oldCategories = localStorage.getItem('phoneCates');
                if (oldCategories && !localStorage.getItem(STORAGE_KEYS.CATEGORIES)) {
                    try {
                        const categories = JSON.parse(oldCategories);
                        const newCategories = categories.map((cat, index) => {
                            const name = cat.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '');
                            const icon = cat.replace(name, '');
                            return {
                                id: (index + 1).toString(),
                                name: name,
                                icon: icon || 'üîß',
                                type: 'expense',
                                color: '#8E8E93'
                            };
                        });
                        localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(newCategories));
                    } catch (e) {
                        console.error('ËøÅÁßªÂàÜÁ±ªÊï∞ÊçÆÂ§±Ë¥•:', e);
                    }
                }
                
                // ËøÅÁßªË¥¶ÂçïÊï∞ÊçÆ
                const oldBills = localStorage.getItem('phoneBills');
                if (oldBills && !localStorage.getItem(STORAGE_KEYS.BILLS)) {
                    try {
                        const bills = JSON.parse(oldBills);
                        const newBills = bills.map(bill => ({
                            ...bill,
                            note: bill.note || '',
                            createdAt: bill.createdAt || new Date().toISOString()
                        }));
                        localStorage.setItem(STORAGE_KEYS.BILLS, JSON.stringify(newBills));
                    } catch (e) {
                        console.error('ËøÅÁßªË¥¶ÂçïÊï∞ÊçÆÂ§±Ë¥•:', e);
                    }
                }
                
                // ËøÅÁßªÈ¢ÑÁÆóÊï∞ÊçÆ
                const oldBudgets = localStorage.getItem('monthlyBudgets');
                if (oldBudgets && !localStorage.getItem(STORAGE_KEYS.BUDGETS)) {
                    try {
                        localStorage.setItem(STORAGE_KEYS.BUDGETS, oldBudgets);
                    } catch (e) {
                        console.error('ËøÅÁßªÈ¢ÑÁÆóÊï∞ÊçÆÂ§±Ë¥•:', e);
                    }
                }
            };
            
            // Ëé∑ÂèñÂàÜÁ±ªÊï∞ÊçÆ
            const getCategories = function() {
                const data = localStorage.getItem(STORAGE_KEYS.CATEGORIES);
                return data ? JSON.parse(data) : [];
            };
            
            // ‰øùÂ≠òÂàÜÁ±ªÊï∞ÊçÆ
            const saveCategories = function(categories) {
                localStorage.setItem(STORAGE_KEYS.CATEGORIES, JSON.stringify(categories));
                return categories;
            };
            
            // Ëé∑ÂèñË¥¶ÂçïÊï∞ÊçÆ
            const getBills = function() {
                const data = localStorage.getItem(STORAGE_KEYS.BILLS);
                return data ? JSON.parse(data) : [];
            };
            
            // ‰øùÂ≠òË¥¶ÂçïÊï∞ÊçÆ
            const saveBills = function(bills) {
                localStorage.setItem(STORAGE_KEYS.BILLS, JSON.stringify(bills));
                return bills;
            };
            
            // Ëé∑ÂèñÈ¢ÑÁÆóÊï∞ÊçÆ
            const getBudgets = function() {
                const data = localStorage.getItem(STORAGE_KEYS.BUDGETS);
                return data ? JSON.parse(data) : {};
            };
            
            // ‰øùÂ≠òÈ¢ÑÁÆóÊï∞ÊçÆ
            const saveBudgets = function(budgets) {
                localStorage.setItem(STORAGE_KEYS.BUDGETS, JSON.stringify(budgets));
                return budgets;
            };
            
            // Ëé∑ÂèñËÆæÁΩÆÊï∞ÊçÆ
            const getSettings = function() {
                const data = localStorage.getItem(STORAGE_KEYS.SETTINGS);
                return data ? JSON.parse(data) : {};
            };
            
            // ‰øùÂ≠òËÆæÁΩÆÊï∞ÊçÆ
            const saveSettings = function(settings) {
                localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
                return settings;
            };
            
            // Ëé∑ÂèñÂ§á‰ªΩ‰ø°ÊÅØ
            const getBackupInfo = function() {
                const data = localStorage.getItem(STORAGE_KEYS.BACKUP_INFO);
                return data ? JSON.parse(data) : { lastBackup: null, backupCount: 0 };
            };
            
            // Êõ¥Êñ∞Â§á‰ªΩ‰ø°ÊÅØ
            const updateBackupInfo = function() {
                const info = getBackupInfo();
                info.lastBackup = new Date().toISOString();
                info.backupCount = (info.backupCount || 0) + 1;
                localStorage.setItem(STORAGE_KEYS.BACKUP_INFO, JSON.stringify(info));
                return info;
            };
            
            // Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ
            const getStats = function() {
                const bills = getBills();
                const categories = getCategories();
                const budgets = getBudgets();
                
                const now = new Date();
                const currentMonthKey = utils.getCurrentMonthKey();
                
                // ËÆ°ÁÆóÊúàÂ∫¶ÁªüËÆ°
                let monthExpense = 0;
                let monthIncome = 0;
                let monthBills = 0;
                
                bills.forEach(bill => {
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    if (utils.getMonthKey(billDate) === currentMonthKey) {
                        monthBills++;
                        if (bill.type === 'expense') {
                            monthExpense += bill.amount;
                        } else {
                            monthIncome += bill.amount;
                        }
                    }
                });
                
                // ËÆ°ÁÆóÂàÜÁ±ªÁªüËÆ°
                const categoryStats = {};
                categories.forEach(cat => {
                    categoryStats[cat.id] = {
                        name: cat.name,
                        icon: cat.icon,
                        type: cat.type,
                        expense: 0,
                        income: 0,
                        count: 0
                    };
                });
                
                bills.forEach(bill => {
                    if (categoryStats[bill.category]) {
                        if (bill.type === 'expense') {
                            categoryStats[bill.category].expense += bill.amount;
                        } else {
                            categoryStats[bill.category].income += bill.amount;
                        }
                        categoryStats[bill.category].count++;
                    }
                });
                
                // ËÆ°ÁÆóÈ¢ÑÁÆóÁªüËÆ°
                const budgetStats = {};
                if (budgets[currentMonthKey]) {
                    Object.entries(budgets[currentMonthKey]).forEach(([categoryId, amount]) => {
                        if (amount > 0 && categoryStats[categoryId]) {
                            const used = categoryStats[categoryId].expense;
                            const remaining = amount - used;
                            const percentage = utils.calculatePercentage(used, amount);
                            
                            budgetStats[categoryId] = {
                                budget: amount,
                                used: used,
                                remaining: remaining,
                                percentage: percentage,
                                overspent: remaining < 0
                            };
                        }
                    });
                }
                
                // ËÆ°ÁÆóË∂ãÂäø
                const prevMonth = new Date(now);
                prevMonth.setUTCMonth(prevMonth.getUTCMonth() - 1);
                const prevMonthKey = utils.getMonthKey(prevMonth);
                
                let prevMonthExpense = 0;
                let prevMonthIncome = 0;
                
                bills.forEach(bill => {
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    if (utils.getMonthKey(billDate) === prevMonthKey) {
                        if (bill.type === 'expense') {
                            prevMonthExpense += bill.amount;
                        } else {
                            prevMonthIncome += bill.amount;
                        }
                    }
                });
                
                const expenseTrend = prevMonthExpense > 0 ? 
                    ((monthExpense - prevMonthExpense) / prevMonthExpense * 100).toFixed(1) : 0;
                const incomeTrend = prevMonthIncome > 0 ? 
                    ((monthIncome - prevMonthIncome) / prevMonthIncome * 100).toFixed(1) : 0;
                
                return {
                    monthExpense: monthExpense,
                    monthIncome: monthIncome,
                    monthBalance: monthIncome - monthExpense,
                    monthBills: monthBills,
                    expenseTrend: parseFloat(expenseTrend),
                    incomeTrend: parseFloat(incomeTrend),
                    categoryStats: categoryStats,
                    budgetStats: budgetStats,
                    overallBudget: {
                        total: Object.values(budgetStats).reduce((sum, stat) => sum + stat.budget, 0),
                        used: Object.values(budgetStats).reduce((sum, stat) => sum + stat.used, 0),
                        remaining: Object.values(budgetStats).reduce((sum, stat) => sum + stat.remaining, 0)
                    }
                };
            };
            
            // ÂØºÂá∫Êï∞ÊçÆ
            const exportData = function(format = 'json', startDate = null, endDate = null) {
                const data = {
                    metadata: {
                        app: 'Âè¶‰∏Ä‰∏™Êàë - ËÆ∞Ë¥¶App',
                        version: DATA_VERSION,
                        exportDate: new Date().toISOString(),
                        dataCount: {
                            categories: getCategories().length,
                            bills: getBills().length,
                            budgets: Object.keys(getBudgets()).length
                        }
                    },
                    categories: getCategories(),
                    bills: getBills(),
                    budgets: getBudgets(),
                    settings: getSettings()
                };
                
                // ËøáÊª§Ë¥¶ÂçïÊï∞ÊçÆÔºàÂ¶ÇÊûúÊåáÂÆö‰∫ÜÊó∂Èó¥ËåÉÂõ¥Ôºâ
                if (startDate && endDate) {
                    const start = new Date(startDate + 'T00:00:00Z');
                    const end = new Date(endDate + 'T23:59:59Z');
                    
                    data.bills = data.bills.filter(bill => {
                        const billDate = new Date(bill.date + 'T00:00:00Z');
                        return billDate >= start && billDate <= end;
                    });
                    
                    data.metadata.filtered = true;
                    data.metadata.dateRange = {
                        start: startDate,
                        end: endDate,
                        count: data.bills.length
                    };
                }
                
                if (format === 'csv') {
                    return convertToCSV(data);
                }
                
                return JSON.stringify(data, null, 2);
            };
            
            // ËΩ¨Êç¢‰∏∫CSVÊ†ºÂºè
            const convertToCSV = function(data) {
                let csv = '';
                
                // Ë¥¶ÂçïCSV
                csv += 'Ë¥¶ÂçïËÆ∞ÂΩï\n';
                csv += 'ID,Êó•Êúü,Á±ªÂûã,ÂàÜÁ±ª,ÈáëÈ¢ù,Â§áÊ≥®\n';
                data.bills.forEach(bill => {
                    const category = data.categories.find(c => c.id === bill.category);
                    const categoryName = category ? category.name : 'Êú™Áü•';
                    csv += `${bill.id},${bill.date},${bill.type},${categoryName},${bill.amount},"${bill.note || ''}"\n`;
                });
                
                csv += '\n\nÂàÜÁ±ªÈ¢ÑÁÆó\n';
                csv += 'Âπ¥Êúà,ÂàÜÁ±ª,È¢ÑÁÆóÈáëÈ¢ù\n';
                
                Object.entries(data.budgets).forEach(([monthKey, categories]) => {
                    Object.entries(categories).forEach(([categoryId, amount]) => {
                        if (amount > 0) {
                            const category = data.categories.find(c => c.id === categoryId);
                            const categoryName = category ? category.name : 'Êú™Áü•';
                            csv += `${monthKey},${categoryName},${amount}\n`;
                        }
                    });
                });
                
                return csv;
            };
            
            // ÂØºÂÖ•Êï∞ÊçÆ
            const importData = function(data, action = 'merge') {
                try {
                    const imported = JSON.parse(data);
                    
                    if (!imported.categories || !imported.bills || !imported.budgets) {
                        throw new Error('Êï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                    }
                    
                    if (action === 'replace') {
                        // ÊõøÊç¢Áé∞ÊúâÊï∞ÊçÆ
                        saveCategories(imported.categories);
                        saveBills(imported.bills);
                        saveBudgets(imported.budgets);
                        
                        if (imported.settings) {
                            saveSettings(imported.settings);
                        }
                    } else {
                        // ÂêàÂπ∂Êï∞ÊçÆ
                        const existingCategories = getCategories();
                        const existingBills = getBills();
                        const existingBudgets = getBudgets();
                        
                        // ÂêàÂπ∂ÂàÜÁ±ªÔºàÂü∫‰∫éIDÔºâ
                        const categoryMap = {};
                        existingCategories.forEach(cat => categoryMap[cat.id] = cat);
                        
                        imported.categories.forEach(cat => {
                            if (!categoryMap[cat.id]) {
                                existingCategories.push(cat);
                                categoryMap[cat.id] = cat;
                            }
                        });
                        
                        // ÂêàÂπ∂Ë¥¶ÂçïÔºàÈÅøÂÖçÈáçÂ§çIDÔºâ
                        const billIds = new Set(existingBills.map(b => b.id));
                        imported.bills.forEach(bill => {
                            if (!billIds.has(bill.id)) {
                                existingBills.push(bill);
                                billIds.add(bill.id);
                            }
                        });
                        
                        // ÂêàÂπ∂È¢ÑÁÆó
                        Object.entries(imported.budgets).forEach(([monthKey, categories]) => {
                            if (!existingBudgets[monthKey]) {
                                existingBudgets[monthKey] = {};
                            }
                            
                            Object.entries(categories).forEach(([categoryId, amount]) => {
                                existingBudgets[monthKey][categoryId] = amount;
                            });
                        });
                        
                        // ‰øùÂ≠òÂêàÂπ∂ÂêéÁöÑÊï∞ÊçÆ
                        saveCategories(existingCategories);
                        saveBills(existingBills);
                        saveBudgets(existingBudgets);
                    }
                    
                    // Êõ¥Êñ∞Â§á‰ªΩ‰ø°ÊÅØ
                    updateBackupInfo();
                    
                    return true;
                } catch (error) {
                    console.error('ÂØºÂÖ•Êï∞ÊçÆÂ§±Ë¥•:', error);
                    return false;
                }
            };
            
            // ÂØºÂÖ•CSVÊï∞ÊçÆ
            const importCSV = function(csvData) {
                try {
                    const lines = csvData.split('\n');
                    const bills = [];
                    const budgets = {};
                    
                    let currentSection = '';
                    let lineIndex = 0;
                    
                    while (lineIndex < lines.length) {
                        const line = lines[lineIndex].trim();
                        
                        if (line === 'Ë¥¶ÂçïËÆ∞ÂΩï') {
                            currentSection = 'bills';
                            lineIndex += 2; // Ë∑≥ËøáÊ†áÈ¢òË°å
                            continue;
                        } else if (line === 'ÂàÜÁ±ªÈ¢ÑÁÆó') {
                            currentSection = 'budgets';
                            lineIndex += 2; // Ë∑≥ËøáÊ†áÈ¢òË°å
                            continue;
                        } else if (line === '' || lineIndex === 0) {
                            lineIndex++;
                            continue;
                        }
                        
                        if (currentSection === 'bills') {
                            const parts = line.split(',');
                            if (parts.length >= 5) {
                                const bill = {
                                    id: parts[0] || utils.generateId(),
                                    date: parts[1],
                                    type: parts[2],
                                    category: parts[3], // Ê≥®ÊÑèÔºöËøôÈáåÈúÄË¶ÅËΩ¨Êç¢‰∏∫ÂàÜÁ±ªID
                                    amount: parseFloat(parts[4]),
                                    note: parts[5] ? parts[5].replace(/^"|"$/g, '') : '',
                                    createdAt: new Date().toISOString()
                                };
                                bills.push(bill);
                            }
                        } else if (currentSection === 'budgets') {
                            const parts = line.split(',');
                            if (parts.length >= 3) {
                                const monthKey = parts[0];
                                const categoryName = parts[1];
                                const amount = parseFloat(parts[2]);
                                
                                if (!budgets[monthKey]) {
                                    budgets[monthKey] = {};
                                }
                                
                                // ÈúÄË¶ÅÊ†πÊçÆÂàÜÁ±ªÂêçÁß∞ÊâæÂà∞ÂàÜÁ±ªID
                                const categories = getCategories();
                                const category = categories.find(c => c.name === categoryName);
                                if (category) {
                                    budgets[monthKey][category.id] = amount;
                                }
                            }
                        }
                        
                        lineIndex++;
                    }
                    
                    // ÂêàÂπ∂Âà∞Áé∞ÊúâÊï∞ÊçÆ
                    const existingBills = getBills();
                    const existingBudgets = getBudgets();
                    
                    const billIds = new Set(existingBills.map(b => b.id));
                    bills.forEach(bill => {
                        if (!billIds.has(bill.id)) {
                            existingBills.push(bill);
                            billIds.add(bill.id);
                        }
                    });
                    
                    Object.entries(budgets).forEach(([monthKey, categories]) => {
                        if (!existingBudgets[monthKey]) {
                            existingBudgets[monthKey] = {};
                        }
                        
                        Object.entries(categories).forEach(([categoryId, amount]) => {
                            existingBudgets[monthKey][categoryId] = amount;
                        });
                    });
                    
                    // ‰øùÂ≠òÊï∞ÊçÆ
                    saveBills(existingBills);
                    saveBudgets(existingBudgets);
                    updateBackupInfo();
                    
                    return true;
                } catch (error) {
                    console.error('ÂØºÂÖ•CSVÂ§±Ë¥•:', error);
                    return false;
                }
            };
            
            // Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆ
            const clearAllData = function() {
                localStorage.removeItem(STORAGE_KEYS.CATEGORIES);
                localStorage.removeItem(STORAGE_KEYS.BILLS);
                localStorage.removeItem(STORAGE_KEYS.BUDGETS);
                localStorage.removeItem(STORAGE_KEYS.SETTINGS);
                localStorage.removeItem(STORAGE_KEYS.BACKUP_INFO);
                
                initData();
                return true;
            };
            
            // Ëé∑ÂèñÊï∞ÊçÆÂ§ßÂ∞è
            const getDataSize = function() {
                let totalSize = 0;
                
                Object.values(STORAGE_KEYS).forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data) {
                        totalSize += new Blob([data]).size;
                    }
                });
                
                return totalSize;
            };
            
            // ÂàùÂßãÂåñ
            initData();
            
            // ÂÖ¨ÂºÄÁöÑÊñπÊ≥ï
            return {
                getCategories,
                saveCategories,
                getBills,
                saveBills,
                getBudgets,
                saveBudgets,
                getSettings,
                saveSettings,
                getBackupInfo,
                getStats,
                exportData,
                importData,
                importCSV,
                clearAllData,
                getDataSize,
                STORAGE_KEYS
            };
        })();

        // ËÆ§ËØÅÊ®°Âùó
        const auth = {
            // ÂàùÂßãÂØÜÁ†Å
            initialPassword: '0517',
            
            // Ê£ÄÊü•ÂØÜÁ†ÅËæìÂÖ•ÊòØÂê¶ÂÆåÊàê
            checkPasswordWhenComplete: function() {
                const inputs = document.querySelectorAll('.password-input');
                const inputValues = Array.from(inputs).map(i => i.value);
                
                // ÊâÄÊúâËæìÂÖ•Ê°ÜÈÉΩÊúâÂÄºÊó∂Ëß¶ÂèëÈ™åËØÅ
                if (inputValues.every(val => val !== '')) {
                    this.checkPassword();
                }
            },
            
            // È™åËØÅÂØÜÁ†Å
            checkPassword: function() {
                const inputs = document.querySelectorAll('.password-input');
                const inputPwd = Array.from(inputs).map(i => i.value).join('');
                
                if (inputPwd.length === 4) {
                    if (inputPwd === this.initialPassword) {
                        // ÂØÜÁ†ÅÊ≠£Á°ÆÔºåËß£ÈîÅÂ∫îÁî®
                        this.unlockApp();
                    } else {
                        // ÂØÜÁ†ÅÈîôËØØ
                        this.showError('Êï∞Â≠óÂØÜÁ†ÅÈîôËØØ');
                    }
                }
            },
            
            // Ëß£ÈîÅÂ∫îÁî®
            unlockApp: function() {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                
                // Êõ¥Êñ∞ÂØºËà™Êó•Êúü
                this.updateNavDate();
                
                // ÂàùÂßãÂåñÂ∫îÁî®
                if (typeof app !== 'undefined') {
                    app.initHomePage();
                }
            },
            
            // ÈîÅÂÆöÂ∫îÁî®
            lockApp: function() {
                document.getElementById('lockScreen').style.display = 'flex';
                document.getElementById('mainPage').style.display = 'none';
                
                // Ê∏ÖÁ©∫ÂØÜÁ†ÅËæìÂÖ•Ê°Ü
                const inputs = document.querySelectorAll('.password-input');
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
            },
            
            // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
            showError: function(message) {
                document.getElementById('alertText').textContent = message;
                document.getElementById('customAlert').style.display = 'flex';
            },
            
            // ÂÖ≥Èó≠ÊèêÁ§∫Ê°Ü
            closeAlert: function() {
                document.getElementById('customAlert').style.display = 'none';
                
                // Ê∏ÖÁ©∫ÂØÜÁ†ÅËæìÂÖ•Ê°ÜÂπ∂ËÅöÁÑ¶Âà∞Á¨¨‰∏Ä‰∏™
                const inputs = document.querySelectorAll('.password-input');
                inputs.forEach(input => input.value = '');
                inputs[0].focus();
            },
            
            // Êõ¥Êñ∞ÂØºËà™Ê†èÊó•Êúü
            updateNavDate: function() {
                const now = new Date();
                const options = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                const dateStr = now.toLocaleDateString('zh-CN', options);
                document.getElementById('navDate').textContent = dateStr;
            },
            
            // Â§ÑÁêÜ‰∏ã‰∏Ä‰∏™ËæìÂÖ•Ê°ÜËÅöÁÑ¶
            nextInput: function(input) {
                const inputs = document.querySelectorAll('.password-input');
                const index = Array.from(inputs).indexOf(input);
                
                if (input.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâËæìÂÖ•Ê°ÜÈÉΩÂ∑≤Â°´Êª°
                this.checkPasswordWhenComplete();
            },
            
            // Âè™ÂÖÅËÆ∏ËæìÂÖ•Êï∞Â≠ó
            isNumberKey: function(evt) {
                const charCode = (evt.which) ? evt.which : evt.keyCode;
                if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                    return false;
                }
                return true;
            },
            
            // ‰øÆÊîπÂØÜÁ†Å
            changePassword: function(newPassword) {
                if (newPassword.length !== 4 || !/^\d+$/.test(newPassword)) {
                    return { success: false, message: 'ÂØÜÁ†ÅÂøÖÈ°ªÊòØ4‰ΩçÊï∞Â≠ó' };
                }
                
                this.initialPassword = newPassword;
                return { success: true, message: 'ÂØÜÁ†Å‰øÆÊîπÊàêÂäü' };
            },
            
            // È™åËØÅÂØÜÁ†ÅÂº∫Â∫¶
            validatePasswordStrength: function(password) {
                if (password.length !== 4) {
                    return { valid: false, message: 'ÂØÜÁ†ÅÂøÖÈ°ªÊòØ4‰ΩçÊï∞Â≠ó' };
                }
                
                if (!/^\d+$/.test(password)) {
                    return { valid: false, message: 'ÂØÜÁ†ÅÂè™ËÉΩÂåÖÂê´Êï∞Â≠ó' };
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÁÆÄÂçïÂØÜÁ†Å
                const simplePatterns = [
                    '0000', '1111', '2222', '3333', '4444',
                    '5555', '6666', '7777', '8888', '9999',
                    '1234', '4321', '0001', '1000'
                ];
                
                if (simplePatterns.includes(password)) {
                    return { valid: true, message: 'ÂØÜÁ†ÅÂº∫Â∫¶ÔºöÂº±', strength: 'weak' };
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâÈáçÂ§çÊï∞Â≠ó
                const uniqueDigits = new Set(password.split(''));
                if (uniqueDigits.size === 1) {
                    return { valid: true, message: 'ÂØÜÁ†ÅÂº∫Â∫¶ÔºöÂº±', strength: 'weak' };
                } else if (uniqueDigits.size === 2) {
                    return { valid: true, message: 'ÂØÜÁ†ÅÂº∫Â∫¶Ôºö‰∏≠', strength: 'medium' };
                } else {
                    return { valid: true, message: 'ÂØÜÁ†ÅÂº∫Â∫¶ÔºöÂº∫', strength: 'strong' };
                }
            },
            
            // Ëá™Âä®ÈîÅÂÆöÂÆöÊó∂Âô®
            autoLockTimer: null,
            
            // ËÆæÁΩÆËá™Âä®ÈîÅÂÆö
            setupAutoLock: function(timeoutMinutes = 5) {
                this.clearAutoLock();
                
                this.autoLockTimer = setTimeout(() => {
                    this.lockApp();
                }, timeoutMinutes * 60 * 1000);
            },
            
            // Ê∏ÖÈô§Ëá™Âä®ÈîÅÂÆö
            clearAutoLock: function() {
                if (this.autoLockTimer) {
                    clearTimeout(this.autoLockTimer);
                    this.autoLockTimer = null;
                }
            },
            
            // ÈáçÁΩÆËá™Âä®ÈîÅÂÆöËÆ°Êó∂Âô®
            resetAutoLock: function() {
                this.clearAutoLock();
                this.setupAutoLock();
            },
            
            // ÂàùÂßãÂåñÂØÜÁ†ÅËæìÂÖ•
            initPasswordInput: function() {
                const inputs = document.querySelectorAll('.password-input');
                if (inputs.length > 0) {
                    inputs[0].focus();
                }
            }
        };

        // ‰∏ªÂ∫îÁî®Ê®°Âùó
        const app = {
            // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó•Êúü
            currentSelectedDate: new Date(),
            
            // ÂΩìÂâçÊòæÁ§∫ÁöÑÊúà‰ªΩÔºàÁî®‰∫éÁªüËÆ°Ôºâ
            currentDisplayMonth: new Date(),
            
            // ÂàùÂßãÂåñÂ∫îÁî®
            init: function() {
                console.log('Â∫îÁî®ÂàùÂßãÂåñ...');
                
                // Êõ¥Êñ∞ÂØºËà™Êó•Êúü
                this.updateNavDate();
                
                // ÂàùÂßãÂåñÈ¶ñÈ°µ
                this.initHomePage();
                
                // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.bindEvents();
                
                console.log('Â∫îÁî®ÂàùÂßãÂåñÂÆåÊàê');
            },
            
            // ÂàùÂßãÂåñÈ¶ñÈ°µ
            initHomePage: function() {
                // Êõ¥Êñ∞Êúà‰ªΩÊòæÁ§∫
                this.updateMonthDisplay();
                
                // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
                this.updateStats();
                
                // Ê∏≤ÊüìÈ¢ÑÁÆóÂàóË°®
                if (typeof budget !== 'undefined') {
                    budget.renderBudgetList();
                }
                
                // Ê∏≤ÊüìËø∑‰Ω†Êó•ÂéÜ
                if (typeof calendar !== 'undefined') {
                    calendar.renderMiniCalendar();
                }
                
                // Ê∏≤ÊüìË¥¶ÂçïÂàóË°®
                if (typeof bill !== 'undefined') {
                    bill.renderBillList();
                }
                
                // Êõ¥Êñ∞Êï∞ÊçÆÁªüËÆ°ÊòæÁ§∫
                this.updateDataStats();
            },
            
            // Êõ¥Êñ∞ÂØºËà™Ê†èÊó•Êúü
            updateNavDate: function() {
                const now = new Date();
                const options = { 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                const dateStr = now.toLocaleDateString('zh-CN', options);
                document.getElementById('navDate').textContent = dateStr;
            },
            
            // Êõ¥Êñ∞Êúà‰ªΩÊòæÁ§∫
            updateMonthDisplay: function() {
                const month = this.currentDisplayMonth.getUTCMonth() + 1;
                const year = this.currentDisplayMonth.getUTCFullYear();
                document.getElementById('currentMonthText').textContent = `${year}Âπ¥${month}Êúà`;
            },
            
            // ÂàáÊç¢Âà∞‰∏ä‰∏™Êúà
            prevMonth: function() {
                this.currentDisplayMonth.setUTCMonth(this.currentDisplayMonth.getUTCMonth() - 1);
                this.updateMonthDisplay();
                this.updateStats();
                
                // Êõ¥Êñ∞È¢ÑÁÆóÊòæÁ§∫
                if (typeof budget !== 'undefined') {
                    budget.renderBudgetList();
                }
            },
            
            // ÂàáÊç¢Âà∞‰∏ã‰∏™Êúà
            nextMonth: function() {
                this.currentDisplayMonth.setUTCMonth(this.currentDisplayMonth.getUTCMonth() + 1);
                this.updateMonthDisplay();
                this.updateStats();
                
                // Êõ¥Êñ∞È¢ÑÁÆóÊòæÁ§∫
                if (typeof budget !== 'undefined') {
                    budget.renderBudgetList();
                }
            },
            
            // Ë∑≥ËΩ¨Âà∞‰ªäÂ§©
            jumpToToday: function() {
                this.currentDisplayMonth = new Date();
                this.updateMonthDisplay();
                this.updateStats();
                
                // Êõ¥Êñ∞È¢ÑÁÆóÊòæÁ§∫
                if (typeof budget !== 'undefined') {
                    budget.renderBudgetList();
                }
            },
            
            // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
            updateStats: function() {
                const stats = dataManager.getStats();
                
                // Êõ¥Êñ∞Âü∫Êú¨ÁªüËÆ°
                document.getElementById('monthExpense').textContent = utils.formatAmount(stats.monthExpense);
                document.getElementById('monthIncome').textContent = utils.formatAmount(stats.monthIncome);
                document.getElementById('accountBalance').textContent = utils.formatAmount(stats.monthBalance);
                
                // Êõ¥Êñ∞Ë∂ãÂäø
                this.updateTrendDisplay('expenseTrend', stats.expenseTrend);
                this.updateTrendDisplay('incomeTrend', stats.incomeTrend);
                
                // ËÆ°ÁÆó‰ΩôÈ¢ùË∂ãÂäø
                const prevMonth = new Date(this.currentDisplayMonth);
                prevMonth.setUTCMonth(prevMonth.getUTCMonth() - 1);
                const prevMonthKey = utils.getMonthKey(prevMonth);
                const currentMonthKey = utils.getMonthKey(this.currentDisplayMonth);
                
                let currentBalance = stats.monthBalance;
                let prevBalance = 0;
                
                // ËÆ°ÁÆó‰∏ä‰∏™ÊúàÁöÑ‰ΩôÈ¢ù
                const bills = dataManager.getBills();
                let prevExpense = 0;
                let prevIncome = 0;
                
                bills.forEach(bill => {
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    if (utils.getMonthKey(billDate) === prevMonthKey) {
                        if (bill.type === 'expense') {
                            prevExpense += bill.amount;
                        } else {
                            prevIncome += bill.amount;
                        }
                    }
                });
                
                prevBalance = prevIncome - prevExpense;
                const balanceTrend = prevBalance !== 0 ? 
                    ((currentBalance - prevBalance) / Math.abs(prevBalance) * 100).toFixed(1) : 0;
                
                this.updateTrendDisplay('balanceTrend', parseFloat(balanceTrend));
                
                // Êõ¥Êñ∞È¢ÑÁÆóËøõÂ∫¶
                if (stats.overallBudget.total > 0) {
                    const percentage = utils.calculatePercentage(stats.overallBudget.used, stats.overallBudget.total);
                    document.getElementById('overallBudgetProgress').style.width = `${Math.min(percentage, 100)}%`;
                    document.getElementById('overallBudgetPercent').textContent = `${percentage}%`;
                    document.getElementById('overallBudgetAmount').textContent = 
                        `¬•${stats.overallBudget.used.toFixed(2)}/¬•${stats.overallBudget.total.toFixed(2)}`;
                }
            },
            
            // Êõ¥Êñ∞Ë∂ãÂäøÊòæÁ§∫
            updateTrendDisplay: function(elementId, trend) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                if (trend > 0) {
                    element.textContent = `‚Üë ${Math.abs(trend)}%`;
                    element.style.color = '#FF3B30';
                } else if (trend < 0) {
                    element.textContent = `‚Üì ${Math.abs(trend)}%`;
                    element.style.color = '#34C759';
                } else {
                    element.textContent = '‚Üí 0%';
                    element.style.color = '#8E8E93';
                }
            },
            
            // ÂàáÊç¢È°µÈù¢
            showPage: function(pageId) {
                // ÈöêËóèÊâÄÊúâÈ°µÈù¢
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // ÊòæÁ§∫ÁõÆÊ†áÈ°µÈù¢
                document.getElementById(pageId + 'Page').classList.add('active');
                
                // Êõ¥Êñ∞Â∫ïÈÉ®ÂØºËà™ÊøÄÊ¥ªÁä∂ÊÄÅ
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // ÁâπÊÆäÂ§ÑÁêÜËÆ∞Ë¥¶ÊåâÈíÆ
                if (pageId !== 'home') {
                    document.querySelector('.nav-item.add-btn').classList.remove('active');
                }
                
                // ÊøÄÊ¥ªÂØπÂ∫îÂØºËà™È°π
                const navItem = document.querySelector(`.nav-item:not(.add-btn)[onclick*="${pageId}"]`);
                if (navItem) {
                    navItem.classList.add('active');
                }
                
                // Â¶ÇÊûúÊòØÈ¶ñÈ°µÔºåÊõ¥Êñ∞Êï∞ÊçÆ
                if (pageId === 'home') {
                    this.initHomePage();
                }
            },
            
            // Êõ¥Êñ∞Êï∞ÊçÆÁªüËÆ°ÊòæÁ§∫ÔºàÁî®‰∫éÂØºÂá∫È°µÈù¢Ôºâ
            updateDataStats: function() {
                const bills = dataManager.getBills();
                const categories = dataManager.getCategories();
                const dataSize = dataManager.getDataSize();
                const backupInfo = dataManager.getBackupInfo();
                
                document.getElementById('exportBillCount').textContent = bills.length;
                document.getElementById('exportCategoryCount').textContent = categories.length;
                document.getElementById('exportDataSize').textContent = utils.getFileSize(dataSize);
                
                if (backupInfo.lastBackup) {
                    const lastBackup = new Date(backupInfo.lastBackup);
                    document.getElementById('exportLastBackup').textContent = 
                        lastBackup.toLocaleDateString('zh-CN');
                } else {
                    document.getElementById('exportLastBackup').textContent = '‰ªéÊú™Â§á‰ªΩ';
                }
            },
            
            // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
            bindEvents: function() {
                // ÁõëÂê¨Ë¥¶ÂçïÂèòÂåñ
                window.addEventListener('billsUpdated', () => {
                    this.updateStats();
                    this.updateDataStats();
                    
                    if (typeof budget !== 'undefined') {
                        budget.renderBudgetList();
                    }
                    
                    if (typeof calendar !== 'undefined') {
                        calendar.renderMiniCalendar();
                    }
                });
                
                // ÁõëÂê¨È¢ÑÁÆóÂèòÂåñ
                window.addEventListener('budgetsUpdated', () => {
                    this.updateStats();
                    
                    if (typeof budget !== 'undefined') {
                        budget.renderBudgetList();
                    }
                });
                
                // ÁõëÂê¨ÂàÜÁ±ªÂèòÂåñ
                window.addEventListener('categoriesUpdated', () => {
                    if (typeof bill !== 'undefined') {
                        bill.renderCategoryGrid();
                    }
                    
                    if (typeof budget !== 'undefined') {
                        budget.renderBudgetSetList();
                        budget.renderBudgetList();
                    }
                    
                    this.updateDataStats();
                });
                
                // ÂØÜÁ†ÅËæìÂÖ•Ê°ÜËá™Âä®È™åËØÅ
                const passwordInputs = document.querySelectorAll('.password-input');
                passwordInputs.forEach(input => {
                    input.addEventListener('input', function() {
                        auth.checkPasswordWhenComplete();
                    });
                    
                    input.addEventListener('keyup', function(e) {
                        if (e.key === 'Enter') {
                            auth.checkPassword();
                        }
                    });
                });
            },
            
            // ÊòæÁ§∫ÈÄöÁü•
            showNotification: function(message, type = 'info', duration = 3000) {
                // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <span class="notification-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                        <span class="notification-text">${message}</span>
                    </div>
                `;
                
                // Ê∑ªÂä†Âà∞È°µÈù¢
                document.body.appendChild(notification);
                
                // ÊòæÁ§∫ÈÄöÁü•
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                // Ëá™Âä®ÈöêËóè
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, duration);
            },
            
            // Ëé∑ÂèñÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó•Êúü
            getSelectedDate: function() {
                return new Date(this.currentSelectedDate);
            },
            
            // ËÆæÁΩÆÈÄâ‰∏≠ÁöÑÊó•Êúü
            setSelectedDate: function(date) {
                this.currentSelectedDate = new Date(date);
                
                // Êõ¥Êñ∞Êó•ÊúüÊòæÁ§∫
                const dateStr = utils.formatDateToYMD(this.currentSelectedDate);
                const displayStr = utils.formatDateDisplay(dateStr);
                document.getElementById('selectedDateTip').textContent = `ÂΩìÂâçÈÄâ‰∏≠Ôºö${displayStr}`;
                
                // Ëß¶ÂèëË¥¶ÂçïÊõ¥Êñ∞
                if (typeof bill !== 'undefined') {
                    bill.renderBillList();
                }
            }
        };

        // Êó•ÂéÜÊ®°Âùó
        const calendar = {
            // ÂΩìÂâçÊòæÁ§∫ÁöÑÊúà‰ªΩ
            currentCalendarDate: new Date(),
            
            // ÈÄâ‰∏≠ÁöÑÊó•Êúü
            selectedDate: new Date(),
            
            // Ëß¶Êë∏ÊªëÂä®Áõ∏ÂÖ≥ÂèòÈáè
            touchStartX: 0,
            touchEndX: 0,
            touchStartTime: 0,
            
            // ÊâìÂºÄÊó•ÂéÜÂºπÁ™ó
            openCalendarModal: function() {
                document.getElementById('calendarModal').classList.add('show');
                this.renderCalendar();
            },
            
            // ÂÖ≥Èó≠Êó•ÂéÜÂºπÁ™ó
            closeCalendarModal: function() {
                document.getElementById('calendarModal').classList.remove('show');
                
                // Êõ¥Êñ∞ÈÄâ‰∏≠Êó•ÊúüÊèêÁ§∫
                const year = this.selectedDate.getFullYear();
                const month = this.selectedDate.getMonth() + 1;
                const day = this.selectedDate.getDate();
                document.getElementById('selectedDateTip').textContent = 
                    `ÂΩìÂâçÈÄâ‰∏≠Ôºö${year}Âπ¥${month}Êúà${day}Êó•${this.isToday(this.selectedDate) ? 'Ôºà‰ªäÊó•Ôºâ' : ''}`;
                
                // Âà∑Êñ∞Ë¥¶Âçï
                if (typeof bill !== 'undefined') {
                    bill.renderBillList();
                }
            },
            
            // Ë∑≥ËΩ¨Âà∞‰ªäÂ§©
            jumpToToday: function() {
                this.selectedDate = new Date();
                this.currentCalendarDate = new Date();
                this.renderCalendar();
                this.updateCalendarSummary();
            },
            
            // ÂàáÊç¢Êúà‰ªΩ
            changeMonth: function(direction) {
                const newMonth = this.currentCalendarDate.getMonth() + direction;
                this.currentCalendarDate = new Date(this.currentCalendarDate.getFullYear(), newMonth, 1);
                this.renderCalendar();
            },
            
            // Ê∏≤ÊüìËø∑‰Ω†Êó•ÂéÜ
            renderMiniCalendar: function() {
                const year = this.selectedDate.getFullYear();
                const month = this.selectedDate.getMonth();
                const today = new Date();
                
                // Êõ¥Êñ∞Êúà‰ªΩÊòæÁ§∫
                document.getElementById('calendarMonthText').textContent = `${year}Âπ¥${month + 1}Êúà`;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const prevMonthDays = new Date(year, month, 0).getDate();
                
                const calendarDays = document.getElementById('miniCalendarDays');
                calendarDays.innerHTML = '';
                
                // Ê∑ªÂä†‰∏ä‰∏™ÊúàÁöÑÂç†‰ΩçÊó•Êúü
                for (let i = 0; i < firstDay; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day empty';
                    dayElement.textContent = prevMonthDays - firstDay + i + 1;
                    calendarDays.appendChild(dayElement);
                }
                
                // Ëé∑ÂèñÊúâË¥¶ÂçïÁöÑÊó•Êúü
                const billDates = this.getBillDatesInMonth(year, month);
                
                // Ê∑ªÂä†ÂΩìÊúàÊó•Êúü
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªäÂ§©
                    if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâË¥¶Âçï
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    if (billDates.includes(dateStr)) {
                        dayElement.classList.add('has-bill');
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÈÄâ‰∏≠Êó•Êúü
                    if (i === this.selectedDate.getDate() && month === this.selectedDate.getMonth() && year === this.selectedDate.getFullYear()) {
                        dayElement.classList.add('active');
                    }
                    
                    dayElement.textContent = i;
                    dayElement.dataset.date = dateStr;
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    dayElement.addEventListener('click', () => {
                        const [y, m, d] = dayElement.dataset.date.split('-').map(Number);
                        this.selectedDate = new Date(y, m - 1, d);
                        this.renderMiniCalendar();
                        
                        // Êõ¥Êñ∞‰∏ªÈ°µÈù¢
                        if (typeof bill !== 'undefined') {
                            bill.renderBillList();
                        }
                    });
                    
                    calendarDays.appendChild(dayElement);
                }
            },
            
            // Ê∏≤ÊüìÂÆåÊï¥Êó•ÂéÜ
            renderCalendar: function() {
                const year = this.currentCalendarDate.getFullYear();
                const month = this.currentCalendarDate.getMonth();
                
                // Êõ¥Êñ∞Âπ¥‰ªΩÂíåÊúà‰ªΩÊòæÁ§∫
                document.getElementById('calendarYear').textContent = year;
                document.getElementById('calendarMonth').textContent = month + 1;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const prevMonthDays = new Date(year, month, 0).getDate();
                
                const calendarDaysGrid = document.getElementById('calendarDaysGrid');
                calendarDaysGrid.innerHTML = '';
                
                // Ê∑ªÂä†‰∏ä‰∏™ÊúàÁöÑÂç†‰ΩçÊó•Êúü
                for (let i = 0; i < firstDay; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day-large empty';
                    dayElement.textContent = prevMonthDays - firstDay + i + 1;
                    calendarDaysGrid.appendChild(dayElement);
                }
                
                // Ëé∑ÂèñÊúâË¥¶ÂçïÁöÑÊó•ÊúüÂíåÈáëÈ¢ù
                const billData = this.getBillDataInMonth(year, month);
                
                // Ê∑ªÂä†ÂΩìÊúàÊó•Êúü
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day-large';
                    
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    const today = new Date();
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªäÂ§©
                    if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâË¥¶Âçï
                    if (billData[dateStr]) {
                        dayElement.classList.add('has-bill');
                        
                        // Ê∑ªÂä†ÈáëÈ¢ùÊòæÁ§∫
                        const amountElement = document.createElement('div');
                        amountElement.className = 'day-amount';
                        amountElement.textContent = `¬•${billData[dateStr].toFixed(0)}`;
                        dayElement.appendChild(amountElement);
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÈÄâ‰∏≠Êó•Êúü
                    if (i === this.selectedDate.getDate() && month === this.selectedDate.getMonth() && year === this.selectedDate.getFullYear()) {
                        dayElement.classList.add('active');
                    }
                    
                    dayElement.textContent = i;
                    dayElement.dataset.date = dateStr;
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    dayElement.addEventListener('click', () => {
                        const [y, m, d] = dayElement.dataset.date.split('-').map(Number);
                        this.selectedDate = new Date(y, m - 1, d);
                        this.renderCalendar();
                        this.updateCalendarSummary();
                    });
                    
                    calendarDaysGrid.appendChild(dayElement);
                }
                
                // Êõ¥Êñ∞Êó•ÂéÜÊëòË¶Å
                this.updateCalendarSummary();
            },
            
            // Ëé∑ÂèñÂΩìÊúàÊúâË¥¶ÂçïÁöÑÊó•Êúü
            getBillDatesInMonth: function(year, month) {
                const billDates = [];
                const monthStr = String(month + 1).padStart(2, '0');
                const bills = dataManager.getBills();
                
                bills.forEach(bill => {
                    if (bill.date.startsWith(`${year}-${monthStr}`)) {
                        billDates.push(bill.date);
                    }
                });
                
                return [...new Set(billDates)]; // ÂéªÈáç
            },
            
            // Ëé∑ÂèñÂΩìÊúàË¥¶ÂçïÊï∞ÊçÆÔºàÊó•Êúü->ÈáëÈ¢ùÔºâ
            getBillDataInMonth: function(year, month) {
                const billData = {};
                const monthStr = String(month + 1).padStart(2, '0');
                const bills = dataManager.getBills();
                
                bills.forEach(bill => {
                    if (bill.date.startsWith(`${year}-${monthStr}`)) {
                        if (!billData[bill.date]) {
                            billData[bill.date] = 0;
                        }
                        if (bill.type === 'expense') {
                            billData[bill.date] += bill.amount;
                        }
                    }
                });
                
                return billData;
            },
            
            // Êõ¥Êñ∞Êó•ÂéÜÊëòË¶Å
            updateCalendarSummary: function() {
                const dateStr = utils.formatDateToYMD(this.selectedDate);
                const bills = dataManager.getBills();
                
                // Á≠õÈÄâÂΩìÂ§©ÁöÑË¥¶Âçï
                const dayBills = bills.filter(bill => bill.date === dateStr);
                let totalAmount = 0;
                
                dayBills.forEach(bill => {
                    if (bill.type === 'expense') {
                        totalAmount -= bill.amount;
                    } else {
                        totalAmount += bill.amount;
                    }
                });
                
                // Êõ¥Êñ∞ÊëòË¶ÅÊòæÁ§∫
                document.getElementById('selectedDateText').textContent = 
                    `${this.selectedDate.getFullYear()}Âπ¥${this.selectedDate.getMonth() + 1}Êúà${this.selectedDate.getDate()}Êó•`;
                document.getElementById('selectedDateBills').textContent = `${dayBills.length}Á¨î`;
                document.getElementById('selectedDateAmount').textContent = 
                    totalAmount >= 0 ? `+¬•${totalAmount.toFixed(2)}` : `-¬•${Math.abs(totalAmount).toFixed(2)}`;
            },
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªäÂ§©
            isToday: function(date) {
                const today = new Date();
                return date.getDate() === today.getDate() &&
                       date.getMonth() === today.getMonth() &&
                       date.getFullYear() === today.getFullYear();
            }
        };

        // È¢ÑÁÆóÊ®°Âùó
        const budget = {
            // È¢ÑÁÆóÂë®Êúü
            budgetPeriod: 'monthly',
            
            // ÊâìÂºÄÈ¢ÑÁÆóËÆæÁΩÆÂºπÁ™ó
            openBudgetModal: function() {
                this.renderBudgetSetList();
                document.getElementById('budgetModal').classList.add('show');
            },
            
            // ÂÖ≥Èó≠È¢ÑÁÆóËÆæÁΩÆÂºπÁ™ó
            closeBudgetModal: function() {
                document.getElementById('budgetModal').classList.remove('show');
            },
            
            // Êõ¥ÊîπÈ¢ÑÁÆóÂë®Êúü
            changeBudgetPeriod: function() {
                this.budgetPeriod = document.getElementById('budgetPeriod').value;
                const descElement = document.getElementById('budgetPeriodDesc');
                
                switch(this.budgetPeriod) {
                    case 'weekly':
                        descElement.textContent = 'ÊØèÂë®ÈáçÊñ∞ËÆ°ÁÆóÈ¢ÑÁÆó';
                        break;
                    case 'monthly':
                        descElement.textContent = 'ÊØèÊúàÈáçÊñ∞ËÆ°ÁÆóÈ¢ÑÁÆó';
                        break;
                    case 'yearly':
                        descElement.textContent = 'ÊØèÂπ¥ÈáçÊñ∞ËÆ°ÁÆóÈ¢ÑÁÆó';
                        break;
                }
                
                this.renderBudgetSetList();
            },
            
            // Ê∏≤ÊüìÈ¢ÑÁÆóËÆæÁΩÆÂàóË°®
            renderBudgetSetList: function() {
                const budgetCategoriesList = document.getElementById('budgetCategoriesList');
                budgetCategoriesList.innerHTML = '';
                
                const categories = dataManager.getCategories();
                const monthKey = utils.getCurrentMonthKey();
                const budgets = dataManager.getBudgets();
                
                // ÂàùÂßãÂåñÂΩìÊúàÈ¢ÑÁÆóÂØπË±°
                if (!budgets[monthKey]) {
                    budgets[monthKey] = {};
                }
                
                // Âè™ÊòæÁ§∫ÊîØÂá∫Á±ªÂàÜÁ±ª
                const expenseCategories = categories.filter(cat => cat.type === 'expense' || cat.type === 'both');
                
                expenseCategories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'budget-set-item';
                    
                    // ËÆ°ÁÆóËØ•ÂàÜÁ±ªÊú¨ÊúàÂ∑≤ÊîØÂá∫ÈáëÈ¢ù
                    const bills = dataManager.getBills();
                    let spent = 0;
                    
                    bills.forEach(bill => {
                        const billDate = new Date(bill.date + 'T00:00:00Z');
                        if (utils.getMonthKey(billDate) === monthKey && 
                            bill.category === category.id && 
                            bill.type === 'expense') {
                            spent += bill.amount;
                        }
                    });
                    
                    categoryItem.innerHTML = `
                        <div class="budget-set-cate">
                            <div class="budget-set-icon">${category.icon}</div>
                            <div class="budget-set-name">${category.name}</div>
                            <div class="budget-set-spent">Â∑≤Áî®: ¬•${spent.toFixed(2)}</div>
                        </div>
                        <div class="budget-input-group">
                            <span class="input-prefix">¬•</span>
                            <input type="number" class="budget-set-input" 
                                   data-cate="${category.id}" 
                                   value="${budgets[monthKey][category.id] || ''}" 
                                   placeholder="0" min="0" step="0.01">
                        </div>
                    `;
                    
                    budgetCategoriesList.appendChild(categoryItem);
                });
                
                // Êõ¥Êñ∞ÊÄªÈ¢ÑÁÆó
                this.updateTotalBudget();
            },
            
            // Êõ¥Êñ∞ÊÄªÈ¢ÑÁÆó
            updateTotalBudget: function() {
                const inputs = document.querySelectorAll('.budget-set-input');
                let total = 0;
                
                inputs.forEach(input => {
                    const value = parseFloat(input.value) || 0;
                    total += value;
                });
                
                document.getElementById('totalBudget').value = total.toFixed(2);
            },
            
            // Ê†πÊçÆÊÄªÈ¢ÑÁÆóÊõ¥Êñ∞ÂàÜÁ±ªÈ¢ÑÁÆó
            updateCategoryBudgets: function() {
                const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
                const categories = dataManager.getCategories().filter(cat => cat.type === 'expense' || cat.type === 'both');
                
                if (categories.length === 0) return;
                
                // ËÆ°ÁÆóÊØè‰∏™ÂàÜÁ±ªÁöÑÂéÜÂè≤Âπ≥ÂùáÊîØÂá∫
                const bills = dataManager.getBills();
                const monthKey = utils.getCurrentMonthKey();
                const categorySpending = {};
                
                categories.forEach(category => {
                    categorySpending[category.id] = 0;
                });
                
                // ËÆ°ÁÆóËøáÂéª3‰∏™ÊúàÁöÑÊîØÂá∫
                const now = new Date();
                for (let i = 1; i <= 3; i++) {
                    const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const key = utils.getMonthKey(month);
                    
                    if (dataManager.getBudgets()[key]) {
                        Object.entries(dataManager.getBudgets()[key]).forEach(([catId, amount]) => {
                            if (categorySpending[catId] !== undefined) {
                                categorySpending[catId] += (amount || 0);
                            }
                        });
                    }
                }
                
                // ËÆ°ÁÆóÊÄªÂéÜÂè≤ÊîØÂá∫
                const totalSpending = Object.values(categorySpending).reduce((sum, val) => sum + val, 0);
                
                // ÊåâÊØî‰æãÂàÜÈÖçÈ¢ÑÁÆó
                categories.forEach(category => {
                    const input = document.querySelector(`.budget-set-input[data-cate="${category.id}"]`);
                    if (input) {
                        if (totalSpending > 0) {
                            const proportion = categorySpending[category.id] / totalSpending;
                            const allocated = totalBudget * proportion;
                            input.value = allocated.toFixed(2);
                        } else {
                            // Â¶ÇÊûúÊó†ÂéÜÂè≤Êï∞ÊçÆÔºåÂπ≥ÂùáÂàÜÈÖç
                            const allocated = totalBudget / categories.length;
                            input.value = allocated.toFixed(2);
                        }
                    }
                });
            },
            
            // Âπ≥ÂùáÂàÜÈÖçÈ¢ÑÁÆó
            distributeEvenly: function() {
                const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
                const categories = dataManager.getCategories().filter(cat => cat.type === 'expense' || cat.type === 'both');
                
                if (categories.length === 0) return;
                
                const allocated = totalBudget / categories.length;
                
                categories.forEach(category => {
                    const input = document.querySelector(`.budget-set-input[data-cate="${category.id}"]`);
                    if (input) {
                        input.value = allocated.toFixed(2);
                    }
                });
            },
            
            // Ê∏ÖÁ©∫ÊâÄÊúâÈ¢ÑÁÆó
            clearAllBudgets: function() {
                const inputs = document.querySelectorAll('.budget-set-input');
                inputs.forEach(input => {
                    input.value = '';
                });
                document.getElementById('totalBudget').value = '';
            },
            
            // ‰øùÂ≠òÊâÄÊúâÈ¢ÑÁÆó
            saveBudgets: function() {
                const monthKey = utils.getCurrentMonthKey();
                const inputs = document.querySelectorAll('.budget-set-input');
                const budgets = dataManager.getBudgets();
                
                // ÂàùÂßãÂåñÂΩìÊúàÈ¢ÑÁÆóÂØπË±°
                if (!budgets[monthKey]) {
                    budgets[monthKey] = {};
                }
                
                // ‰øùÂ≠òÊØè‰∏™ÂàÜÁ±ªÁöÑÈ¢ÑÁÆó
                inputs.forEach(input => {
                    const categoryId = input.dataset.cate;
                    const value = parseFloat(input.value) || 0;
                    budgets[monthKey][categoryId] = value > 0 ? value : null;
                });
                
                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                dataManager.saveBudgets(budgets);
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                this.closeBudgetModal();
                
                // Êõ¥Êñ∞È¢ÑÁÆóÊòæÁ§∫
                this.renderBudgetList();
                
                // Ëß¶ÂèëÈ¢ÑÁÆóÊõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new Event('budgetsUpdated'));
                
                // ÊòæÁ§∫ÈÄöÁü•
                app.showNotification('È¢ÑÁÆóËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
            },
            
            // Ê∏≤ÊüìÈ¢ÑÁÆóÂàóË°®
            renderBudgetList: function() {
                const budgetList = document.getElementById('budgetList');
                const monthKey = utils.getCurrentMonthKey();
                const budgets = dataManager.getBudgets();
                
                if (!budgets[monthKey]) {
                    budgetList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">ÊöÇÊó†È¢ÑÁÆó</div>
                            <div class="empty-desc">ËÆæÁΩÆÈ¢ÑÁÆóÂèØ‰ª•Êõ¥Â•ΩÂú∞ÊéßÂà∂Ê∂àË¥π</div>
                            <button class="empty-action" onclick="budget.openBudgetModal()">ËÆæÁΩÆÈ¢ÑÁÆó</button>
                        </div>
                    `;
                    return;
                }
                
                // Á≠õÈÄâÊúâÈ¢ÑÁÆóËÆæÁΩÆÁöÑÂàÜÁ±ª
                const budgetEntries = Object.entries(budgets[monthKey])
                    .filter(([_, amount]) => amount > 0);
                
                if (budgetEntries.length === 0) {
                    budgetList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìã</div>
                            <div class="empty-title">ÊöÇÊó†È¢ÑÁÆó</div>
                            <div class="empty-desc">ËÆæÁΩÆÈ¢ÑÁÆóÂèØ‰ª•Êõ¥Â•ΩÂú∞ÊéßÂà∂Ê∂àË¥π</div>
                            <button class="empty-action" onclick="budget.openBudgetModal()">ËÆæÁΩÆÈ¢ÑÁÆó</button>
                        </div>
                    `;
                    return;
                }
                
                // Ëé∑ÂèñÂàÜÁ±ª‰ø°ÊÅØ
                const categories = dataManager.getCategories();
                const categoryMap = {};
                categories.forEach(cat => categoryMap[cat.id] = cat);
                
                // Ëé∑ÂèñÊú¨ÊúàË¥¶ÂçïÊï∞ÊçÆ
                const bills = dataManager.getBills();
                const now = new Date();
                
                let budgetItemsHTML = '';
                
                budgetEntries.forEach(([categoryId, budgetAmount]) => {
                    const category = categoryMap[categoryId];
                    if (!category) return;
                    
                    // ËÆ°ÁÆóËØ•ÂàÜÁ±ªÊú¨ÊúàÂ∑≤ÊîØÂá∫ÈáëÈ¢ù
                    let spent = 0;
                    bills.forEach(bill => {
                        const billDate = new Date(bill.date + 'T00:00:00Z');
                        if (utils.getMonthKey(billDate) === monthKey && 
                            bill.category === categoryId && 
                            bill.type === 'expense') {
                            spent += bill.amount;
                        }
                    });
                    
                    const remaining = budgetAmount - spent;
                    const percentage = utils.calculatePercentage(spent, budgetAmount);
                    const isOver = remaining < 0;
                    
                    budgetItemsHTML += `
                        <div class="budget-item">
                            <div class="budget-cate">
                                <div class="budget-cate-icon">${category.icon}</div>
                                <div class="budget-cate-name">${category.name}</div>
                            </div>
                            <div class="budget-usage">
                                <div class="budget-used ${isOver ? 'budget-over' : ''}">
                                    ¬•${spent.toFixed(2)}/${budgetAmount.toFixed(2)}
                                </div>
                                <div class="budget-remain ${isOver ? 'budget-over' : ''}">
                                    ${isOver ? 'Ë∂ÖÊîØ' : 'Ââ©‰Ωô'} ¬•${Math.abs(remaining).toFixed(2)}
                                </div>
                            </div>
                            <div class="budget-progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: ${utils.getPercentageColor(percentage)}"></div>
                            </div>
                        </div>
                    `;
                });
                
                budgetList.innerHTML = budgetItemsHTML;
            },
            
            // ÈáçÁΩÆÈ¢ÑÁÆó
            resetBudgets: function() {
                utils.showConfirmModal(
                    'ÈáçÁΩÆÈ¢ÑÁÆó',
                    'Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÈ¢ÑÁÆóËÆæÁΩÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ',
                    '‚ö†Ô∏è',
                    () => {
                        const monthKey = utils.getCurrentMonthKey();
                        const budgets = dataManager.getBudgets();
                        
                        if (budgets[monthKey]) {
                            delete budgets[monthKey];
                            dataManager.saveBudgets(budgets);
                            
                            // Êõ¥Êñ∞ÊòæÁ§∫
                            this.renderBudgetList();
                            window.dispatchEvent(new Event('budgetsUpdated'));
                            
                            app.showNotification('È¢ÑÁÆóÂ∑≤ÈáçÁΩÆ', 'success');
                        }
                    }
                );
            }
        };

        // Ë¥¶ÂçïÊ®°Âùó
        const bill = {
            // ÂΩìÂâçË¥¶ÂçïÁ±ªÂûã
            currentType: 'expense',
            
            // ÈÄâ‰∏≠ÁöÑÂàÜÁ±ª
            selectedCategory: null,
            
            // ÈïøÊåâËÆ°Êó∂Âô®
            longPressTimer: null,
            
            // ÊâìÂºÄËÆ∞Ë¥¶ÂºπÁ™ó
            openBillModal: function() {
                const today = new Date();
                const todayStr = utils.formatDateToYMD(today);
                
                document.getElementById('billModal').classList.add('show');
                document.getElementById('billAmount').value = '';
                document.getElementById('billAmount').focus();
                document.getElementById('billDate').value = todayStr;
                document.getElementById('billDateDisplay').textContent = '‰ªäÂ§©';
                document.getElementById('billNote').value = '';
                
                this.setType('expense');
                this.renderCategoryGrid();
            },
            
            // ÂÖ≥Èó≠ËÆ∞Ë¥¶ÂºπÁ™ó
            closeBillModal: function() {
                document.getElementById('billModal').classList.remove('show');
                this.selectedCategory = null;
            },
            
            // ËÆæÁΩÆË¥¶ÂçïÁ±ªÂûã
            setType: function(type) {
                this.currentType = type;
                const buttons = document.querySelectorAll('.type-btn');
                
                buttons.forEach(btn => {
                    if (btn.dataset.type === type) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Ê†πÊçÆÁ±ªÂûãËøáÊª§ÂàÜÁ±ª
                this.renderCategoryGrid();
            },
            
            // È™åËØÅÈáëÈ¢ù
            validateAmount: function(input) {
                return utils.validateAmount(input);
            },
            
            // Êõ¥Êñ∞Êó•ÊúüÊòæÁ§∫
            updateDateDisplay: function() {
                const dateInput = document.getElementById('billDate');
                const displayElement = document.getElementById('billDateDisplay');
                
                if (dateInput.value) {
                    const date = new Date(dateInput.value + 'T00:00:00Z');
                    displayElement.textContent = utils.formatDateDisplay(dateInput.value);
                }
            },
            
            // Ê∏≤ÊüìÂàÜÁ±ªÁΩëÊ†º
            renderCategoryGrid: function() {
                const categoryGrid = document.getElementById('categoryGrid');
                categoryGrid.innerHTML = '';
                
                const categories = dataManager.getCategories();
                
                // Ê†πÊçÆÂΩìÂâçÁ±ªÂûãËøáÊª§ÂàÜÁ±ª
                const filteredCategories = categories.filter(cat => 
                    cat.type === this.currentType || cat.type === 'both'
                );
                
                filteredCategories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = `category-item ${this.selectedCategory === category.id ? 'active' : ''}`;
                    categoryItem.dataset.categoryId = category.id;
                    
                    categoryItem.innerHTML = `
                        <div class="category-icon">${category.icon}</div>
                        <div class="category-name">${category.name}</div>
                    `;
                    
                    // ÁÇπÂáªÈÄâÊã©ÂàÜÁ±ª
                    categoryItem.addEventListener('click', () => {
                        this.selectedCategory = category.id;
                        this.renderCategoryGrid();
                    });
                    
                    // ÈïøÊåâÂà†Èô§ÂàÜÁ±ª
                    categoryItem.addEventListener('touchstart', (e) => {
                        this.longPressTimer = setTimeout(() => {
                            this.handleCategoryLongPress(category);
                        }, 800);
                    });
                    
                    categoryItem.addEventListener('touchend', () => {
                        clearTimeout(this.longPressTimer);
                    });
                    
                    categoryItem.addEventListener('touchmove', () => {
                        clearTimeout(this.longPressTimer);
                    });
                    
                    categoryGrid.appendChild(categoryItem);
                });
            },
            
            // Â§ÑÁêÜÂàÜÁ±ªÈïøÊåâ
            handleCategoryLongPress: function(category) {
                utils.showConfirmModal(
                    'Âà†Èô§ÂàÜÁ±ª',
                    `Á°ÆÂÆöË¶ÅÂà†Èô§"${category.name}"ÂàÜÁ±ªÂêóÔºüËØ•ÂàÜÁ±ª‰∏ãÁöÑÊâÄÊúâË¥¶ÂçïÂ∞ÜË¢´ÁßªÂä®Âà∞"ÂÖ∂‰ªñ"ÂàÜÁ±ª„ÄÇ`,
                    'üóëÔ∏è',
                    () => {
                        this.deleteCategory(category.id);
                    }
                );
            },
            
            // Âà†Èô§ÂàÜÁ±ª
            deleteCategory: function(categoryId) {
                const categories = dataManager.getCategories();
                const bills = dataManager.getBills();
                
                // ÊâæÂà∞"ÂÖ∂‰ªñ"ÂàÜÁ±ªÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôÂàõÂª∫
                let otherCategory = categories.find(cat => cat.name === 'ÂÖ∂‰ªñ');
                if (!otherCategory) {
                    otherCategory = {
                        id: utils.generateId(),
                        name: 'ÂÖ∂‰ªñ',
                        icon: 'üîß',
                        type: 'both',
                        color: '#8E8E93'
                    };
                    categories.push(otherCategory);
                }
                
                // Êõ¥Êñ∞Ë¥¶Âçï‰∏≠ÁöÑÂàÜÁ±ª
                bills.forEach(bill => {
                    if (bill.category === categoryId) {
                        bill.category = otherCategory.id;
                    }
                });
                
                // Âà†Èô§ÂàÜÁ±ª
                const categoryIndex = categories.findIndex(cat => cat.id === categoryId);
                if (categoryIndex > -1) {
                    categories.splice(categoryIndex, 1);
                }
                
                // ‰øùÂ≠òÊï∞ÊçÆ
                dataManager.saveCategories(categories);
                dataManager.saveBills(bills);
                
                // ÈáçÊñ∞Ê∏≤Êüì
                this.renderCategoryGrid();
                
                // Ëß¶ÂèëÂàÜÁ±ªÊõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new Event('categoriesUpdated'));
                
                app.showNotification('ÂàÜÁ±ªÂ∑≤Âà†Èô§', 'success');
            },
            
            // ‰øùÂ≠òË¥¶Âçï
            saveBill: function() {
                const amountInput = document.getElementById('billAmount');
                const amount = parseFloat(amountInput.value);
                const date = document.getElementById('billDate').value;
                const note = document.getElementById('billNote').value.trim();
                
                // È™åËØÅÈáëÈ¢ù
                if (!utils.validateAmount(amountInput)) {
                    return;
                }
                
                // È™åËØÅÂàÜÁ±ª
                if (!this.selectedCategory) {
                    alert('ËØ∑ÈÄâÊã©ÂàÜÁ±ª');
                    return;
                }
                
                // ÂàõÂª∫Ë¥¶ÂçïÂØπË±°
                const newBill = {
                    id: utils.generateId(),
                    amount: amount,
                    type: this.currentType,
                    category: this.selectedCategory,
                    date: date,
                    note: note,
                    createdAt: new Date().toISOString()
                };
                
                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                const bills = dataManager.getBills();
                bills.unshift(newBill); // Ê∑ªÂä†Âà∞ÂºÄÂ§¥
                dataManager.saveBills(bills);
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                this.closeBillModal();
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                this.renderBillList();
                
                // Ëß¶ÂèëË¥¶ÂçïÊõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new Event('billsUpdated'));
                
                // Êõ¥Êñ∞Êó•ÂéÜÊ†áËÆ∞
                if (typeof calendar !== 'undefined') {
                    calendar.renderMiniCalendar();
                }
                
                app.showNotification('Ë¥¶ÂçïÂ∑≤‰øùÂ≠ò', 'success');
            },
            
            // Ê∏≤ÊüìË¥¶ÂçïÂàóË°®
            renderBillList: function() {
                const billsList = document.getElementById('recentBillsList');
                const filter = document.getElementById('billFilter').value;
                const bills = dataManager.getBills();
                const categories = dataManager.getCategories();
                
                // ÂàõÂª∫ÂàÜÁ±ªÊò†Â∞Ñ
                const categoryMap = {};
                categories.forEach(cat => {
                    categoryMap[cat.id] = cat;
                });
                
                // Ê†πÊçÆÁ≠õÈÄâÊù°‰ª∂ËøáÊª§Ë¥¶Âçï
                let filteredBills = [...bills];
                const today = new Date();
                
                switch(filter) {
                    case 'today':
                        const todayStr = utils.formatDateToYMD(today);
                        filteredBills = bills.filter(bill => bill.date === todayStr);
                        break;
                    case 'week':
                        const weekAgo = new Date(today);
                        weekAgo.setUTCDate(weekAgo.getUTCDate() - 7);
                        filteredBills = bills.filter(bill => {
                            const billDate = new Date(bill.date + 'T00:00:00Z');
                            return billDate >= weekAgo;
                        });
                        break;
                    case 'month':
                        const monthAgo = new Date(today);
                        monthAgo.setUTCMonth(monthAgo.getUTCMonth() - 1);
                        filteredBills = bills.filter(bill => {
                            const billDate = new Date(bill.date + 'T00:00:00Z');
                            return billDate >= monthAgo;
                        });
                        break;
                    case 'all':
                        // ‰∏çËøõË°åËøáÊª§
                        break;
                }
                
                if (filteredBills.length === 0) {
                    billsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <div class="empty-title">ÊöÇÊó†Ë¥¶ÂçïËÆ∞ÂΩï</div>
                            <div class="empty-desc">ÁÇπÂáª‰∏ãÊñπ+ÊåâÈíÆÂºÄÂßãËÆ∞Ë¥¶</div>
                        </div>
                    `;
                    return;
                }
                
                let billsHTML = '';
                
                filteredBills.forEach(bill => {
                    const category = categoryMap[bill.category] || { name: 'Êú™Áü•', icon: 'üîß' };
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    const displayDate = utils.formatDateDisplay(bill.date);
                    const time = utils.formatTime(bill.createdAt);
                    
                    billsHTML += `
                        <div class="bill-item" data-id="${bill.id}">
                            <div class="bill-left">
                                <div class="bill-icon">${category.icon}</div>
                                <div class="bill-info">
                                    <div class="bill-category">${category.name}</div>
                                    <div class="bill-date">${displayDate} ${time}</div>
                                    ${bill.note ? `<div class="bill-note">${bill.note}</div>` : ''}
                                </div>
                            </div>
                            <div class="bill-amount ${bill.type}">
                                ${bill.type === 'expense' ? '-' : '+'}¬•${bill.amount.toFixed(2)}
                            </div>
                        </div>
                    `;
                });
                
                billsList.innerHTML = billsHTML;
                
                // Ê∑ªÂä†ÊªëÂä®Âà†Èô§ÂäüËÉΩ
                this.addSwipeDelete();
            },
            
            // Ê∑ªÂä†ÊªëÂä®Âà†Èô§ÂäüËÉΩ
            addSwipeDelete: function() {
                const billItems = document.querySelectorAll('.bill-item');
                
                billItems.forEach(item => {
                    let startX = 0;
                    let currentX = 0;
                    let isSwiped = false;
                    
                    item.addEventListener('touchstart', (e) => {
                        startX = e.touches[0].clientX;
                        isSwiped = false;
                    });
                    
                    item.addEventListener('touchmove', (e) => {
                        if (isSwiped) return;
                        
                        currentX = e.touches[0].clientX;
                        const diffX = startX - currentX;
                        
                        // Âè™ÂÖÅËÆ∏ÂêëÂ∑¶ÊªëÂä®
                        if (diffX > 0) {
                            item.style.transform = `translateX(-${Math.min(diffX, 80)}px)`;
                        }
                    });
                    
                    item.addEventListener('touchend', () => {
                        const diffX = startX - currentX;
                        
                        if (diffX > 50) {
                            // ÊªëÂä®Ë∑ùÁ¶ªË∂≥Â§üÔºåÊòæÁ§∫Âà†Èô§Á°ÆËÆ§
                            item.style.transform = 'translateX(-80px)';
                            isSwiped = true;
                            
                            // Ê∑ªÂä†Âà†Èô§ÊåâÈíÆ
                            this.addDeleteButton(item);
                        } else {
                            // ÊªëÂä®Ë∑ùÁ¶ª‰∏çË∂≥ÔºåÂ§ç‰Ωç
                            item.style.transform = 'translateX(0)';
                        }
                    });
                });
            },
            
            // Ê∑ªÂä†Âà†Èô§ÊåâÈíÆ
            addDeleteButton: function(item) {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÂà†Èô§ÊåâÈíÆ
                if (item.nextElementSibling && item.nextElementSibling.classList.contains('delete-btn')) {
                    return;
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = 'Âà†Èô§';
                deleteBtn.style.cssText = `
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: #FF3B30;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 8px;
                    font-size: 14px;
                    cursor: pointer;
                    z-index: 1;
                `;
                
                deleteBtn.addEventListener('click', () => {
                    const billId = item.dataset.id;
                    this.deleteBill(billId);
                });
                
                item.parentNode.insertBefore(deleteBtn, item.nextSibling);
                
                // ÁÇπÂáªÂÖ∂‰ªñ‰ΩçÁΩÆÂ§ç‰Ωç
                const resetItem = () => {
                    item.style.transform = 'translateX(0)';
                    if (deleteBtn.parentNode) {
                        deleteBtn.parentNode.removeChild(deleteBtn);
                    }
                    document.removeEventListener('click', resetItem);
                };
                
                setTimeout(() => {
                    document.addEventListener('click', resetItem);
                }, 100);
            },
            
            // Âà†Èô§Ë¥¶Âçï
            deleteBill: function(billId) {
                utils.showConfirmModal(
                    'Âà†Èô§Ë¥¶Âçï',
                    'Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Ë¥¶ÂçïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ',
                    'üóëÔ∏è',
                    () => {
                        const bills = dataManager.getBills();
                        const updatedBills = bills.filter(bill => bill.id !== billId);
                        
                        dataManager.saveBills(updatedBills);
                        
                        // ÈáçÊñ∞Ê∏≤Êüì
                        this.renderBillList();
                        
                        // Ëß¶ÂèëÊõ¥Êñ∞‰∫ã‰ª∂
                        window.dispatchEvent(new Event('billsUpdated'));
                        
                        // Êõ¥Êñ∞Êó•ÂéÜÊ†áËÆ∞
                        if (typeof calendar !== 'undefined') {
                            calendar.renderMiniCalendar();
                        }
                        
                        app.showNotification('Ë¥¶ÂçïÂ∑≤Âà†Èô§', 'success');
                    }
                );
            },
            
            // Á≠õÈÄâË¥¶Âçï
            filterBills: function() {
                this.renderBillList();
            }
        };

        // ÂàÜÁ±ªÊ®°Âùó
        const category = {
            // ÊâìÂºÄÂàÜÁ±ªÁÆ°ÁêÜÂºπÁ™ó
            openCategoryModal: function() {
                this.renderCategoryList();
                document.getElementById('categoryModal').classList.add('show');
            },
            
            // ÂÖ≥Èó≠ÂàÜÁ±ªÁÆ°ÁêÜÂºπÁ™ó
            closeCategoryModal: function() {
                document.getElementById('categoryModal').classList.remove('show');
            },
            
            // ÊâìÂºÄÊñ∞Â¢ûÂàÜÁ±ªÂºπÁ™ó
            openAddCateModal: function() {
                document.getElementById('addCateModal').classList.add('show');
                document.getElementById('newCateName').value = '';
                document.getElementById('newCateType').value = 'expense';
                
                // Ê∏≤ÊüìÂõæÊ†áÈÄâÊã©Âô®
                this.renderIconSelector();
            },
            
            // ÂÖ≥Èó≠Êñ∞Â¢ûÂàÜÁ±ªÂºπÁ™ó
            closeAddCateModal: function() {
                document.getElementById('addCateModal').classList.remove('show');
            },
            
            // Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®
            renderCategoryList: function() {
                const categoryList = document.getElementById('categoryList');
                const categories = dataManager.getCategories();
                
                if (categories.length === 0) {
                    categoryList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üè∑Ô∏è</div>
                            <div class="empty-title">ÊöÇÊó†ÂàÜÁ±ª</div>
                            <div class="empty-desc">ÁÇπÂáª‰∏ãÊñπÊåâÈíÆÊ∑ªÂä†ÂàÜÁ±ª</div>
                        </div>
                    `;
                    return;
                }
                
                let categoriesHTML = '';
                
                // ÊåâÁ±ªÂûãÂàÜÁªÑ
                const expenseCategories = categories.filter(cat => cat.type === 'expense' || cat.type === 'both');
                const incomeCategories = categories.filter(cat => cat.type === 'income' || cat.type === 'both');
                
                if (expenseCategories.length > 0) {
                    categoriesHTML += `<div class="category-group">
                        <div class="group-title">ÊîØÂá∫ÂàÜÁ±ª</div>
                        <div class="group-items">`;
                    
                    expenseCategories.forEach(category => {
                        categoriesHTML += this.createCategoryItemHTML(category);
                    });
                    
                    categoriesHTML += `</div></div>`;
                }
                
                if (incomeCategories.length > 0) {
                    categoriesHTML += `<div class="category-group">
                        <div class="group-title">Êî∂ÂÖ•ÂàÜÁ±ª</div>
                        <div class="group-items">`;
                    
                    incomeCategories.forEach(category => {
                        categoriesHTML += this.createCategoryItemHTML(category);
                    });
                    
                    categoriesHTML += `</div></div>`;
                }
                
                categoryList.innerHTML = categoriesHTML;
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.addCategoryEventListeners();
            },
            
            // ÂàõÂª∫ÂàÜÁ±ªÈ°πHTML
            createCategoryItemHTML: function(category) {
                return `
                    <div class="category-list-item" data-id="${category.id}">
                        <div class="category-item-content">
                            <div class="category-item-icon">${category.icon}</div>
                            <div class="category-item-info">
                                <div class="category-item-name">${category.name}</div>
                                <div class="category-item-type">${this.getTypeText(category.type)}</div>
                            </div>
                        </div>
                        <div class="category-item-actions">
                            <button class="action-btn edit-btn" title="ÁºñËæë">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" title="Âà†Èô§">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            },
            
            // Ëé∑ÂèñÁ±ªÂûãÊñáÊú¨
            getTypeText: function(type) {
                switch(type) {
                    case 'expense': return 'ÊîØÂá∫';
                    case 'income': return 'Êî∂ÂÖ•';
                    case 'both': return 'ÊîØÂá∫/Êî∂ÂÖ•';
                    default: return 'Êú™Áü•';
                }
            },
            
            // Ê∑ªÂä†ÂàÜÁ±ª‰∫ã‰ª∂ÁõëÂê¨Âô®
            addCategoryEventListeners: function() {
                const categoryItems = document.querySelectorAll('.category-list-item');
                
                categoryItems.forEach(item => {
                    const editBtn = item.querySelector('.edit-btn');
                    const deleteBtn = item.querySelector('.delete-btn');
                    const categoryId = item.dataset.id;
                    
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.editCategory(categoryId);
                    });
                    
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteCategory(categoryId);
                    });
                });
            },
            
            // ÁºñËæëÂàÜÁ±ª
            editCategory: function(categoryId) {
                const categories = dataManager.getCategories();
                const category = categories.find(cat => cat.id === categoryId);
                
                if (!category) return;
                
                // ‰ΩøÁî®Êñ∞Â¢ûÂàÜÁ±ªÂºπÁ™óËøõË°åÁºñËæë
                document.getElementById('addCateModal').classList.add('show');
                document.getElementById('newCateName').value = category.name;
                document.getElementById('newCateType').value = category.type;
                
                // Ê∏≤ÊüìÂõæÊ†áÈÄâÊã©Âô®Âπ∂ÈÄâ‰∏≠ÂΩìÂâçÂõæÊ†á
                this.renderIconSelector(category.icon);
                
                // ‰øÆÊîπ‰øùÂ≠òÊåâÈíÆÁöÑË°å‰∏∫
                const saveBtn = document.querySelector('#addCateModal .save-btn');
                const originalOnclick = saveBtn.onclick;
                
                saveBtn.onclick = () => {
                    this.updateCategory(categoryId);
                    saveBtn.onclick = originalOnclick;
                };
                
                saveBtn.textContent = 'Êõ¥Êñ∞ÂàÜÁ±ª';
            },
            
            // Êõ¥Êñ∞ÂàÜÁ±ª
            updateCategory: function(categoryId) {
                const name = document.getElementById('newCateName').value.trim();
                const type = document.getElementById('newCateType').value;
                const selectedIcon = document.querySelector('.icon-option.selected');
                
                if (!selectedIcon) {
                    alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂõæÊ†á');
                    return;
                }
                
                const icon = selectedIcon.textContent;
                
                // È™åËØÅÂàÜÁ±ªÂêçÁß∞
                const validation = utils.validateCategoryName(name);
                if (!validation.valid) {
                    document.getElementById('cateNameError').textContent = validation.message;
                    return;
                }
                
                const categories = dataManager.getCategories();
                const categoryIndex = categories.findIndex(cat => cat.id === categoryId);
                
                if (categoryIndex === -1) return;
                
                // Ê£ÄÊü•ÂêçÁß∞ÊòØÂê¶ÈáçÂ§çÔºàÊéíÈô§Ëá™Â∑±Ôºâ
                const isDuplicate = categories.some((cat, index) => 
                    index !== categoryIndex && cat.name === name
                );
                
                if (isDuplicate) {
                    document.getElementById('cateNameError').textContent = 'ÂàÜÁ±ªÂêçÁß∞Â∑≤Â≠òÂú®';
                    return;
                }
                
                // Êõ¥Êñ∞ÂàÜÁ±ª
                categories[categoryIndex] = {
                    ...categories[categoryIndex],
                    name: name,
                    icon: icon,
                    type: type
                };
                
                // ‰øùÂ≠òÊï∞ÊçÆ
                dataManager.saveCategories(categories);
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                this.closeAddCateModal();
                
                // ÈáçÊñ∞Ê∏≤Êüì
                this.renderCategoryList();
                
                // Ëß¶ÂèëÂàÜÁ±ªÊõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new Event('categoriesUpdated'));
                
                app.showNotification('ÂàÜÁ±ªÂ∑≤Êõ¥Êñ∞', 'success');
            },
            
            // Âà†Èô§ÂàÜÁ±ª
            deleteCategory: function(categoryId) {
                utils.showConfirmModal(
                    'Âà†Èô§ÂàÜÁ±ª',
                    'Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂàÜÁ±ªÂêóÔºüËØ•ÂàÜÁ±ª‰∏ãÁöÑÊâÄÊúâË¥¶ÂçïÂ∞ÜË¢´ÁßªÂä®Âà∞"ÂÖ∂‰ªñ"ÂàÜÁ±ª„ÄÇ',
                    'üóëÔ∏è',
                    () => {
                        const categories = dataManager.getCategories();
                        const bills = dataManager.getBills();
                        
                        // ÊâæÂà∞"ÂÖ∂‰ªñ"ÂàÜÁ±ªÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôÂàõÂª∫
                        let otherCategory = categories.find(cat => cat.name === 'ÂÖ∂‰ªñ');
                        if (!otherCategory) {
                            otherCategory = {
                                id: utils.generateId(),
                                name: 'ÂÖ∂‰ªñ',
                                icon: 'üîß',
                                type: 'both',
                                color: '#8E8E93'
                            };
                            categories.push(otherCategory);
                        }
                        
                        // Êõ¥Êñ∞Ë¥¶Âçï‰∏≠ÁöÑÂàÜÁ±ª
                        bills.forEach(bill => {
                            if (bill.category === categoryId) {
                                bill.category = otherCategory.id;
                            }
                        });
                        
                        // Âà†Èô§ÂàÜÁ±ª
                        const categoryIndex = categories.findIndex(cat => cat.id === categoryId);
                        if (categoryIndex > -1) {
                            categories.splice(categoryIndex, 1);
                        }
                        
                        // ‰øùÂ≠òÊï∞ÊçÆ
                        dataManager.saveCategories(categories);
                        dataManager.saveBills(bills);
                        
                        // ÈáçÊñ∞Ê∏≤Êüì
                        this.renderCategoryList();
                        
                        // Ëß¶ÂèëÂàÜÁ±ªÊõ¥Êñ∞‰∫ã‰ª∂
                        window.dispatchEvent(new Event('categoriesUpdated'));
                        
                        app.showNotification('ÂàÜÁ±ªÂ∑≤Âà†Èô§', 'success');
                    }
                );
            },
            
            // Ê∏≤ÊüìÂõæÊ†áÈÄâÊã©Âô®
            renderIconSelector: function(selectedIcon = null) {
                const iconSelector = document.getElementById('iconSelector');
                const icons = [
                    'üçú', 'üöå', 'üé¨', 'üìö', 'üõçÔ∏è', 'üè†', 'üíº', 'üîß',
                    'üß¥', 'ü•¨', 'üçé', 'ü•§', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë´', '‚úàÔ∏è', 'üíä',
                    'üéÅ', 'üí∞', 'üì§', 'üìà', 'üìâ', 'üí≥', 'üçî', '‚òï',
                    'üéÆ', 'üì±', 'üöó', 'üíÑ', 'üéµ', 'üé®', '‚öΩ', 'üé≠'
                ];
                
                let iconsHTML = '';
                
                icons.forEach(icon => {
                    const isSelected = icon === selectedIcon;
                    iconsHTML += `
                        <div class="icon-option ${isSelected ? 'selected' : ''}" data-icon="${icon}">
                            ${icon}
                        </div>
                    `;
                });
                
                iconSelector.innerHTML = iconsHTML;
                
                // Ê∑ªÂä†ÂõæÊ†áÈÄâÊã©‰∫ã‰ª∂
                const iconOptions = document.querySelectorAll('.icon-option');
                iconOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        // ÁßªÈô§ÂÖ∂‰ªñÈÄâ‰∏≠Áä∂ÊÄÅ
                        iconOptions.forEach(opt => opt.classList.remove('selected'));
                        // Ê∑ªÂä†ÂΩìÂâçÈÄâ‰∏≠Áä∂ÊÄÅ
                        option.classList.add('selected');
                    });
                });
            },
            
            // ‰øùÂ≠òÊñ∞ÂàÜÁ±ª
            saveNewCategory: function() {
                const name = document.getElementById('newCateName').value.trim();
                const type = document.getElementById('newCateType').value;
                const selectedIcon = document.querySelector('.icon-option.selected');
                
                if (!selectedIcon) {
                    alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÂõæÊ†á');
                    return;
                }
                
                const icon = selectedIcon.textContent;
                
                // È™åËØÅÂàÜÁ±ªÂêçÁß∞
                const validation = utils.validateCategoryName(name);
                if (!validation.valid) {
                    document.getElementById('cateNameError').textContent = validation.message;
                    return;
                }
                
                const categories = dataManager.getCategories();
                
                // Ê£ÄÊü•ÂêçÁß∞ÊòØÂê¶ÈáçÂ§ç
                const isDuplicate = categories.some(cat => cat.name === name);
                if (isDuplicate) {
                    document.getElementById('cateNameError').textContent = 'ÂàÜÁ±ªÂêçÁß∞Â∑≤Â≠òÂú®';
                    return;
                }
                
                // ÂàõÂª∫Êñ∞ÂàÜÁ±ª
                const newCategory = {
                    id: utils.generateId(),
                    name: name,
                    icon: icon,
                    type: type,
                    color: '#8E8E93'
                };
                
                // Ê∑ªÂä†Âà∞ÂàÜÁ±ªÂàóË°®
                categories.push(newCategory);
                
                // ‰øùÂ≠òÊï∞ÊçÆ
                dataManager.saveCategories(categories);
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                this.closeAddCateModal();
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®
                this.renderCategoryList();
                
                // Ëß¶ÂèëÂàÜÁ±ªÊõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new Event('categoriesUpdated'));
                
                app.showNotification('ÂàÜÁ±ªÂ∑≤Ê∑ªÂä†', 'success');
            }
        };

        // ÂõæË°®Ê®°Âùó
        const charts = {
            // ÂõæË°®ÂÆû‰æã
            trendChart: null,
            pieChart: null,
            budgetChart: null,
            
            // È¢ÑÁÆóÂõæË°®Á±ªÂûã
            budgetChartType: 'bar', // 'bar' Êàñ 'radar'
            
            // ÂàùÂßãÂåñÂõæË°®
            initCharts: function() {
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js Êú™Âä†ËΩΩ');
                    return;
                }
                
                // ÂàùÂßãÂåñÂõæË°®ÂÆû‰æã
                this.trendChart = this.createTrendChart();
                this.pieChart = this.createPieChart();
                this.budgetChart = this.createBudgetChart();
                
                // Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ
                this.updateCharts();
            },
            
            // ÂàõÂª∫Ë∂ãÂäøÂõæË°®
            createTrendChart: function() {
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                return new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'ÊîØÂá∫',
                                data: [],
                                borderColor: '#FF3B30',
                                backgroundColor: 'rgba(255, 59, 48, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.3
                            },
                            {
                                label: 'Êî∂ÂÖ•',
                                data: [],
                                borderColor: '#34C759',
                                backgroundColor: 'rgba(52, 199, 89, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ¬•${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '¬•' + value;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // ÂàõÂª∫È•ºÂõæ
            createPieChart: function() {
                const ctx = document.getElementById('pieChart').getContext('2d');
                
                return new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#FF3B30', '#FF9500', '#FFCC00', '#34C759',
                                '#5AC8FA', '#007AFF', '#5856D6', '#AF52DE',
                                '#FF2D55', '#8E8E93', '#A2845E', '#32D74B'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${context.label}: ¬•${value.toFixed(2)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // ÂàõÂª∫È¢ÑÁÆóÂõæË°®
            createBudgetChart: function() {
                const ctx = document.getElementById('budgetChart').getContext('2d');
                
                return new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'È¢ÑÁÆó',
                                data: [],
                                backgroundColor: 'rgba(0, 122, 255, 0.7)',
                                borderColor: '#007AFF',
                                borderWidth: 1
                            },
                            {
                                label: 'ÂÆûÈôÖÊîØÂá∫',
                                data: [],
                                backgroundColor: 'rgba(255, 59, 48, 0.7)',
                                borderColor: '#FF3B30',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ¬•${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '¬•' + value;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // Êõ¥Êñ∞ÊâÄÊúâÂõæË°®
            updateCharts: function() {
                this.updateTrendChart();
                this.updatePieChart();
                this.updateBudgetChart();
                this.updateStatsSummary();
            },
            
            // Êõ¥Êñ∞Ë∂ãÂäøÂõæË°®
            updateTrendChart: function() {
                const period = document.getElementById('chartPeriod').value;
                const bills = dataManager.getBills();
                
                let labels = [];
                let expenseData = [];
                let incomeData = [];
                
                const now = new Date();
                
                switch(period) {
                    case 'month':
                        // ÊúÄËøë30Â§©
                        for (let i = 29; i >= 0; i--) {
                            const date = new Date(now);
                            date.setUTCDate(date.getUTCDate() - i);
                            const dateStr = utils.formatDateToYMD(date);
                            
                            labels.push(date.getUTCDate() + 'Êó•');
                            
                            let expense = 0;
                            let income = 0;
                            
                            bills.forEach(bill => {
                                if (bill.date === dateStr) {
                                    if (bill.type === 'expense') {
                                        expense += bill.amount;
                                    } else {
                                        income += bill.amount;
                                    }
                                }
                            });
                            
                            expenseData.push(expense);
                            incomeData.push(income);
                        }
                        break;
                        
                    case 'quarter':
                        // ÊúÄËøë3‰∏™Êúà
                        for (let i = 2; i >= 0; i--) {
                            const date = new Date(now);
                            date.setUTCMonth(date.getUTCMonth() - i);
                            const month = date.getUTCMonth() + 1;
                            
                            labels.push(month + 'Êúà');
                            
                            let expense = 0;
                            let income = 0;
                            const monthKey = utils.getMonthKey(date);
                            
                            bills.forEach(bill => {
                                const billDate = new Date(bill.date + 'T00:00:00Z');
                                if (utils.getMonthKey(billDate) === monthKey) {
                                    if (bill.type === 'expense') {
                                        expense += bill.amount;
                                    } else {
                                        income += bill.amount;
                                    }
                                }
                            });
                            
                            expenseData.push(expense);
                            incomeData.push(income);
                        }
                        break;
                        
                    case 'year':
                        // ÊúÄËøë12‰∏™Êúà
                        for (let i = 11; i >= 0; i--) {
                            const date = new Date(now);
                            date.setUTCMonth(date.getUTCMonth() - i);
                            const month = date.getUTCMonth() + 1;
                            
                            labels.push(month + 'Êúà');
                            
                            let expense = 0;
                            let income = 0;
                            const monthKey = utils.getMonthKey(date);
                            
                            bills.forEach(bill => {
                                const billDate = new Date(bill.date + 'T00:00:00Z');
                                if (utils.getMonthKey(billDate) === monthKey) {
                                    if (bill.type === 'expense') {
                                        expense += bill.amount;
                                    } else {
                                        income += bill.amount;
                                    }
                                }
                            });
                            
                            expenseData.push(expense);
                            incomeData.push(income);
                        }
                        break;
                        
                    case 'custom':
                        const startDate = document.getElementById('startDate').value;
                        const endDate = document.getElementById('endDate').value;
                        
                        if (!startDate || !endDate) {
                            // Â¶ÇÊûúÊ≤°ÊúâËá™ÂÆö‰πâÊó•ÊúüÔºåÊòæÁ§∫Êú¨ÊúàÊï∞ÊçÆ
                            this.updateTrendChart();
                            return;
                        }
                        
                        const start = new Date(startDate + 'T00:00:00Z');
                        const end = new Date(endDate + 'T00:00:00Z');
                        const daysDiff = Math.floor((end - start) / (1000 * 60 * 60 * 24));
                        
                        // Â¶ÇÊûúÊó∂Èó¥Ë∑®Â∫¶Â§™Â§ßÔºåÊåâÂë®ÊàñÊúàÂàÜÁªÑ
                        if (daysDiff > 90) {
                            // ÊåâÊúàÂàÜÁªÑ
                            const startMonth = start.getUTCMonth();
                            const endMonth = end.getUTCMonth();
                            const monthCount = (end.getUTCFullYear() - start.getUTCFullYear()) * 12 + (endMonth - startMonth) + 1;
                            
                            for (let i = 0; i < monthCount; i++) {
                                const date = new Date(start);
                                date.setUTCMonth(start.getUTCMonth() + i);
                                const month = date.getUTCMonth() + 1;
                                const year = date.getUTCFullYear();
                                
                                labels.push(`${year}Âπ¥${month}Êúà`);
                                
                                let expense = 0;
                                let income = 0;
                                const monthKey = utils.getMonthKey(date);
                                
                                bills.forEach(bill => {
                                    const billDate = new Date(bill.date + 'T00:00:00Z');
                                    if (utils.getMonthKey(billDate) === monthKey) {
                                        if (bill.type === 'expense') {
                                            expense += bill.amount;
                                        } else {
                                            income += bill.amount;
                                        }
                                    }
                                });
                                
                                expenseData.push(expense);
                                incomeData.push(income);
                            }
                        } else {
                            // ÊåâÂ§©ÂàÜÁªÑ
                            for (let i = 0; i <= daysDiff; i++) {
                                const date = new Date(start);
                                date.setUTCDate(start.getUTCDate() + i);
                                const dateStr = utils.formatDateToYMD(date);
                                
                                labels.push((date.getUTCMonth() + 1) + '/' + date.getUTCDate());
                                
                                let expense = 0;
                                let income = 0;
                                
                                bills.forEach(bill => {
                                    if (bill.date === dateStr) {
                                        if (bill.type === 'expense') {
                                            expense += bill.amount;
                                        } else {
                                            income += bill.amount;
                                        }
                                    }
                                });
                                
                                expenseData.push(expense);
                                incomeData.push(income);
                            }
                        }
                        break;
                }
                
                // Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ
                this.trendChart.data.labels = labels;
                this.trendChart.data.datasets[0].data = expenseData;
                this.trendChart.data.datasets[1].data = incomeData;
                this.trendChart.update();
            },
            
            // Êõ¥Êñ∞È•ºÂõæ
            updatePieChart: function() {
                const chartType = document.getElementById('pieChartType').value;
                const bills = dataManager.getBills();
                const categories = dataManager.getCategories();
                const period = document.getElementById('chartPeriod').value;
                
                // ËÆ°ÁÆóÊó∂Èó¥ËåÉÂõ¥
                const now = new Date();
                let startDate, endDate;
                
                switch(period) {
                    case 'month':
                        startDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), 1);
                        endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        break;
                    case 'quarter':
                        startDate = new Date(now.getUTCFullYear(), now.getUTCMonth() - 2, 1);
                        endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        break;
                    case 'year':
                        startDate = new Date(now.getUTCFullYear(), 0, 1);
                        endDate = new Date(now.getUTCFullYear(), 11, 31);
                        break;
                    case 'custom':
                        const startStr = document.getElementById('startDate').value;
                        const endStr = document.getElementById('endDate').value;
                        
                        if (!startStr || !endStr) {
                            // Â¶ÇÊûúÊ≤°ÊúâËá™ÂÆö‰πâÊó•ÊúüÔºåÊòæÁ§∫Êú¨ÊúàÊï∞ÊçÆ
                            startDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), 1);
                            endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        } else {
                            startDate = new Date(startStr + 'T00:00:00Z');
                            endDate = new Date(endStr + 'T23:59:59Z');
                        }
                        break;
                }
                
                // ÊåâÂàÜÁ±ªÁªüËÆ°ÈáëÈ¢ù
                const categoryStats = {};
                const categoryNames = {};
                
                categories.forEach(cat => {
                    if (cat.type === chartType || cat.type === 'both') {
                        categoryStats[cat.id] = 0;
                        categoryNames[cat.id] = cat.name;
                    }
                });
                
                bills.forEach(bill => {
                    if (bill.type === chartType) {
                        const billDate = new Date(bill.date + 'T00:00:00Z');
                        if (billDate >= startDate && billDate <= endDate) {
                            if (categoryStats[bill.category] !== undefined) {
                                categoryStats[bill.category] += bill.amount;
                            }
                        }
                    }
                });
                
                // ËøáÊª§ÊéâÈáëÈ¢ù‰∏∫0ÁöÑÂàÜÁ±ªÔºåÂπ∂ÊéíÂ∫è
                const sortedStats = Object.entries(categoryStats)
                    .filter(([_, amount]) => amount > 0)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10); // Âè™ÊòæÁ§∫Ââç10‰∏™ÂàÜÁ±ª
                
                // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
                const labels = sortedStats.map(([id, _]) => categoryNames[id]);
                const data = sortedStats.map(([_, amount]) => amount);
                
                // Êõ¥Êñ∞ÂõæË°®
                this.pieChart.data.labels = labels;
                this.pieChart.data.datasets[0].data = data;
                this.pieChart.update();
            },
            
            // Êõ¥Êñ∞È¢ÑÁÆóÂõæË°®
            updateBudgetChart: function() {
                const monthKey = utils.getCurrentMonthKey();
                const budgets = dataManager.getBudgets();
                const categories = dataManager.getCategories();
                const bills = dataManager.getBills();
                
                if (!budgets[monthKey]) {
                    // Ê≤°ÊúâÈ¢ÑÁÆóÊï∞ÊçÆÔºåÊòæÁ§∫Á©∫ÂõæË°®
                    this.budgetChart.data.labels = [];
                    this.budgetChart.data.datasets[0].data = [];
                    this.budgetChart.data.datasets[1].data = [];
                    this.budgetChart.update();
                    return;
                }
                
                // Ëé∑ÂèñÊúâÈ¢ÑÁÆóÁöÑÂàÜÁ±ª
                const budgetEntries = Object.entries(budgets[monthKey])
                    .filter(([_, amount]) => amount > 0);
                
                if (budgetEntries.length === 0) {
                    this.budgetChart.data.labels = [];
                    this.budgetChart.data.datasets[0].data = [];
                    this.budgetChart.data.datasets[1].data = [];
                    this.budgetChart.update();
                    return;
                }
                
                // ÂáÜÂ§áÊï∞ÊçÆ
                const labels = [];
                const budgetData = [];
                const actualData = [];
                
                budgetEntries.forEach(([categoryId, budgetAmount]) => {
                    const category = categories.find(cat => cat.id === categoryId);
                    if (!category) return;
                    
                    labels.push(category.name);
                    budgetData.push(budgetAmount);
                    
                    // ËÆ°ÁÆóÂÆûÈôÖÊîØÂá∫
                    let actual = 0;
                    bills.forEach(bill => {
                        const billDate = new Date(bill.date + 'T00:00:00Z');
                        if (utils.getMonthKey(billDate) === monthKey && 
                            bill.category === categoryId && 
                            bill.type === 'expense') {
                            actual += bill.amount;
                        }
                    });
                    
                    actualData.push(actual);
                });
                
                // Êõ¥Êñ∞ÂõæË°®
                this.budgetChart.data.labels = labels;
                this.budgetChart.data.datasets[0].data = budgetData;
                this.budgetChart.data.datasets[1].data = actualData;
                this.budgetChart.update();
            },
            
            // ÂàáÊç¢È¢ÑÁÆóÂõæË°®Á±ªÂûã
            toggleBudgetChartType: function() {
                if (this.budgetChartType === 'bar') {
                    this.budgetChartType = 'radar';
                    this.budgetChart.config.type = 'radar';
                } else {
                    this.budgetChartType = 'bar';
                    this.budgetChart.config.type = 'bar';
                }
                
                this.budgetChart.update();
            },
            
            // Â∫îÁî®Ëá™ÂÆö‰πâÊó•ÊúüËåÉÂõ¥
            applyCustomRange: function() {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (!startDate || !endDate) {
                    alert('ËØ∑ÈÄâÊã©ÂºÄÂßãÊó•ÊúüÂíåÁªìÊùüÊó•Êúü');
                    return;
                }
                
                const start = new Date(startDate + 'T00:00:00Z');
                const end = new Date(endDate + 'T00:00:00Z');
                
                if (start > end) {
                    alert('ÂºÄÂßãÊó•Êúü‰∏çËÉΩÊôö‰∫éÁªìÊùüÊó•Êúü');
                    return;
                }
                
                this.updateCharts();
            },
            
            // Êõ¥Êñ∞ÁªüËÆ°ÊëòË¶Å
            updateStatsSummary: function() {
                const bills = dataManager.getBills();
                const period = document.getElementById('chartPeriod').value;
                const now = new Date();
                
                let startDate, endDate;
                
                switch(period) {
                    case 'month':
                        startDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), 1);
                        endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        break;
                    case 'quarter':
                        startDate = new Date(now.getUTCFullYear(), now.getUTCMonth() - 2, 1);
                        endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        break;
                    case 'year':
                        startDate = new Date(now.getUTCFullYear(), 0, 1);
                        endDate = new Date(now.getUTCFullYear(), 11, 31);
                        break;
                    case 'custom':
                        const startStr = document.getElementById('startDate').value;
                        const endStr = document.getElementById('endDate').value;
                        
                        if (!startStr || !endStr) {
                            // Â¶ÇÊûúÊ≤°ÊúâËá™ÂÆö‰πâÊó•ÊúüÔºåÊòæÁ§∫Êú¨ÊúàÊï∞ÊçÆ
                            startDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), 1);
                            endDate = new Date(now.getUTCFullYear(), now.getUTCMonth() + 1, 0);
                        } else {
                            startDate = new Date(startStr + 'T00:00:00Z');
                            endDate = new Date(endStr + 'T23:59:59Z');
                        }
                        break;
                }
                
                // Á≠õÈÄâÊó∂Èó¥ÊÆµÂÜÖÁöÑË¥¶Âçï
                const periodBills = bills.filter(bill => {
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    return billDate >= startDate && billDate <= endDate;
                });
                
                // ËÆ°ÁÆóÊúÄÂ§ßÊîØÂá∫
                let maxExpense = 0;
                let maxExpenseDetail = '';
                
                periodBills.forEach(bill => {
                    if (bill.type === 'expense' && bill.amount > maxExpense) {
                        maxExpense = bill.amount;
                        const category = dataManager.getCategories().find(cat => cat.id === bill.category);
                        maxExpenseDetail = category ? category.name : 'Êú™Áü•';
                    }
                });
                
                document.getElementById('maxExpense').textContent = utils.formatAmount(maxExpense);
                document.getElementById('maxExpenseDetail').textContent = maxExpense > 0 ? maxExpenseDetail : 'Êó†ËÆ∞ÂΩï';
                
                // ËÆ°ÁÆóÂπ≥ÂùáÊØèÊó•ÊîØÂá∫
                const expenseBills = periodBills.filter(bill => bill.type === 'expense');
                const totalExpense = expenseBills.reduce((sum, bill) => sum + bill.amount, 0);
                const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                const avgDailyExpense = daysDiff > 0 ? totalExpense / daysDiff : 0;
                
                document.getElementById('avgDailyExpense').textContent = utils.formatAmount(avgDailyExpense);
                
                // ËÆ°ÁÆóÊîØÂá∫ÂèòÂåñ
                const prevPeriodBills = this.getPreviousPeriodBills(period, startDate);
                const prevExpense = prevPeriodBills
                    .filter(bill => bill.type === 'expense')
                    .reduce((sum, bill) => sum + bill.amount, 0);
                
                const expenseChange = prevExpense > 0 ? 
                    ((totalExpense - prevExpense) / prevExpense * 100).toFixed(1) : 0;
                
                document.getElementById('expenseChange').textContent = 
                    `${expenseChange >= 0 ? '+' : ''}${expenseChange}%`;
                document.getElementById('expenseChange').style.color = 
                    expenseChange >= 0 ? '#FF3B30' : '#34C759';
                
                // ËÆ°ÁÆóÈ¢ÑÁÆóÂÆåÊàêÁéá
                const monthKey = utils.getCurrentMonthKey();
                const budgets = dataManager.getBudgets();
                let budgetCompletion = 0;
                let budgetStatus = 'Êú™ËÆæÁΩÆ';
                
                if (budgets[monthKey]) {
                    const totalBudget = Object.values(budgets[monthKey])
                        .filter(amount => amount > 0)
                        .reduce((sum, amount) => sum + amount, 0);
                    
                    if (totalBudget > 0) {
                        budgetCompletion = utils.calculatePercentage(totalExpense, totalBudget);
                        budgetStatus = budgetCompletion >= 100 ? 'Â∑≤Ë∂ÖÊîØ' : 'ËøõË°å‰∏≠';
                    }
                }
                
                document.getElementById('budgetCompletion').textContent = `${budgetCompletion}%`;
                document.getElementById('budgetStatus').textContent = budgetStatus;
                document.getElementById('budgetCompletion').style.color = 
                    utils.getPercentageColor(budgetCompletion);
            },
            
            // Ëé∑Âèñ‰∏ä‰∏Ä‰∏™Êó∂Èó¥ÊÆµÁöÑË¥¶Âçï
            getPreviousPeriodBills: function(period, currentStartDate) {
                const bills = dataManager.getBills();
                let prevStartDate, prevEndDate;
                
                switch(period) {
                    case 'month':
                        prevStartDate = new Date(currentStartDate);
                        prevStartDate.setUTCMonth(prevStartDate.getUTCMonth() - 1);
                        prevEndDate = new Date(prevStartDate);
                        prevEndDate.setUTCMonth(prevEndDate.getUTCMonth() + 1);
                        prevEndDate.setUTCDate(prevEndDate.getUTCDate() - 1);
                        break;
                    case 'quarter':
                        prevStartDate = new Date(currentStartDate);
                        prevStartDate.setUTCMonth(prevStartDate.getUTCMonth() - 3);
                        prevEndDate = new Date(currentStartDate);
                        prevEndDate.setUTCDate(prevEndDate.getUTCDate() - 1);
                        break;
                    case 'year':
                        prevStartDate = new Date(currentStartDate);
                        prevStartDate.setUTCFullYear(prevStartDate.getUTCFullYear() - 1);
                        prevEndDate = new Date(prevStartDate);
                        prevEndDate.setUTCFullYear(prevEndDate.getUTCFullYear() + 1);
                        prevEndDate.setUTCDate(prevEndDate.getUTCDate() - 1);
                        break;
                    case 'custom':
                        // ÂØπ‰∫éËá™ÂÆö‰πâËåÉÂõ¥Ôºå‰ΩøÁî®Áõ∏ÂêåÈïøÂ∫¶ÁöÑ‰∏ä‰∏Ä‰∏™Êó∂Èó¥ÊÆµ
                        const endDate = document.getElementById('endDate').value;
                        if (!endDate) return [];
                        
                        const currentEndDate = new Date(endDate + 'T00:00:00Z');
                        const daysDiff = Math.ceil((currentEndDate - currentStartDate) / (1000 * 60 * 60 * 24));
                        
                        prevEndDate = new Date(currentStartDate);
                        prevEndDate.setUTCDate(prevEndDate.getUTCDate() - 1);
                        prevStartDate = new Date(prevEndDate);
                        prevStartDate.setUTCDate(prevStartDate.getUTCDate() - daysDiff);
                        break;
                }
                
                return bills.filter(bill => {
                    const billDate = new Date(bill.date + 'T00:00:00Z');
                    return billDate >= prevStartDate && billDate <= prevEndDate;
                });
            }
        };

        // ÂØºÂá∫ÂØºÂÖ•Ê®°Âùó
        const exportImport = {
            // ÊâìÂºÄÂØºÂá∫ÂºπÁ™ó
            openExportModal: function() {
                document.getElementById('exportModal').classList.add('show');
                this.updateExportStats();
                
                // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüËåÉÂõ¥ÔºàÊúÄËøë‰∏Ä‰∏™ÊúàÔºâ
                const today = new Date();
                const lastMonth = new Date(today);
                lastMonth.setUTCMonth(lastMonth.getUTCMonth() - 1);
                
                document.getElementById('exportStartDate').value = utils.formatDateToYMD(lastMonth);
                document.getElementById('exportEndDate').value = utils.formatDateToYMD(today);
                
                // ÁõëÂê¨Êñá‰ª∂ÈÄâÊã©
                document.getElementById('importFile').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('fileInfo').textContent = 
                            `${file.name} (${utils.getFileSize(file.size)})`;
                    } else {
                        document.getElementById('fileInfo').textContent = 'Êú™ÈÄâÊã©Êñá‰ª∂';
                    }
                });
            },
            
            // ÂÖ≥Èó≠ÂØºÂá∫ÂºπÁ™ó
            closeExportModal: function() {
                document.getElementById('exportModal').classList.remove('show');
            },
            
            // Êõ¥Êñ∞ÂØºÂá∫ÁªüËÆ°
            updateExportStats: function() {
                const bills = dataManager.getBills();
                const categories = dataManager.getCategories();
                const dataSize = dataManager.getDataSize();
                const backupInfo = dataManager.getBackupInfo();
                
                document.getElementById('exportBillCount').textContent = bills.length;
                document.getElementById('exportCategoryCount').textContent = categories.length;
                document.getElementById('exportDataSize').textContent = utils.getFileSize(dataSize);
                
                if (backupInfo.lastBackup) {
                    const lastBackup = new Date(backupInfo.lastBackup);
                    document.getElementById('exportLastBackup').textContent = 
                        lastBackup.toLocaleDateString('zh-CN');
                } else {
                    document.getElementById('exportLastBackup').textContent = '‰ªéÊú™Â§á‰ªΩ';
                }
            },
            
            // ÂØºÂá∫Êï∞ÊçÆ
            exportData: function() {
                const format = document.querySelector('input[name="exportFormat"]:checked').value;
                const startDate = document.getElementById('exportStartDate').value;
                const endDate = document.getElementById('exportEndDate').value;
                
                // È™åËØÅÊó•ÊúüËåÉÂõ¥
                if (startDate && endDate) {
                    const start = new Date(startDate + 'T00:00:00Z');
                    const end = new Date(endDate + 'T00:00:00Z');
                    
                    if (start > end) {
                        alert('ÂºÄÂßãÊó•Êúü‰∏çËÉΩÊôö‰∫éÁªìÊùüÊó•Êúü');
                        return;
                    }
                }
                
                const data = dataManager.exportData(format, startDate, endDate);
                const filename = `ËÆ∞Ë¥¶Êï∞ÊçÆ_${new Date().toISOString().split('T')[0]}.${format}`;
                
                // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                const blob = new Blob([data], { 
                    type: format === 'json' ? 'application/json' : 'text/csv' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Êõ¥Êñ∞Â§á‰ªΩ‰ø°ÊÅØ
                dataManager.updateBackupInfo();
                this.updateExportStats();
                
                app.showNotification('Êï∞ÊçÆÂØºÂá∫ÊàêÂäü', 'success');
            },
            
            // ÂØºÂÖ•Êï∞ÊçÆ
            importData: function() {
                const fileInput = document.getElementById('importFile');
                const action = document.querySelector('input[name="importAction"]:checked').value;
                
                if (!fileInput.files || fileInput.files.length === 0) {
                    alert('ËØ∑ÈÄâÊã©Ë¶ÅÂØºÂÖ•ÁöÑÊñá‰ª∂');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const content = e.target.result;
                    let success = false;
                    
                    // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãÂ§ÑÁêÜ
                    if (file.name.endsWith('.json')) {
                        success = dataManager.importData(content, action);
                    } else if (file.name.endsWith('.csv')) {
                        success = dataManager.importCSV(content);
                    } else {
                        alert('‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Ê†ºÂºèÔºåËØ∑ÈÄâÊã©JSONÊàñCSVÊñá‰ª∂');
                        return;
                    }
                    
                    if (success) {
                        // Êõ¥Êñ∞ÊâÄÊúâÊòæÁ§∫
                        if (typeof app !== 'undefined') {
                            app.initHomePage();
                        }
                        
                        if (typeof bill !== 'undefined') {
                            bill.renderBillList();
                        }
                        
                        if (typeof budget !== 'undefined') {
                            budget.renderBudgetList();
                        }
                        
                        if (typeof calendar !== 'undefined') {
                            calendar.renderMiniCalendar();
                        }
                        
                        this.updateExportStats();
                        this.closeExportModal();
                        
                        app.showNotification('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäü', 'success');
                    } else {
                        alert('Êï∞ÊçÆÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºèÊòØÂê¶Ê≠£Á°Æ');
                    }
                };
                
                reader.onerror = () => {
                    alert('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•');
                };
                
                reader.readAsText(file);
            },
            
            // ÊâìÂç∞ÊëòË¶Å
            printSummary: function() {
                const stats = dataManager.getStats();
                const bills = dataManager.getBills();
                const categories = dataManager.getCategories();
                
                const now = new Date();
                const todayStr = now.toLocaleDateString('zh-CN');
                
                // ÂàõÂª∫ÊâìÂç∞ÂÜÖÂÆπ
                const printContent = `
                    <html>
                    <head>
                        <title>ËÆ∞Ë¥¶Êï∞ÊçÆÊëòË¶Å - ${todayStr}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #333; }
                            .section { margin-bottom: 30px; }
                            .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
                            .stat-item { background: #f5f5f5; padding: 15px; border-radius: 8px; text-align: center; }
                            .stat-label { font-size: 14px; color: #666; }
                            .stat-value { font-size: 24px; font-weight: bold; margin: 5px 0; }
                            table { width: 100%; border-collapse: collapse; }
                            th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                            th { background: #f5f5f5; }
                        </style>
                    </head>
                    <body>
                        <h1>ËÆ∞Ë¥¶Êï∞ÊçÆÊëòË¶Å</h1>
                        <div>ÁîüÊàêÊó∂Èó¥: ${todayStr}</div>
                        
                        <div class="section">
                            <h2>ÊúàÂ∫¶ÁªüËÆ°</h2>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-label">Êú¨ÊúàÊîØÂá∫</div>
                                    <div class="stat-value" style="color: #FF3B30">¬•${stats.monthExpense.toFixed(2)}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Êú¨ÊúàÊî∂ÂÖ•</div>
                                    <div class="stat-value" style="color: #34C759">¬•${stats.monthIncome.toFixed(2)}</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Ë¥¶Êà∑Áªì‰Ωô</div>
                                    <div class="stat-value" style="color: #007AFF">¬•${stats.monthBalance.toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <h2>Êï∞ÊçÆÊ¶ÇËßà</h2>
                            <table>
                                <tr>
                                    <th>È°πÁõÆ</th>
                                    <th>Êï∞Èáè</th>
                                </tr>
                                <tr>
                                    <td>Ë¥¶ÂçïÊÄªÊï∞</td>
                                    <td>${bills.length}</td>
                                </tr>
                                <tr>
                                    <td>ÂàÜÁ±ªÊï∞Èáè</td>
                                    <td>${categories.length}</td>
                                </tr>
                                <tr>
                                    <td>Êï∞ÊçÆÁîüÊàêÊó∂Èó¥</td>
                                    <td>${todayStr}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="section">
                            <h2>ÊúÄËøë5Á¨îË¥¶Âçï</h2>
                            <table>
                                <tr>
                                    <th>Êó•Êúü</th>
                                    <th>ÂàÜÁ±ª</th>
                                    <th>Á±ªÂûã</th>
                                    <th>ÈáëÈ¢ù</th>
                                </tr>
                                ${bills.slice(0, 5).map(bill => {
                                    const category = categories.find(cat => cat.id === bill.category);
                                    const categoryName = category ? category.name : 'Êú™Áü•';
                                    return `
                                        <tr>
                                            <td>${bill.date}</td>
                                            <td>${categoryName}</td>
                                            <td>${bill.type === 'expense' ? 'ÊîØÂá∫' : 'Êî∂ÂÖ•'}</td>
                                            <td style="color: ${bill.type === 'expense' ? '#FF3B30' : '#34C759'}">
                                                ${bill.type === 'expense' ? '-' : '+'}¬•${bill.amount.toFixed(2)}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </table>
                        </div>
                    </body>
                    </html>
                `;
                
                // ÊâìÂºÄÊâìÂç∞Á™óÂè£
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.focus();
                
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            }
        };

        // ÂÖ®Â±ÄÂáΩÊï∞ÔºàÁî®‰∫éHTML‰∫ã‰ª∂Â§ÑÁêÜÔºâ
        function nextInput(input) {
            auth.nextInput(input);
        }
        
        function isNumberKey(evt) {
            return auth.isNumberKey(evt);
        }
        
        function checkPassword() {
            auth.checkPassword();
        }
        
        function closeAlert() {
            auth.closeAlert();
        }
        
        function lockApp() {
            auth.lockApp();
        }
        
        function showPage(pageId) {
            app.showPage(pageId);
        }
        
        function prevMonth() {
            app.prevMonth();
        }
        
        function nextMonth() {
            app.nextMonth();
        }
        
        function openBillModal() {
            bill.openBillModal();
        }
        
        function closeBillModal() {
            bill.closeBillModal();
        }
        
        function setType(type) {
            bill.setType(type);
        }
        
        function validateAmount(input) {
            return bill.validateAmount(input);
        }
        
        function updateDateDisplay() {
            bill.updateDateDisplay();
        }
        
        function saveBill() {
            bill.saveBill();
        }
        
        function filterBills() {
            bill.filterBills();
        }
        
        function openCalendarModal() {
            calendar.openCalendarModal();
        }
        
        function closeCalendarModal() {
            calendar.closeCalendarModal();
        }
        
        function changeMonth(direction) {
            calendar.changeMonth(direction);
        }
        
        function jumpToToday() {
            calendar.jumpToToday();
        }
        
        function openBudgetModal() {
            budget.openBudgetModal();
        }
        
        function closeBudgetModal() {
            budget.closeBudgetModal();
        }
        
        function changeBudgetPeriod() {
            budget.changeBudgetPeriod();
        }
        
        function updateCategoryBudgets() {
            budget.updateCategoryBudgets();
        }
        
        function distributeEvenly() {
            budget.distributeEvenly();
        }
        
        function clearAllBudgets() {
            budget.clearAllBudgets();
        }
        
        function saveBudgets() {
            budget.saveBudgets();
        }
        
        function resetBudgets() {
            budget.resetBudgets();
        }
        
        function openCategoryModal() {
            category.openCategoryModal();
        }
        
        function closeCategoryModal() {
            category.closeCategoryModal();
        }
        
        function openAddCateModal() {
            category.openAddCateModal();
        }
        
        function closeAddCateModal() {
            category.closeAddCateModal();
        }
        
        function saveNewCategory() {
            category.saveNewCategory();
        }
        
        function updateCharts() {
            charts.updateCharts();
        }
        
        function toggleBudgetChartType() {
            charts.toggleBudgetChartType();
        }
        
        function applyCustomRange() {
            charts.applyCustomRange();
        }
        
        function openExportModal() {
            exportImport.openExportModal();
        }
        
        function closeExportModal() {
            exportImport.closeExportModal();
        }
        
        function exportData() {
            exportImport.exportData();
        }
        
        function importData() {
            exportImport.importData();
        }
        
        function printSummary() {
            exportImport.printSummary();
        }
        
        function hideConfirmModal() {
            utils.hideConfirmModal();
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÂØÜÁ†ÅËæìÂÖ•
            auth.initPasswordInput();
            
            // ÂàùÂßãÂåñÂ∫îÁî®
            app.init();
            
            // ÂàùÂßãÂåñÂõæË°®
            setTimeout(() => {
                charts.initCharts();
            }, 1000);
            
            // ÁõëÂê¨Ëá™ÂÆö‰πâÊó•ÊúüËåÉÂõ¥ÈÄâÊã©
            document.getElementById('chartPeriod').addEventListener('change', function() {
                const customRange = document.getElementById('customRange');
                if (this.value === 'custom') {
                    customRange.style.display = 'flex';
                } else {
                    customRange.style.display = 'none';
                    charts.updateCharts();
                }
            });
        });
    </script>
</body>
</html>
