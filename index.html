<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <!-- æ ¸å¿ƒï¼šæ‰‹æœºç«¯é€‚é…ï¼ˆç¦æ­¢ç¼©æ”¾ã€é€‚é…è§†ç½‘è†œå±ï¼‰ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <title>å¦ä¸€ä¸ªæˆ‘</title>
    <style>
        /* å…¨å±€é‡ç½®ï¼ˆæ‰‹æœºç«¯ä¸“å±ï¼‰ */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            /* ç¦æ­¢æ–‡å­—é€‰ä¸­ï¼Œä¼˜åŒ–è§¦æ‘¸ä½“éªŒ */
            -webkit-user-select: none;
            user-select: none;
        }
        body { 
            background: #F2F2F7; 
            padding-bottom: 90px; /* ç»™åº•éƒ¨+å·ç•™æ›´å¤šç©ºé—´ */
            font-size: 16px; /* æ‰‹æœºé»˜è®¤å­—ä½“å¤§å° */
        }

        /* å¯†ç é”ï¼ˆæ‰‹æœºç«¯å±…ä¸­ä¼˜åŒ–ï¼‰ */
        .lock-screen {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: #F2F2F7; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 0 20px;
        }
        .lock-title {
            font-size: 20px; color: #1C1C1E; margin-bottom: 30px;
        }
        .password-inputs { 
            display: flex; gap: 15px; margin-bottom: 20px;
            width: 100%; max-width: 300px; /* é™åˆ¶å®½åº¦ï¼Œé€‚é…å°å±æ‰‹æœº */
        }
        .password-input {
            width: 20%; height: 50px; 
            border: 2px solid #E5E5EA; border-radius: 12px;
            text-align: center; font-size: 28px;
            background: #fff;
            /* å»æ‰è¾“å…¥æ¡†é»˜è®¤æ ·å¼ */
            -webkit-appearance: none;
            appearance: none;
        }
        .password-input:focus {
            border-color: #1C1C1E; outline: none;
        }

        /* ä¸»é¡µé¢æ ‡é¢˜ï¼ˆæ‰‹æœºç«¯paddingä¼˜åŒ–ï¼‰ */
        .main-title {
            padding: 20px 16px;
            font-size: 24px; font-weight: 600;
            color: #1C1C1E;
        }

        /* åº•éƒ¨+å·æŒ‰é’®ï¼ˆæ‰‹æœºè§¦æ‘¸ä¼˜åŒ–ï¼‰ */
        .add-btn {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: #1C1C1E; color: #fff; font-size: 36px;
            border: none; cursor: pointer;
            /* è§¦æ‘¸åé¦ˆ */
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
        }

        /* è®°è´¦å¼¹çª—ï¼ˆæ‰‹æœºç«¯å…¨å±åº•éƒ¨å¼¹çª—ï¼‰ */
        .modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            z-index: 100;
        }
        .modal.show { display: block; }
        .modal-content {
            position: fixed; bottom:0; left:0; right:0;
            background: #fff; border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px 16px;
            /* é€‚é…é”®ç›˜å¼¹å‡º */
            max-height: 90vh; overflow-y: auto;
        }
        .modal-title {
            font-size: 20px; font-weight: 600;
            margin-bottom: 20px; text-align: center;
        }

        /* é‡‘é¢è¾“å…¥æ¡†ï¼ˆæ‰‹æœºç«¯è§¦æ‘¸ä¼˜åŒ–ï¼‰ */
        .amount-input {
            width: 100%; font-size: 32px; text-align: center;
            margin: 10px 0 20px; padding: 10px 0;
            border: none; border-bottom: 1px solid #E5E5EA;
            /* å»æ‰é»˜è®¤æ ·å¼ */
            -webkit-appearance: none;
            appearance: none;
        }
        .amount-input:focus { outline: none; border-bottom-color: #1C1C1E; }

        /* æ”¶æ”¯ç±»å‹æŒ‰é’®ï¼ˆæ‰‹æœºç«¯å¹³åˆ†å®½åº¦ï¼‰ */
        .type-toggle {
            display: flex; gap: 10px; margin: 10px 0 20px;
        }
        .type-btn {
            flex: 1; padding: 12px 0;
            border-radius: 20px; border: 2px solid #E5E5EA;
            background: transparent; font-size: 16px;
            -webkit-tap-highlight-color: transparent;
        }
        .type-btn.active {
            border-color: #1C1C1E; background: #1C1C1E; color: #fff;
        }

        /* åˆ†ç±»åŒºåŸŸï¼ˆæ‰‹æœºç«¯4åˆ—é€‚é…ï¼‰ */
        .category-label {
            font-size: 14px; color: #8E8E93;
            margin-bottom: 10px;
        }
        .category-grid {
            display: grid; 
            grid-template-columns: repeat(4, 1fr); /* å›ºå®š4åˆ—ï¼Œé€‚é…æ‰‹æœº */
            gap: 12px; margin: 10px 0 20px;
        }
        .category-item {
            display: flex; flex-direction: column;
            align-items: center;
            /* æ‰‹æœºè§¦æ‘¸ä¼˜åŒ– */
            -webkit-tap-highlight-color: transparent;
        }
        .category-icon {
            width: 50px; height: 50px; 
            background: #F2F2F7; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; margin-bottom: 6px;
        }
        .category-item.active .category-icon {
            background: #1C1C1E; color: #fff;
        }
        .category-name {
            font-size: 12px; color: #8E8E93;
        }
        .category-item.active .category-name {
            color: #1C1C1E; font-weight: 500;
        }

        /* æ–°å¢åˆ†ç±»æŒ‰é’®ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ */
        .add-cate-btn {
            width: 100%; padding: 12px;
            border: 1px dashed #E5E5EA; border-radius: 12px;
            background: #F9F9F9; font-size: 16px;
            color: #8E8E93; margin: 10px 0 20px;
            -webkit-tap-highlight-color: transparent;
        }

        /* ä¿å­˜/å…³é—­æŒ‰é’®ï¼ˆæ‰‹æœºç«¯å…¨å±å®½åº¦ï¼‰ */
        .modal-btn {
            width: 100%; padding: 14px 0;
            border-radius: 12px; border: none;
            font-size: 16px; font-weight: 500;
            margin-bottom: 10px;
            -webkit-tap-highlight-color: transparent;
        }
        .save-btn { background: #1C1C1E; color: #fff; }
        .close-btn { background: #F2F2F7; color: #1C1C1E; }

        /* æ–°å¢åˆ†ç±»å¼¹çª—ï¼ˆæ‰‹æœºç«¯å±…ä¸­ï¼‰ */
        .add-cate-modal {
            position: fixed; top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5); display: none;
            align-items: center; justify-content: center;
            z-index: 200;
            padding: 0 20px;
        }
        .add-cate-modal.show { display: flex; }
        .add-cate-content {
            background: #fff; padding: 24px;
            border-radius: 20px; width: 100%; max-width: 300px;
        }
        .add-cate-title {
            font-size: 18px; font-weight: 600;
            margin-bottom: 15px; text-align: center;
        }
        .add-cate-input {
            width: 100%; padding: 12px;
            border: 1px solid #E5E5EA; border-radius: 12px;
            font-size: 16px; margin-bottom: 15px;
            -webkit-appearance: none;
            appearance: none;
        }
        .add-cate-input:focus { outline: none; border-color: #1C1C1E; }
        .add-cate-btn-group {
            display: flex; gap: 10px;
        }
        .add-cate-submit {
            flex: 1; padding: 12px;
            border-radius: 12px; border: none;
            background: #1C1C1E; color: #fff;
            font-size: 16px;
        }
        .add-cate-cancel {
            flex: 1; padding: 12px;
            border-radius: 12px; border: 1px solid #E5E5EA;
            background: transparent; font-size: 16px;
        }

        /* é•¿æŒ‰æç¤ºï¼ˆå¯é€‰ï¼Œæç¤ºç”¨æˆ·é•¿æŒ‰åˆ é™¤ï¼‰ */
        .longpress-tip {
            font-size: 12px; color: #8E8E93;
            text-align: center; margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- å¯†ç é”é¡µé¢ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-title">è¯·è¾“å…¥å¯†ç ï¼ˆ1234ï¼‰</div>
        <div class="password-inputs">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)">
            <input type="password" class="password-input" maxlength="1" oninput="nextInput(this)">
            <input type="password" class="password-input" maxlength="1" oninput="checkPassword()">
        </div>
    </div>

    <!-- ä¸»é¡µé¢ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ -->
    <div id="mainPage" style="display: none;">
        <div class="main-title">å¦ä¸€ä¸ªæˆ‘</div>
        <button class="add-btn" onclick="openBillModal()">+</button>

        <!-- è®°è´¦å¼¹çª— -->
        <div class="modal" id="billModal">
            <div class="modal-content">
                <div class="modal-title">è®°ä¸€ç¬”</div>
                <input type="number" class="amount-input" id="billAmount" placeholder="0.00" min="0.01" step="0.01">
                <div class="type-toggle">
                    <button class="type-btn active" onclick="setType('expense')">æ”¯å‡º</button>
                    <button class="type-btn" onclick="setType('income')">æ”¶å…¥</button>
                </div>
                
                <!-- åˆ†ç±»åŒºåŸŸï¼ˆæ–°å¢é•¿æŒ‰æç¤ºï¼‰ -->
                <div class="category-label">åˆ†ç±»ï¼ˆé•¿æŒ‰åˆ é™¤ï¼‰</div>
                <div class="longpress-tip">é•¿æŒ‰åˆ†ç±»å¯åˆ é™¤</div>
                <div class="category-grid" id="categoryGrid"></div>
                
                <button class="add-cate-btn" onclick="openAddCateModal()">+ æ–°å¢åˆ†ç±»</button>
                
                <button class="modal-btn save-btn" onclick="saveBill()">ä¿å­˜</button>
                <button class="modal-btn close-btn" onclick="closeBillModal()">å…³é—­</button>
            </div>
        </div>

        <!-- æ–°å¢åˆ†ç±»å¼¹çª— -->
        <div class="add-cate-modal" id="addCateModal">
            <div class="add-cate-content">
                <div class="add-cate-title">æ–°å¢åˆ†ç±»</div>
                <input type="text" class="add-cate-input" id="newCateInput" placeholder="æ¯”å¦‚ï¼šå¥¶èŒ¶ã€è¯è´¹">
                <div class="add-cate-btn-group">
                    <button class="add-cate-submit" onclick="saveNewCate()">ç¡®è®¤</button>
                    <button class="add-cate-cancel" onclick="closeAddCateModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼ˆé€‚é…æ‰‹æœºç«¯ï¼‰
        let password = '1234'; // é»˜è®¤å¯†ç 
        let currentType = 'expense'; // é»˜è®¤æ”¯å‡º
        let selectedCate = ''; // é€‰ä¸­çš„åˆ†ç±»
        let longPressTimer = null; // é•¿æŒ‰è®¡æ—¶å™¨
        // åˆ†ç±»æ•°æ®ï¼ˆæœ¬åœ°å­˜å‚¨ï¼Œæ°¸ä¹…ä¿å­˜ï¼‰
        let categories = JSON.parse(localStorage.getItem('phoneCates')) || [
            'é¤é¥®ğŸœ', 'äº¤é€šğŸšŒ', 'å¨±ä¹ğŸ¬', 'å­¦ä¹ ğŸ“š',
            'è´­ç‰©ğŸ›ï¸', 'æˆ¿ç§ŸğŸ ', 'å·¥èµ„ğŸ’¼', 'å…¶ä»–ğŸ”§'
        ];

        // ========== å¯†ç é”åŠŸèƒ½ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ ==========
        function nextInput(input) {
            const inputs = document.querySelectorAll('.password-input');
            const index = Array.from(inputs).indexOf(input);
            if (input.value && index < 3) {
                inputs[index + 1].focus();
            }
        }
        function checkPassword() {
            const inputs = document.querySelectorAll('.password-input');
            const inputPwd = Array.from(inputs).map(i => i.value).join('');
            
            if (inputPwd.length === 4) {
                if (inputPwd === password) {
                    document.getElementById('lockScreen').style.display = 'none';
                    document.getElementById('mainPage').style.display = 'block';
                } else {
                    alert('å¯†ç é”™è¯¯ï¼è¯·è¾“å…¥1234');
                    inputs.forEach(i => i.value = '');
                    inputs[0].focus();
                }
            }
        }

        // ========== è®°è´¦å¼¹çª—åŠŸèƒ½ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ ==========
        function openBillModal() {
            renderCategories(); // æ¸²æŸ“åˆ†ç±»
            document.getElementById('billModal').classList.add('show');
            // æ‰‹æœºç«¯è‡ªåŠ¨èšç„¦é‡‘é¢è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('billAmount').focus();
            }, 300);
        }
        function closeBillModal() {
            document.getElementById('billModal').classList.remove('show');
            document.getElementById('billAmount').value = ''; // æ¸…ç©ºé‡‘é¢
        }

        // ========== åˆ†ç±»æ ¸å¿ƒåŠŸèƒ½ï¼ˆé•¿æŒ‰åˆ é™¤+æ‰‹æœºé€‚é…ï¼‰ ==========
        // æ¸²æŸ“åˆ†ç±»ï¼ˆæ·»åŠ é•¿æŒ‰äº‹ä»¶ï¼‰
        function renderCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = ''; // æ¸…ç©ºåŸæœ‰åˆ†ç±»
            
            categories.forEach((cate, index) => {
                const cateItem = document.createElement('div');
                cateItem.className = 'category-item';
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
                if (index === 0) cateItem.classList.add('active');
                
                // åˆ†ç±»HTMLç»“æ„ï¼ˆæ‹†åˆ†åç§°å’Œemojiï¼Œä¼˜åŒ–æ˜¾ç¤ºï¼‰
                cateItem.innerHTML = `
                    <div class="category-icon">${cate}</div>
                    <div class="category-name">${cate.replace(/[^\u4e00-\u9fa5]/g, '')}</div>
                `;

                // ========== æ ¸å¿ƒï¼šé•¿æŒ‰åˆ é™¤ï¼ˆæ‰‹æœºç«¯ä¸“å±ï¼‰ ==========
                // è§¦æ‘¸å¼€å§‹ï¼ˆé•¿æŒ‰è®¡æ—¶ï¼‰
                cateItem.addEventListener('touchstart', () => {
                    longPressTimer = setTimeout(() => {
                        // é•¿æŒ‰500msè§¦å‘åˆ é™¤ç¡®è®¤
                        if (confirm(`ç¡®å®šåˆ é™¤ã€Œ${cate}ã€åˆ†ç±»å—ï¼Ÿ`)) {
                            if (categories.length <= 1) {
                                alert('è‡³å°‘ä¿ç•™1ä¸ªåˆ†ç±»å“¦ï½');
                                return;
                            }
                            // åˆ é™¤åˆ†ç±»å¹¶é‡æ–°æ¸²æŸ“
                            categories.splice(index, 1);
                            renderCategories();
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('phoneCates', JSON.stringify(categories));
                            alert(`å·²åˆ é™¤ã€Œ${cate}ã€åˆ†ç±»`);
                        }
                    }, 500); // é•¿æŒ‰500msè§¦å‘ï¼Œå¯è°ƒæ•´
                });

                // è§¦æ‘¸ç»“æŸ/ç¦»å¼€ï¼ˆå–æ¶ˆé•¿æŒ‰è®¡æ—¶ï¼‰
                cateItem.addEventListener('touchend', () => {
                    clearTimeout(longPressTimer);
                });
                cateItem.addEventListener('touchmove', () => {
                    clearTimeout(longPressTimer);
                });

                // ç‚¹å‡»åˆ†ç±»é€‰ä¸­ï¼ˆæ‰‹æœºç«¯è§¦æ‘¸ï¼‰
                cateItem.addEventListener('click', () => {
                    document.querySelectorAll('.category-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    cateItem.classList.add('active');
                    selectedCate = cate;
                });

                grid.appendChild(cateItem);
            });

            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
            selectedCate = categories[0];
            // ä¿å­˜åˆ†ç±»åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('phoneCates', JSON.stringify(categories));
        }

        // ========== æ–°å¢åˆ†ç±»åŠŸèƒ½ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ ==========
        function openAddCateModal() {
            document.getElementById('addCateModal').classList.add('show');
            document.getElementById('newCateInput').focus();
        }
        function closeAddCateModal() {
            document.getElementById('addCateModal').classList.remove('show');
            document.getElementById('newCateInput').value = ''; // æ¸…ç©ºè¾“å…¥
        }
        function saveNewCate() {
            const newCateName = document.getElementById('newCateInput').value.trim();
            if (!newCateName) {
                alert('è¯·è¾“å…¥åˆ†ç±»åç§°ï½');
                return;
            }
            // å»é‡åˆ¤æ–­
            const cateNames = categories.map(c => c.replace(/[^\u4e00-\u9fa5]/g, ''));
            if (cateNames.includes(newCateName)) {
                alert('è¿™ä¸ªåˆ†ç±»å·²ç»å­˜åœ¨å•¦ï½');
                return;
            }
            // éšæœºemojiï¼ˆé€‚é…æ‰‹æœºç«¯æ˜¾ç¤ºï¼‰
            const emojis = ['ğŸ¥¤', 'ğŸ“±', 'â˜•', 'ğŸ', 'ğŸš—', 'ğŸ’„', 'ğŸ“¦', 'ğŸ®', 'ğŸ”', 'ğŸµ'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            const newCate = newCateName + randomEmoji;
            
            // æ·»åŠ åˆ†ç±»å¹¶é‡æ–°æ¸²æŸ“
            categories.push(newCate);
            renderCategories();
            closeAddCateModal();
            alert(`æ–°å¢åˆ†ç±»æˆåŠŸï¼š${newCate}`);
        }

        // ========== æ”¶æ”¯ç±»å‹åˆ‡æ¢ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ ==========
        function setType(type) {
            currentType = type;
            // æ›´æ–°æŒ‰é’®é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // ========== ä¿å­˜è´¦å•ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ ==========
        function saveBill() {
            const amount = document.getElementById('billAmount').value.trim();
            if (!amount || parseFloat(amount) <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï½');
                return;
            }
            // æç¤ºè®°è´¦æˆåŠŸï¼ˆæ‰‹æœºç«¯å‹å¥½æç¤ºï¼‰
            alert(`âœ… è®°è´¦æˆåŠŸï¼\n${currentType === 'expense' ? 'æ”¯å‡º' : 'æ”¶å…¥'}ï¼šÂ¥${amount}\nåˆ†ç±»ï¼š${selectedCate}`);
            closeBillModal();
        }

        // æ‰‹æœºç«¯ä¼˜åŒ–ï¼šç¦æ­¢é¡µé¢ç¼©æ”¾
        document.addEventListener('touchmove', (e) => {
            if (e.scale !== 1) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
